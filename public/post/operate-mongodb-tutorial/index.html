<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>MongoDBæ“ä½œæŒ‡åŒ— | è™«å­æ¨±æ¡ƒ</title>
<meta name="keywords" content="golang, mongoDB" />
<meta name="description" content="TL;DR
ç¯å¢ƒå‡†å¤‡ mongoDB é¢„å¤‡çŸ¥è¯† MongoDBå¸¸è§çš„æ•°æ®ç±»å‹
æ•°æ®ç±»å‹ ç¤ºä¾‹ è¯´æ˜ Null {&quot;x&quot; : null} Boolean {&quot;x&quot; : true} Number {&quot;x&quot; : 3.14} {&quot;x&quot; : 3} {&quot;x&quot; : NumberInt(&quot;3&quot;)} {&quot;x&quot; : NumberLong(&quot;3&quot;)} é»˜è®¤64ä½æµ®ç‚¹æ•°ï¼Œæ•´æ•°éœ€è¦ä½¿ç”¨NumberIntå’ŒNumberLong String {&quot;x&quot; : &quot;foobar&quot;} ç¼–ç æ ¼å¼ä¸ºUTF-8 Date {&quot;x&quot; : new Date()} 64ä½æ—¶é—´æˆ³(ä»January 1, 1970)ï¼Œä¸å­˜æ—¶åŒºã€‚é€šè¿‡new Date()è¿›è¡Œè°ƒç”¨ã€‚ Regular expression {&quot;x&quot; : /foobar/i} javascript æ­£åˆ™ Array {&quot;x&quot; : [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]} Embedded document {&quot;x&quot; : {&quot;foo&quot; : &quot;bar&quot;}} Object ID {&quot;x&quot; : ObjectId()} æ–‡æ¡£12å­—èŠ‚çš„ID Binary data ä¸€ä¸ªä»»æ„å­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚æ˜¯ä¿å­˜éUTF-8å­—ç¬¦ä¸²åˆ°æ•°æ®åº“çš„å”¯ä¸€æ–¹æ³•ã€‚ Code {&quot;x&quot; : function() { /* .">
<meta name="author" content="czyt">
<link rel="canonical" href="https://czyt.tech/post/operate-mongodb-tutorial/" />
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.2300a0eceb56958fe6e1d606ffa0a755d9ef95657cbf4b79a3fa1d3b9dc8b654.css" integrity="sha256-IwCg7OtWlY/m4dYG/6CnVdnvlWV8v0t5o/odO53ItlQ=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js" integrity="sha256-uVus3DnjejMqn4g7Hni&#43;Srwf3KK8HyZB9V4809q9TWE="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://czyt.tech/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://czyt.tech/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://czyt.tech/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://czyt.tech/apple-touch-icon.png">
<link rel="mask-icon" href="https://czyt.tech/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<meta name="generator" content="Hugo 0.105.0">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="MongoDBæ“ä½œæŒ‡åŒ—" />
<meta property="og:description" content="TL;DR
ç¯å¢ƒå‡†å¤‡ mongoDB é¢„å¤‡çŸ¥è¯† MongoDBå¸¸è§çš„æ•°æ®ç±»å‹
æ•°æ®ç±»å‹ ç¤ºä¾‹ è¯´æ˜ Null {&quot;x&quot; : null} Boolean {&quot;x&quot; : true} Number {&quot;x&quot; : 3.14} {&quot;x&quot; : 3} {&quot;x&quot; : NumberInt(&quot;3&quot;)} {&quot;x&quot; : NumberLong(&quot;3&quot;)} é»˜è®¤64ä½æµ®ç‚¹æ•°ï¼Œæ•´æ•°éœ€è¦ä½¿ç”¨NumberIntå’ŒNumberLong String {&quot;x&quot; : &quot;foobar&quot;} ç¼–ç æ ¼å¼ä¸ºUTF-8 Date {&quot;x&quot; : new Date()} 64ä½æ—¶é—´æˆ³(ä»January 1, 1970)ï¼Œä¸å­˜æ—¶åŒºã€‚é€šè¿‡new Date()è¿›è¡Œè°ƒç”¨ã€‚ Regular expression {&quot;x&quot; : /foobar/i} javascript æ­£åˆ™ Array {&quot;x&quot; : [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]} Embedded document {&quot;x&quot; : {&quot;foo&quot; : &quot;bar&quot;}} Object ID {&quot;x&quot; : ObjectId()} æ–‡æ¡£12å­—èŠ‚çš„ID Binary data ä¸€ä¸ªä»»æ„å­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚æ˜¯ä¿å­˜éUTF-8å­—ç¬¦ä¸²åˆ°æ•°æ®åº“çš„å”¯ä¸€æ–¹æ³•ã€‚ Code {&quot;x&quot; : function() { /* ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://czyt.tech/post/operate-mongodb-tutorial/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-05-26T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2022-05-26T00:00:00&#43;00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MongoDBæ“ä½œæŒ‡åŒ—"/>
<meta name="twitter:description" content="TL;DR
ç¯å¢ƒå‡†å¤‡ mongoDB é¢„å¤‡çŸ¥è¯† MongoDBå¸¸è§çš„æ•°æ®ç±»å‹
æ•°æ®ç±»å‹ ç¤ºä¾‹ è¯´æ˜ Null {&quot;x&quot; : null} Boolean {&quot;x&quot; : true} Number {&quot;x&quot; : 3.14} {&quot;x&quot; : 3} {&quot;x&quot; : NumberInt(&quot;3&quot;)} {&quot;x&quot; : NumberLong(&quot;3&quot;)} é»˜è®¤64ä½æµ®ç‚¹æ•°ï¼Œæ•´æ•°éœ€è¦ä½¿ç”¨NumberIntå’ŒNumberLong String {&quot;x&quot; : &quot;foobar&quot;} ç¼–ç æ ¼å¼ä¸ºUTF-8 Date {&quot;x&quot; : new Date()} 64ä½æ—¶é—´æˆ³(ä»January 1, 1970)ï¼Œä¸å­˜æ—¶åŒºã€‚é€šè¿‡new Date()è¿›è¡Œè°ƒç”¨ã€‚ Regular expression {&quot;x&quot; : /foobar/i} javascript æ­£åˆ™ Array {&quot;x&quot; : [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]} Embedded document {&quot;x&quot; : {&quot;foo&quot; : &quot;bar&quot;}} Object ID {&quot;x&quot; : ObjectId()} æ–‡æ¡£12å­—èŠ‚çš„ID Binary data ä¸€ä¸ªä»»æ„å­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚æ˜¯ä¿å­˜éUTF-8å­—ç¬¦ä¸²åˆ°æ•°æ®åº“çš„å”¯ä¸€æ–¹æ³•ã€‚ Code {&quot;x&quot; : function() { /* ."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://czyt.tech/post/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "MongoDBæ“ä½œæŒ‡åŒ—",
      "item": "https://czyt.tech/post/operate-mongodb-tutorial/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "MongoDBæ“ä½œæŒ‡åŒ—",
  "name": "MongoDBæ“ä½œæŒ‡åŒ—",
  "description": "TL;DR\nç¯å¢ƒå‡†å¤‡ mongoDB é¢„å¤‡çŸ¥è¯† MongoDBå¸¸è§çš„æ•°æ®ç±»å‹\næ•°æ®ç±»å‹ ç¤ºä¾‹ è¯´æ˜ Null {\u0026quot;x\u0026quot; : null} Boolean {\u0026quot;x\u0026quot; : true} Number {\u0026quot;x\u0026quot; : 3.14} {\u0026quot;x\u0026quot; : 3} {\u0026quot;x\u0026quot; : NumberInt(\u0026quot;3\u0026quot;)} {\u0026quot;x\u0026quot; : NumberLong(\u0026quot;3\u0026quot;)} é»˜è®¤64ä½æµ®ç‚¹æ•°ï¼Œæ•´æ•°éœ€è¦ä½¿ç”¨NumberIntå’ŒNumberLong String {\u0026quot;x\u0026quot; : \u0026quot;foobar\u0026quot;} ç¼–ç æ ¼å¼ä¸ºUTF-8 Date {\u0026quot;x\u0026quot; : new Date()} 64ä½æ—¶é—´æˆ³(ä»January 1, 1970)ï¼Œä¸å­˜æ—¶åŒºã€‚é€šè¿‡new Date()è¿›è¡Œè°ƒç”¨ã€‚ Regular expression {\u0026quot;x\u0026quot; : /foobar/i} javascript æ­£åˆ™ Array {\u0026quot;x\u0026quot; : [\u0026quot;a\u0026quot;, \u0026quot;b\u0026quot;, \u0026quot;c\u0026quot;]} Embedded document {\u0026quot;x\u0026quot; : {\u0026quot;foo\u0026quot; : \u0026quot;bar\u0026quot;}} Object ID {\u0026quot;x\u0026quot; : ObjectId()} æ–‡æ¡£12å­—èŠ‚çš„ID Binary data ä¸€ä¸ªä»»æ„å­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚æ˜¯ä¿å­˜éUTF-8å­—ç¬¦ä¸²åˆ°æ•°æ®åº“çš„å”¯ä¸€æ–¹æ³•ã€‚ Code {\u0026quot;x\u0026quot; : function() { /* .",
  "keywords": [
    "golang", "mongoDB"
  ],
  "articleBody": "TL;DR\nç¯å¢ƒå‡†å¤‡ mongoDB é¢„å¤‡çŸ¥è¯† MongoDBå¸¸è§çš„æ•°æ®ç±»å‹\næ•°æ®ç±»å‹ ç¤ºä¾‹ è¯´æ˜ Null {\"x\" : null} Boolean {\"x\" : true} Number {\"x\" : 3.14} {\"x\" : 3} {\"x\" : NumberInt(\"3\")} {\"x\" : NumberLong(\"3\")} é»˜è®¤64ä½æµ®ç‚¹æ•°ï¼Œæ•´æ•°éœ€è¦ä½¿ç”¨NumberIntå’ŒNumberLong String {\"x\" : \"foobar\"} ç¼–ç æ ¼å¼ä¸ºUTF-8 Date {\"x\" : new Date()} 64ä½æ—¶é—´æˆ³(ä»January 1, 1970)ï¼Œä¸å­˜æ—¶åŒºã€‚é€šè¿‡new Date()è¿›è¡Œè°ƒç”¨ã€‚ Regular expression {\"x\" : /foobar/i} javascript æ­£åˆ™ Array {\"x\" : [\"a\", \"b\", \"c\"]} Embedded document {\"x\" : {\"foo\" : \"bar\"}} Object ID {\"x\" : ObjectId()} æ–‡æ¡£12å­—èŠ‚çš„ID Binary data ä¸€ä¸ªä»»æ„å­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚æ˜¯ä¿å­˜éUTF-8å­—ç¬¦ä¸²åˆ°æ•°æ®åº“çš„å”¯ä¸€æ–¹æ³•ã€‚ Code {\"x\" : function() { /* ... */ }} æ•°æ®æ“ä½œ æ•°æ®åº“è¿æ¥ è¿æ¥å­—ç¬¦ä¸² MongoDBçš„è¿æ¥å­—ç¬¦ä¸²ä¸ºå¦‚ä¸‹æ ¼å¼\nç¤ºä¾‹è¿æ¥åœ°å€ mongodb://user:pass@sample.host:27017/?maxPoolSize=20\u0026w=majority\nå®˜æ–¹æä¾›çš„è¿æ¥å­—ç¬¦é€‰é¡¹è¯´æ˜\nOption Name Type Default Value Description connectTimeoutMS integer 30000 Specifies the number of milliseconds to wait before timeout on a TCP connection. maxPoolSize integer 100 Specifies the maximum number of connections that a connection pool may have at a given time. replicaSet string null Specifies the replica set name for the cluster. All nodes in the replica set must have the same replica set name, or the Client will not consider them as part of the set. maxIdleTimeMS integer 0 Specifies the maximum amount of time a connection can remain idle in the connection pool before being removed and closed. The default is 0, meaning a connection can remain unused indefinitely. minPoolSize integer 0 Specifies the minimum number of connections that the driver maintains in a single connection pool. socketTimeoutMS integer 0 Specifies the number of milliseconds to wait for a socket read or write to return before returning a network error. The 0 default value indicates that there is no timeout. serverSelectionTimeoutMS integer 30000 Specifies the number of milliseconds to wait to find an available, suitable server to execute an operation. heartbeatFrequencyMS integer 10000 Specifies the number of milliseconds to wait between periodic background server checks. tls boolean false Specifies whether to establish a Transport Layer Security (TLS) connection with the instance. This is automatically set to true when using a DNS seedlist (SRV) in the connection string. You can override this behavior by setting the value to false. w string or integer null Specifies the write concern. To learn more about values, see the server documentation on Write Concern options. directConnection boolean false Specifies whether to force dispatch all operations to the host specified in the connection URI. æ•°æ®åº“é©±åŠ¨ è¿™é‡Œä»¥Golangè¯­è¨€ä¸ºä¾‹ã€‚æœ¬æ–‡ä½¿ç”¨MongoDBæ ‡å‡†æ•°æ®åº“é©±åŠ¨ï¼Œæœªä½¿ç”¨ODMæ¡†æ¶å¦‚mgmã€upper/dbã€mangoç­‰ã€‚å¼•å…¥æ–¹æ³•\nimport \"go.mongodb.org/mongo-driver/mongo\" Demoç¨‹åºå¦‚ä¸‹:\npackage main import ( \"context\" \"fmt\" \"go.mongodb.org/mongo-driver/mongo\" \"go.mongodb.org/mongo-driver/mongo/options\" \"go.mongodb.org/mongo-driver/mongo/readpref\" ) // Connection URI const uri = \"mongodb://user:pass@sample.host:27017/?maxPoolSize=20\u0026w=majority\" func main() { // Create a new client and connect to the server client, err := mongo.Connect(context.TODO(), options.Client().ApplyURI(uri)) if err != nil { panic(err) } defer func() { if err = client.Disconnect(context.TODO()); err != nil { panic(err) } }() // Ping the primary if err := client.Ping(context.TODO(), readpref.Primary()); err != nil { panic(err) } fmt.Println(\"Successfully connected and pinged.\") } BSONç®€ä»‹ â€‹ MongoDBä¸­çš„JSONæ–‡æ¡£å­˜å‚¨åœ¨åä¸ºBSON(äºŒè¿›åˆ¶ç¼–ç çš„JSON)çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ã€‚ä¸å…¶ä»–å°†JSONæ•°æ®å­˜å‚¨ä¸ºç®€å•å­—ç¬¦ä¸²å’Œæ•°å­—çš„æ•°æ®åº“ä¸åŒï¼ŒBSONç¼–ç æ‰©å±•äº†JSONè¡¨ç¤ºï¼Œä½¿å…¶åŒ…å«é¢å¤–çš„ç±»å‹ï¼Œå¦‚intã€longã€dateã€æµ®ç‚¹æ•°å’Œdecimal128ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºæ›´å®¹æ˜“å¯é åœ°å¤„ç†ã€æ’åºå’Œæ¯”è¾ƒæ•°æ®ã€‚\nè¿æ¥MongoDBçš„Goé©±åŠ¨ç¨‹åºä¸­æœ‰ä¸¤å¤§ç±»å‹è¡¨ç¤ºBSONæ•°æ®ï¼šDå’ŒRawã€‚\nç±»å‹Då®¶æ—è¢«ç”¨æ¥ç®€æ´åœ°æ„å»ºä½¿ç”¨æœ¬åœ°Goç±»å‹çš„BSONå¯¹è±¡ã€‚è¿™å¯¹äºæ„é€ ä¼ é€’ç»™MongoDBçš„å‘½ä»¤ç‰¹åˆ«æœ‰ç”¨ã€‚Då®¶æ—åŒ…æ‹¬å››ç±»:\nDï¼šä¸€ä¸ªBSONæ–‡æ¡£ã€‚è¿™ç§ç±»å‹åº”è¯¥åœ¨é¡ºåºé‡è¦çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œæ¯”å¦‚MongoDBå‘½ä»¤ã€‚ Mï¼šä¸€å¼ æ— åºçš„mapã€‚å®ƒå’ŒDæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å®ƒä¸ä¿æŒé¡ºåºã€‚ Aï¼šä¸€ä¸ªBSONæ•°ç»„ã€‚ Eï¼šDé‡Œé¢çš„ä¸€ä¸ªå…ƒç´ ã€‚ è¦ä½¿ç”¨BSONï¼Œéœ€è¦å…ˆå¯¼å…¥ä¸‹é¢çš„åŒ…ï¼š\nimport \"go.mongodb.org/mongo-driver/bson\" ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨Dç±»å‹æ„å»ºçš„è¿‡æ»¤å™¨æ–‡æ¡£çš„ä¾‹å­ï¼Œå®ƒå¯ä»¥ç”¨æ¥æŸ¥æ‰¾nameå­—æ®µä¸â€™å¼ ä¸‰â€™æˆ–â€™æå››â€™åŒ¹é…çš„æ–‡æ¡£:\nbson.D{{ \"name\", bson.D{{ \"$in\", bson.A{\"å¼ ä¸‰\", \"æå››\"}, }}, }} Rawç±»å‹å®¶æ—ç”¨äºéªŒè¯å­—èŠ‚åˆ‡ç‰‡ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨Lookup()ä»åŸå§‹ç±»å‹æ£€ç´¢å•ä¸ªå…ƒç´ ã€‚å¦‚æœä½ ä¸æƒ³è¦å°†BSONååºåˆ—åŒ–æˆå¦ä¸€ç§ç±»å‹çš„å¼€é”€ï¼Œé‚£ä¹ˆè¿™æ˜¯å¾ˆæœ‰æ•ˆçš„ä¸€ç§æ‰‹æ®µã€‚ä¸‹é¢ä»‹ç»MongoDBçš„ä¸€äº›åŸºæœ¬æ“ä½œã€‚\næ–°å¢æ•°æ® insertOne insertOneç”¨äºæ’å…¥ä¸€æ¡è®°å½•:\ndb.movies.insertOne({\"title\" : \"Stand by Me\"}) insertMany insertManyç”¨äºæ’å…¥å¤šæ¡è®°å½•ï¼š\ndb.movies.insertMany([{\"title\" : \"Ghostbusters\"}, {\"title\" : \"E.T.\"}, {\"title\" : \"Blade Runner\"}]); åˆ é™¤æ•°æ® deleteOne db.movies.deleteOne({\"_id\" : 4}) deleteMany db.mailing.list.deleteMany({\"opt-out\" : true}) drop dropç”¨äºåˆ é™¤collection\ndb.movies.drop() æ›´æ–°æ•°æ® ä¸€èˆ¬æ›´æ–° ä¸€èˆ¬æ›´æ–°ä½¿ç”¨findOneAndReplace updateOne updateManyæ–¹æ³•ã€‚\nå¸¸è§é€»è¾‘æ“ä½œç¬¦\næ“ä½œç¬¦ å«ä¹‰ ç¤ºä¾‹ $inc æ•°å€¼ç±»å‹æ•°æ®å¢åŠ ã€‚å¯ç”¨äºæ•°å€¼ç±»å‹ integer long double decimalçš„å¢åŠ åŠå‡å°ã€‚ db.analytics.updateOne({\"url\" : \"www.example.com\"}, {\"$inc\" : {\"pageviews\" : 1}}) $mul ä¹˜æ³•ï¼ˆ$mulï¼‰è¿ç®—ç¬¦ç”¨äºå°†ä¸€ä¸ªæ•°å­—å­—æ®µçš„å€¼ä¹˜ä»¥ ç»™å®šçš„æ•°å­—ã€‚ db.movies.findOneAndUpdate( {\"title\" : \"Macbeth\"},{$mul : {\"rating\" : 2}},{returnNewDocument : true}) $rename $renameæ“ä½œç¬¦ç”¨äºé‡å‘½åå­—æ®µã€‚ db.movies.findOneAndUpdate({\"title\" : \"Macbeth\"},{$rename : {\"num_mflix_comments\" : \"comments\", \"imdb_rating\" : \"rating\"}}, {returnNewDocument : true}) $set æ›´æ–°å­—æ®µå€¼ï¼Œä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºã€‚ db.user.updateOne({_id:2},{\"$set\":{\"lovemusic\":\"jaychou\"}}); $setOnInsert $setOnInsertä¸$setç±»ä¼¼ï¼Œä½†æ˜¯ï¼Œå®ƒåªåœ¨upsertæ’å…¥æ“ä½œæ—¶è®¾ç½®ç»™å®šçš„å­—æ®µã€‚å¦‚æœè¦æ›´æ–°çš„æ–‡æ¡£å­˜åœ¨åˆ™ä¸æ›´æ–°ã€‚ db.products.update( { _id: 1 }, { $set: { item: \"apple\" }, $setOnInsert: { defaultQty: 100 } }, { upsert: true } ) $unset åˆ é™¤é”®åŠå¯¹åº”çš„å€¼ ç¤ºä¾‹1db.user.updateOne({_id:2},{\"$unset\":{\"lovemusic\":\"jaychou\"}});ç¤ºä¾‹2db.user.update({\"email_state\":{\"$exists\":true}},{\"$unset\":{\"email_state\",\"\"}},{multi:true});è¯¥è¯­å¥å°†åˆ é™¤è¡¨çš„email_stateå­—æ®µ $push å½“å­—æ®µä¸ºæ•°ç»„å¯¹è±¡æ—¶ï¼Œæ›´æ–°å­—æ®µä½¿ç”¨ã€‚å¯ä»¥å¾€æ•°ç»„å¯¹è±¡æ·»åŠ è®°å½•ã€‚ db.blog.posts.updateOne({\"title\" : \"A blog post\"},{\"$push\" : {\"comments\" :{\"name\" : \"joe\", \"email\" : \"joe@example.com\",\"content\" : \"nice post.\"}}}) $each å’Œ$pushé…åˆä½¿ç”¨ï¼Œé€‚ç”¨äºä¸€æ¬¡æ“ä½œæ·»åŠ å¤šä¸ªè®°å½•çš„æƒ…å†µ db.stock.ticker.updateOne({\"_id\" : \"GOOG\"}, {\"$push\" : {\"hourly\" : {\"$each\" : [562.776, 562.790, 559.123]}}}) $slice é…åˆ$pushå’Œ$eachä½¿ç”¨ï¼Œç”¨äºé™åˆ¶å­—æ®µæ•°ç»„çš„æœ€å¤§é•¿åº¦ã€‚å³ä¾§çš„ç¤ºä¾‹æ„æ€ä¸ºï¼Œå°†æ•°ç»„å†…å®¹é™åˆ¶ä¸º10æ¡è®°å½•ï¼Œå¯¼å…¥ä¼˜å…ˆçº§ä»åå‘å‰ã€‚å•ç‹¬ä½¿ç”¨ï¼Œå¯ä»¥å®ç°TOPçš„æ•ˆæœ é…åˆä½¿ç”¨db.movies.updateOne({\"genre\" : \"horror\"}, {\"$push\" : {\"top10\" : {\"$each\" : [\"Nightmare on Elm Street\", \"Saw\"], \"$slice\" : -10}}})å•ç‹¬ä½¿ç”¨db.blog.posts.findOne(criteria, {\"comments\" : {\"$slice\" : 10}})è¿”å›å‰10æ¡è®°å½•db.blog.posts.findOne(criteria, {\"comments\" : {\"$slice\" : [23, 10]}})è¿”å›ä»24æ¡å¼€å§‹çš„10æ¡æ•°æ® db.blog.posts.findOne(criteria, {\"comments\" : {\"$slice\" : -1}})è¿”å›æœ€åä¸€æ¡è¯„è®º $sort é…åˆ$pushå’Œ$eachä½¿ç”¨,ç”¨äºè®¾ç½®æ·»åŠ è®°å½•å­—æ®µçš„æ’åºï¼Œ1å‡åº -1 é™åº db.movies.updateOne({\"genre\" : \"horror\"}, {\"$push\" : {\"top10\" : {\"$each\" : [{\"name\" : \"Nightmare on Elm Street\", \"rating\" : 6.6}, {\"name\" : \"Saw\", \"rating\" : 4.3}], \"$slice\" : -10, \"$sort\" : {\"rating\" : -1}}}}) $ne åˆ¤æ–­è®°å½•æ˜¯å¦å·²ç»å­˜åœ¨äºæ•°ç»„ã€‚å¯ä»¥ç†è§£ä¸ºIs Not Exist db.papers.updateOne({\"authors cited\" : {\"$ne\" : \"Richie\"}},{$push : {\"authors cited\" : \"Richie\"}}) $currentDate $currentDateç”¨äºè®¾ç½®ä¸€ä¸ªç»™å®šå­—æ®µçš„å€¼ä¸ºå½“å‰çš„ æ—¥æœŸæˆ–æ—¶é—´æˆ³ã€‚ db.movies.findOneAndUpdate( {\"title\" : \"Macbeth\"}, {$currentDate : { \"created_date\" : true, \"last_updated.date\" : {$type : \"date\"}, \"last_updated.timestamp\" : {$type : \"timestamp\"},}}, {returnNewDocument : true}) $addToSet åŠŸèƒ½ä¸$neæœ‰éƒ¨åˆ†é‡å ï¼Œæ·»åŠ å‰ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä»¥é¿å…é‡å¤ï¼Œé€‚ç”¨äº$neä¸é€‚ç”¨çš„åœºæ™¯ä¸”æœ‰æ›´å¥½çš„æè¿°æ€§ã€‚ db.users.updateOne({\"_id\" : ObjectId(\"4b2d75476cc613d5ee930164\")},{\"$addToSet\" : {\"emails\" : \"joe@hotmail.com\"}}) $pop ä»æ•°ç»„å°¾éƒ¨ç§»é™¤ã€‚{\"$pop\" : {â€œkeyâ€ : 1}}ä»å°¾éƒ¨ç§»é™¤1æ¡è®°å½•ï¼Œ{\"$pop\" : {â€œkeyâ€ : -1}}ä»å‰é¢ç§»é™¤1æ¡è®°å½•ã€‚ $pull ç§»é™¤æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è®°å½•ã€‚ä¾‹å¦‚è®°å½•ä¸º[1,2,3,1]è°ƒç”¨$pullåˆ é™¤1ï¼Œåˆ™åªå‰©ä¸‹[2,3] æ’å…¥å‡ æ¡æ•°æ®db.lists.insertOne({\"todo\" : [\"dishes\",dishes\", \"laundry\", \"dry cleaning\"]}) åˆ é™¤ä¸€æ¡æ•°æ® db.lists.updateOne({}, {\"$pull\" : {\"todo\" : \"dishes\"}}) $ ä½ç½®è¿ç®—ç¬¦ï¼Œç”¨äºæ›¿ä»£ç­›é€‰è®°å½•çš„Indexã€‚è¯¥è¿ç®—ç¬¦åªæ›´æ–°ç¬¬ä¸€ä¸ªåŒ¹é…çš„è®°å½•ã€‚ db.blog.updateOne({\"comments.author\" : \"John\"},{\"$set\" : {\"comments.$.author\" : \"Jim\"}}) arrayFilters db.blog.updateOne({\"post\" : post_id },{ $set: { \"comments.$[elem].hidden\" : true } },{ arrayFilters: [ { \"elem.votes\": { $lte: -5 } } ]}) Upsertæ›´æ–° Upsertæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ›´æ–°ã€‚å¦‚æœè®°å½•ä¸å­˜åœ¨ä¼šåˆå¹¶ç­›é€‰æ¡ä»¶å’Œæ›´æ–°è®°å½•æ¥è‡ªåŠ¨åˆ›å»ºè®°å½•ã€‚ç¤ºä¾‹ï¼š\ndb.post.updateOne({title:\"my love song\"},{$set:{content:{head:\"js\",body:\"javascript\"}}},{upsert:true}); æŸ¥è¯¢æ•°æ® MongoDB å¸¸ç”¨æŸ¥è¯¢çš„é€»è¾‘æ“ä½œç¬¦å¦‚ä¸‹ï¼š\nè¿ç®—ç¬¦ å«ä¹‰ $lt \u003c $lte \u003c= $gt \u003e $gte \u003e= $ne != $in in $nin not in $or or $not not $nor $noræ“ä½œç¬¦åœ¨è¯­æ³•ä¸Šä¸$orç›¸ä¼¼ï¼Œä½†è¡Œä¸ºæ–¹å¼ç›¸åã€‚$norè¿ç®—ç¬¦$noræ“ä½œç¬¦ä»¥æ•°ç»„çš„å½¢å¼æ¥å—å¤šä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œå¹¶ä¸” è¿”å›ä¸æ»¡è¶³ä»»ä½•ç»™å®šæ¡ä»¶çš„æ–‡æ¡£ã€‚db.movies.find({$nor:[{\"rated\" : \"G\"},{\"year\" : 2005}, {\"num_mflix_comments\" : {$gte : 5}}]}) $mod modå–æ¨¡è¿ç®—ã€‚å¦‚ db.users.find({\"id_num\" : {\"$mod\" : [5, 1]}})è¿”å›ç”¨æˆ·idä¸º1 , 6 , 11 , 16ç­‰ç¬¦åˆå–æ¨¡è¿ç®—çš„è®°å½•ã€‚ $regex æ­£åˆ™åŒ¹é… $all æ‰€æœ‰ æ»¡è¶³æ¡ä»¶çš„è®°å½• $size å°†æ•°ç»„é•¿åº¦ä½œä¸ºæŸ¥è¯¢çš„ä¸€éƒ¨åˆ†ã€‚å¦‚db.food.find({\"fruit\" : {\"$size\" : 3}})è¡¨ç¤ºæŸ¥è¯¢æ‰€æœ‰fruitå­—æ®µå€¼ä¸º3å…ƒç´ æ•°ç»„çš„è®°å½•ã€‚ $elemMatch å¼ºè¿«MongoDBç”¨ä¸€ä¸ªå•ä¸ªæ•°ç»„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œä¸åŒ¹é…éæ•°ç»„å…ƒç´ .db.test.find({\"x\" : {\"$elemMatch\" : {\"$gt\" : 10, \"$lt\" : 20}}})è¡¨ç¤ºæŸ¥è¯¢å­—æ®µä¸ºæ•°ç»„ä¸”æ•°ç»„å…ƒç´ å‡æ»¡è¶³ 10",
  "wordCount" : "1819",
  "inLanguage": "en",
  "datePublished": "2022-05-26T00:00:00Z",
  "dateModified": "2022-05-26T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "czyt"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://czyt.tech/post/operate-mongodb-tutorial/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "è™«å­æ¨±æ¡ƒ",
    "logo": {
      "@type": "ImageObject",
      "url": "https://czyt.tech/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://czyt.tech/" accesskey="h" title="è™«å­æ¨±æ¡ƒ (Alt + H)">è™«å­æ¨±æ¡ƒ</a>
            <span class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://czyt.tech/" title="ğŸ Home">
                    <span>ğŸ Home</span>
                </a>
            </li>
            <li>
                <a href="https://czyt.tech/about/" title="ğŸ™‹About">
                    <span>ğŸ™‹About</span>
                </a>
            </li>
            <li>
                <a href="https://czyt.tech/post/" title="ğŸ“šPosts">
                    <span>ğŸ“šPosts</span>
                </a>
            </li>
            <li>
                <a href="https://czyt.tech/search/" title="ğŸ”Search">
                    <span>ğŸ”Search</span>
                </a>
            </li>
            <li>
                <a href="https://czyt.tech/tags/" title="ğŸ”–Tags">
                    <span>ğŸ”–Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://czyt.tech/">Home</a>&nbsp;Â»&nbsp;<a href="https://czyt.tech/post/">Posts</a></div>
    <h1 class="post-title">
      MongoDBæ“ä½œæŒ‡åŒ—
    </h1>
    <div class="post-meta"><span title='2022-05-26 00:00:00 +0000 UTC'>May 26, 2022</span>&nbsp;Â·&nbsp;9 min&nbsp;Â·&nbsp;czyt

</div>
  </header> <div class="toc side right">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e7%8e%af%e5%a2%83%e5%87%86%e5%a4%87" aria-label="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</a></li>
                <li>
                    <a href="#%e9%a2%84%e5%a4%87%e7%9f%a5%e8%af%86" aria-label="é¢„å¤‡çŸ¥è¯†">é¢„å¤‡çŸ¥è¯†</a></li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e6%93%8d%e4%bd%9c" aria-label="æ•°æ®æ“ä½œ">æ•°æ®æ“ä½œ</a><ul>
                        
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e8%bf%9e%e6%8e%a5" aria-label="æ•°æ®åº“è¿æ¥">æ•°æ®åº“è¿æ¥</a><ul>
                        
                <li>
                    <a href="#%e8%bf%9e%e6%8e%a5%e5%ad%97%e7%ac%a6%e4%b8%b2" aria-label="è¿æ¥å­—ç¬¦ä¸²">è¿æ¥å­—ç¬¦ä¸²</a></li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e9%a9%b1%e5%8a%a8" aria-label="æ•°æ®åº“é©±åŠ¨">æ•°æ®åº“é©±åŠ¨</a></li></ul>
                </li>
                <li>
                    <a href="#bson%e7%ae%80%e4%bb%8b" aria-label="BSONç®€ä»‹">BSONç®€ä»‹</a></li>
                <li>
                    <a href="#%e6%96%b0%e5%a2%9e%e6%95%b0%e6%8d%ae" aria-label="æ–°å¢æ•°æ®">æ–°å¢æ•°æ®</a><ul>
                        
                <li>
                    <a href="#insertone" aria-label="insertOne">insertOne</a></li>
                <li>
                    <a href="#insertmany" aria-label="insertMany">insertMany</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%88%a0%e9%99%a4%e6%95%b0%e6%8d%ae" aria-label="åˆ é™¤æ•°æ®">åˆ é™¤æ•°æ®</a><ul>
                        
                <li>
                    <a href="#deleteone" aria-label="deleteOne">deleteOne</a></li>
                <li>
                    <a href="#deletemany" aria-label="deleteMany">deleteMany</a></li>
                <li>
                    <a href="#drop" aria-label="drop">drop</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%9b%b4%e6%96%b0%e6%95%b0%e6%8d%ae" aria-label="æ›´æ–°æ•°æ®">æ›´æ–°æ•°æ®</a><ul>
                        
                <li>
                    <a href="#%e4%b8%80%e8%88%ac%e6%9b%b4%e6%96%b0" aria-label="ä¸€èˆ¬æ›´æ–°">ä¸€èˆ¬æ›´æ–°</a></li>
                <li>
                    <a href="#upsert%e6%9b%b4%e6%96%b0" aria-label="Upsertæ›´æ–°">Upsertæ›´æ–°</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%9f%a5%e8%af%a2%e6%95%b0%e6%8d%ae" aria-label="æŸ¥è¯¢æ•°æ®">æŸ¥è¯¢æ•°æ®</a><ul>
                        
                <li>
                    <a href="#findfindone" aria-label="find/findOne">find/findOne</a></li>
                <li>
                    <a href="#sort" aria-label="sort">sort</a></li>
                <li>
                    <a href="#skip" aria-label="skip">skip</a></li>
                <li>
                    <a href="#limit" aria-label="limit">limit</a></li>
                <li>
                    <a href="#distinct" aria-label="distinct">distinct</a></li>
                <li>
                    <a href="#countdocumentscountestimateddocumentcount" aria-label="countDocuments/count/estimatedDocumentCount">countDocuments/count/estimatedDocumentCount</a></li>
                <li>
                    <a href="#%e8%81%9a%e5%90%88%e6%9f%a5%e8%af%a2-aggregation" aria-label="èšåˆæŸ¥è¯¢ Aggregation">èšåˆæŸ¥è¯¢ Aggregation</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e5%ae%9a%e4%b9%89%e4%b8%8e%e8%ae%be%e8%ae%a1" aria-label="æ•°æ®åº“å®šä¹‰ä¸è®¾è®¡">æ•°æ®åº“å®šä¹‰ä¸è®¾è®¡</a><ul>
                        
                <li>
                    <a href="#%e8%bf%91%e4%bc%bc%e6%a8%a1%e5%bc%8fapproximation" aria-label="è¿‘ä¼¼æ¨¡å¼Approximation">è¿‘ä¼¼æ¨¡å¼Approximation</a><ul>
                        
                <li>
                    <a href="#%e8%bf%91%e4%bc%bc%e6%a8%a1%e5%bc%8f" aria-label="è¿‘ä¼¼æ¨¡å¼">è¿‘ä¼¼æ¨¡å¼</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b%e7%94%a8%e4%be%8b" aria-label="ç¤ºä¾‹ç”¨ä¾‹">ç¤ºä¾‹ç”¨ä¾‹</a></li>
                <li>
                    <a href="#%e7%bb%93%e8%ae%ba" aria-label="ç»“è®º">ç»“è®º</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%b1%9e%e6%80%a7%e6%a8%a1%e5%bc%8fattribute" aria-label="å±æ€§æ¨¡å¼Attribute">å±æ€§æ¨¡å¼Attribute</a><ul>
                        
                <li>
                    <a href="#%e5%b1%9e%e6%80%a7%e6%a8%a1%e5%bc%8f" aria-label="å±æ€§æ¨¡å¼">å±æ€§æ¨¡å¼</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b%e7%94%a8%e4%be%8b-1" aria-label="ç¤ºä¾‹ç”¨ä¾‹">ç¤ºä¾‹ç”¨ä¾‹</a></li>
                <li>
                    <a href="#%e7%bb%93%e8%ae%ba-1" aria-label="ç»“è®º">ç»“è®º</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%a1%b6%e6%a8%a1%e5%bc%8f-bucket" aria-label="æ¡¶æ¨¡å¼ Bucket">æ¡¶æ¨¡å¼ Bucket</a><ul>
                        
                <li>
                    <a href="#%e6%a1%b6%e6%a8%a1%e5%bc%8f" aria-label="æ¡¶æ¨¡å¼">æ¡¶æ¨¡å¼</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b%e7%94%a8%e4%be%8b-2" aria-label="ç¤ºä¾‹ç”¨ä¾‹">ç¤ºä¾‹ç”¨ä¾‹</a></li>
                <li>
                    <a href="#%e7%bb%93%e8%ae%ba-2" aria-label="ç»“è®º">ç»“è®º</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%ae%a1%e7%ae%97%e6%a8%a1%e5%bc%8fcomputed" aria-label="è®¡ç®—æ¨¡å¼Computed">è®¡ç®—æ¨¡å¼Computed</a><ul>
                        
                <li>
                    <a href="#%e8%ae%a1%e7%ae%97%e6%a8%a1%e5%bc%8f" aria-label="è®¡ç®—æ¨¡å¼">è®¡ç®—æ¨¡å¼</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b%e7%94%a8%e4%be%8b-3" aria-label="ç¤ºä¾‹ç”¨ä¾‹">ç¤ºä¾‹ç”¨ä¾‹</a></li>
                <li>
                    <a href="#%e7%bb%93%e8%ae%ba-3" aria-label="ç»“è®º">ç»“è®º</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%96%87%e6%a1%a3%e7%89%88%e6%9c%ac%e6%8e%a7%e5%88%b6%e6%a8%a1%e5%bc%8f-document-versioning" aria-label="æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼ Document Versioning">æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼ Document Versioning</a><ul>
                        
                <li>
                    <a href="#%e6%96%87%e6%a1%a3%e7%89%88%e6%9c%ac%e6%8e%a7%e5%88%b6%e6%a8%a1%e5%bc%8f" aria-label="æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼">æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b%e7%94%a8%e4%be%8b-4" aria-label="ç¤ºä¾‹ç”¨ä¾‹">ç¤ºä¾‹ç”¨ä¾‹</a></li>
                <li>
                    <a href="#%e7%bb%93%e8%ae%ba-4" aria-label="ç»“è®º">ç»“è®º</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%89%a9%e5%b1%95%e5%bc%95%e7%94%a8%e6%a8%a1%e5%bc%8f-extended-reference" aria-label="æ‰©å±•å¼•ç”¨æ¨¡å¼ Extended Reference">æ‰©å±•å¼•ç”¨æ¨¡å¼ Extended Reference</a><ul>
                        
                <li>
                    <a href="#%e6%89%a9%e5%b1%95%e5%bc%95%e7%94%a8%e6%a8%a1%e5%bc%8f" aria-label="æ‰©å±•å¼•ç”¨æ¨¡å¼">æ‰©å±•å¼•ç”¨æ¨¡å¼</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b%e7%94%a8%e4%be%8b-5" aria-label="ç¤ºä¾‹ç”¨ä¾‹">ç¤ºä¾‹ç”¨ä¾‹</a></li>
                <li>
                    <a href="#%e7%bb%93%e8%ae%ba-5" aria-label="ç»“è®º">ç»“è®º</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%bc%82%e5%b8%b8%e5%80%bc%e6%a8%a1%e5%bc%8foutlier" aria-label="å¼‚å¸¸å€¼æ¨¡å¼Outlier">å¼‚å¸¸å€¼æ¨¡å¼Outlier</a><ul>
                        
                <li>
                    <a href="#%e5%bc%82%e5%b8%b8%e5%80%bc%e6%a8%a1%e5%bc%8f" aria-label="å¼‚å¸¸å€¼æ¨¡å¼">å¼‚å¸¸å€¼æ¨¡å¼</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b%e7%94%a8%e4%be%8b-6" aria-label="ç¤ºä¾‹ç”¨ä¾‹">ç¤ºä¾‹ç”¨ä¾‹</a></li>
                <li>
                    <a href="#%e7%bb%93%e8%ae%ba-6" aria-label="ç»“è®º">ç»“è®º</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%a2%84%e5%88%86%e9%85%8d%e6%a8%a1%e5%bc%8f-preallocation" aria-label="é¢„åˆ†é…æ¨¡å¼ Preallocation">é¢„åˆ†é…æ¨¡å¼ Preallocation</a><ul>
                        
                <li>
                    <a href="#%e9%a2%84%e5%88%86%e9%85%8d%e6%a8%a1%e5%bc%8f" aria-label="é¢„åˆ†é…æ¨¡å¼">é¢„åˆ†é…æ¨¡å¼</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b%e7%94%a8%e4%be%8b-7" aria-label="ç¤ºä¾‹ç”¨ä¾‹">ç¤ºä¾‹ç”¨ä¾‹</a></li>
                <li>
                    <a href="#%e7%bb%93%e8%ae%ba-7" aria-label="ç»“è®º">ç»“è®º</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%a4%9a%e6%80%81%e6%a8%a1%e5%bc%8f-polymorphic" aria-label="å¤šæ€æ¨¡å¼ polymorphic">å¤šæ€æ¨¡å¼ polymorphic</a><ul>
                        
                <li>
                    <a href="#%e5%a4%9a%e6%80%81%e6%a8%a1%e5%bc%8f" aria-label="å¤šæ€æ¨¡å¼">å¤šæ€æ¨¡å¼</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b%e7%94%a8%e4%be%8b-8" aria-label="ç¤ºä¾‹ç”¨ä¾‹">ç¤ºä¾‹ç”¨ä¾‹</a></li>
                <li>
                    <a href="#%e7%bb%93%e8%ae%ba-8" aria-label="ç»“è®º">ç»“è®º</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%a8%a1%e5%bc%8f%e7%89%88%e6%9c%ac%e6%8e%a7%e5%88%b6%e6%a8%a1%e5%bc%8f-schema-versioning" aria-label="æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼ Schema Versioning">æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼ Schema Versioning</a><ul>
                        
                <li>
                    <a href="#%e6%a8%a1%e5%bc%8f%e7%89%88%e6%9c%ac%e6%8e%a7%e5%88%b6%e6%a8%a1%e5%bc%8f" aria-label="æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼">æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b%e7%94%a8%e4%be%8b-9" aria-label="ç¤ºä¾‹ç”¨ä¾‹">ç¤ºä¾‹ç”¨ä¾‹</a></li>
                <li>
                    <a href="#%e7%bb%93%e8%ae%ba-9" aria-label="ç»“è®º">ç»“è®º</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%ad%90%e9%9b%86%e6%a8%a1%e5%bc%8f-subset" aria-label="å­é›†æ¨¡å¼ Subset">å­é›†æ¨¡å¼ Subset</a><ul>
                        
                <li>
                    <a href="#%e5%ad%90%e9%9b%86%e6%a8%a1%e5%bc%8f" aria-label="å­é›†æ¨¡å¼">å­é›†æ¨¡å¼</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b%e7%94%a8%e4%be%8b-10" aria-label="ç¤ºä¾‹ç”¨ä¾‹">ç¤ºä¾‹ç”¨ä¾‹</a></li>
                <li>
                    <a href="#%e7%bb%93%e8%ae%ba-10" aria-label="ç»“è®º">ç»“è®º</a></li></ul>
                </li>
                <li>
                    <a href="#%e6%a0%91%e6%a8%a1%e5%bc%8f-tree" aria-label="æ ‘æ¨¡å¼ Tree">æ ‘æ¨¡å¼ Tree</a></li>
                <li>
                    <a href="#%e6%a0%91%e6%a8%a1%e5%bc%8f" aria-label="æ ‘æ¨¡å¼">æ ‘æ¨¡å¼</a></li>
                <li>
                    <a href="#%e7%a4%ba%e4%be%8b%e7%94%a8%e4%be%8b-11" aria-label="ç¤ºä¾‹ç”¨ä¾‹">ç¤ºä¾‹ç”¨ä¾‹</a></li>
                <li>
                    <a href="#%e7%bb%93%e8%ae%ba-11" aria-label="ç»“è®º">ç»“è®º</a></li></ul>
                </li>
                <li>
                    <a href="#%e5%8f%82%e8%80%83" aria-label="å‚è€ƒ">å‚è€ƒ</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p><strong>TL;DR</strong></p>
<h2 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡<a hidden class="anchor" aria-hidden="true" href="#ç¯å¢ƒå‡†å¤‡">#</a></h2>
<ul>
<li>mongoDB</li>
</ul>
<h2 id="é¢„å¤‡çŸ¥è¯†">é¢„å¤‡çŸ¥è¯†<a hidden class="anchor" aria-hidden="true" href="#é¢„å¤‡çŸ¥è¯†">#</a></h2>
<p>MongoDBå¸¸è§çš„æ•°æ®ç±»å‹</p>
<table>
<thead>
<tr>
<th style="text-align:center">æ•°æ®ç±»å‹</th>
<th style="text-align:left">ç¤ºä¾‹</th>
<th style="text-align:left">è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Null</td>
<td style="text-align:left"><code>{&quot;x&quot; : null}</code></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:center">Boolean</td>
<td style="text-align:left"><code>{&quot;x&quot; : true}</code></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:center">Number</td>
<td style="text-align:left"><code>{&quot;x&quot; : 3.14}</code> <code>{&quot;x&quot; : 3}</code> <code>{&quot;x&quot; : NumberInt(&quot;3&quot;)}</code> <code>{&quot;x&quot; : NumberLong(&quot;3&quot;)}</code></td>
<td style="text-align:left">é»˜è®¤64ä½æµ®ç‚¹æ•°ï¼Œæ•´æ•°éœ€è¦ä½¿ç”¨<code>NumberInt</code>å’Œ<code>NumberLong</code></td>
</tr>
<tr>
<td style="text-align:center">String</td>
<td style="text-align:left"><code>{&quot;x&quot; : &quot;foobar&quot;}</code></td>
<td style="text-align:left">ç¼–ç æ ¼å¼ä¸ºUTF-8</td>
</tr>
<tr>
<td style="text-align:center">Date</td>
<td style="text-align:left"><code>{&quot;x&quot; : new Date()}</code></td>
<td style="text-align:left">64ä½æ—¶é—´æˆ³(ä»January 1, 1970)ï¼Œä¸å­˜æ—¶åŒºã€‚é€šè¿‡<code>new  Date()</code>è¿›è¡Œè°ƒç”¨ã€‚</td>
</tr>
<tr>
<td style="text-align:center">Regular expression</td>
<td style="text-align:left"><code>{&quot;x&quot; : /foobar/i}</code></td>
<td style="text-align:left">javascript æ­£åˆ™</td>
</tr>
<tr>
<td style="text-align:center">Array</td>
<td style="text-align:left"><code>{&quot;x&quot; : [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]}</code></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:center">Embedded document</td>
<td style="text-align:left"><code>{&quot;x&quot; : {&quot;foo&quot; : &quot;bar&quot;}}</code></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:center">Object ID</td>
<td style="text-align:left"><code>{&quot;x&quot; : ObjectId()}</code></td>
<td style="text-align:left">æ–‡æ¡£12å­—èŠ‚çš„ID</td>
</tr>
<tr>
<td style="text-align:center">Binary data</td>
<td style="text-align:left"></td>
<td style="text-align:left">ä¸€ä¸ªä»»æ„å­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚æ˜¯ä¿å­˜éUTF-8å­—ç¬¦ä¸²åˆ°æ•°æ®åº“çš„å”¯ä¸€æ–¹æ³•ã€‚</td>
</tr>
<tr>
<td style="text-align:center">Code</td>
<td style="text-align:left"><code>{&quot;x&quot; : function() { /* ... */ }}</code></td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h2 id="æ•°æ®æ“ä½œ">æ•°æ®æ“ä½œ<a hidden class="anchor" aria-hidden="true" href="#æ•°æ®æ“ä½œ">#</a></h2>
<h3 id="æ•°æ®åº“è¿æ¥">æ•°æ®åº“è¿æ¥<a hidden class="anchor" aria-hidden="true" href="#æ•°æ®åº“è¿æ¥">#</a></h3>
<h4 id="è¿æ¥å­—ç¬¦ä¸²">è¿æ¥å­—ç¬¦ä¸²<a hidden class="anchor" aria-hidden="true" href="#è¿æ¥å­—ç¬¦ä¸²">#</a></h4>
<p>MongoDBçš„è¿æ¥å­—ç¬¦ä¸²ä¸ºå¦‚ä¸‹æ ¼å¼</p>
<p><img loading="lazy" src="https://www.mongodb.com/docs/drivers/go/current/includes/figures/connection_uri_parts.png" alt="Each part of the connection string"  />
</p>
<p>ç¤ºä¾‹è¿æ¥åœ°å€ <code>mongodb://user:pass@sample.host:27017/?maxPoolSize=20&amp;w=majority</code></p>
<p>å®˜æ–¹æä¾›çš„è¿æ¥å­—ç¬¦é€‰é¡¹è¯´æ˜</p>
<blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">Option Name</th>
<th style="text-align:left">Type</th>
<th style="text-align:left">Default Value</th>
<th style="text-align:left">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>connectTimeoutMS</strong></td>
<td style="text-align:left">integer</td>
<td style="text-align:left"><code>30000</code></td>
<td style="text-align:left">Specifies the number of milliseconds to wait before timeout on a TCP connection.</td>
</tr>
<tr>
<td style="text-align:left"><strong>maxPoolSize</strong></td>
<td style="text-align:left">integer</td>
<td style="text-align:left"><code>100</code></td>
<td style="text-align:left">Specifies the maximum number of connections that a connection pool may have at a given time.</td>
</tr>
<tr>
<td style="text-align:left"><strong>replicaSet</strong></td>
<td style="text-align:left">string</td>
<td style="text-align:left"><code>null</code></td>
<td style="text-align:left">Specifies the replica set name for the cluster. All nodes in the replica set must have the same replica set name, or the Client will not consider them as part of the set.</td>
</tr>
<tr>
<td style="text-align:left"><strong>maxIdleTimeMS</strong></td>
<td style="text-align:left">integer</td>
<td style="text-align:left"><code>0</code></td>
<td style="text-align:left">Specifies the maximum amount of time a connection can remain idle in the connection pool before being removed and closed. The default is <code>0</code>, meaning a connection can remain unused indefinitely.</td>
</tr>
<tr>
<td style="text-align:left"><strong>minPoolSize</strong></td>
<td style="text-align:left">integer</td>
<td style="text-align:left"><code>0</code></td>
<td style="text-align:left">Specifies the minimum number of connections that the driver maintains in a single connection pool.</td>
</tr>
<tr>
<td style="text-align:left"><strong>socketTimeoutMS</strong></td>
<td style="text-align:left">integer</td>
<td style="text-align:left"><code>0</code></td>
<td style="text-align:left">Specifies the number of milliseconds to wait for a socket read or write to return before returning a network error. The <code>0</code> default value indicates that there is no timeout.</td>
</tr>
<tr>
<td style="text-align:left"><strong>serverSelectionTimeoutMS</strong></td>
<td style="text-align:left">integer</td>
<td style="text-align:left"><code>30000</code></td>
<td style="text-align:left">Specifies the number of milliseconds to wait to find an available, suitable server to execute an operation.</td>
</tr>
<tr>
<td style="text-align:left"><strong>heartbeatFrequencyMS</strong></td>
<td style="text-align:left">integer</td>
<td style="text-align:left"><code>10000</code></td>
<td style="text-align:left">Specifies the number of milliseconds to wait between periodic background server checks.</td>
</tr>
<tr>
<td style="text-align:left"><strong>tls</strong></td>
<td style="text-align:left">boolean</td>
<td style="text-align:left"><code>false</code></td>
<td style="text-align:left">Specifies whether to establish a Transport Layer Security (TLS) connection with the instance. This is automatically set to <code>true</code> when using a DNS seedlist (SRV) in the connection string. You can override this behavior by setting the value to <code>false</code>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>w</strong></td>
<td style="text-align:left">string or integer</td>
<td style="text-align:left"><code>null</code></td>
<td style="text-align:left">Specifies the write concern. To learn more about values, see the server documentation on <a href="https://www.mongodb.com/docs/manual/reference/write-concern/">Write Concern options</a>.</td>
</tr>
<tr>
<td style="text-align:left"><strong>directConnection</strong></td>
<td style="text-align:left">boolean</td>
<td style="text-align:left"><code>false</code></td>
<td style="text-align:left">Specifies whether to force dispatch <strong>all</strong> operations to the host specified in the connection URI.</td>
</tr>
</tbody>
</table>
</blockquote>
<h4 id="æ•°æ®åº“é©±åŠ¨">æ•°æ®åº“é©±åŠ¨<a hidden class="anchor" aria-hidden="true" href="#æ•°æ®åº“é©±åŠ¨">#</a></h4>
<p>è¿™é‡Œä»¥Golangè¯­è¨€ä¸ºä¾‹ã€‚æœ¬æ–‡ä½¿ç”¨MongoDBæ ‡å‡†æ•°æ®åº“é©±åŠ¨ï¼Œæœªä½¿ç”¨ODMæ¡†æ¶å¦‚<a href="https://github.com/Kamva/mgm">mgm</a>ã€<a href="https://github.com/upper/db">upper/db</a>ã€<a href="https://github.com/amorist/mango">mango</a>ç­‰ã€‚å¼•å…¥æ–¹æ³•</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;go.mongodb.org/mongo-driver/mongo&#34;</span>
</span></span></code></pre></div><p>Demoç¨‹åºå¦‚ä¸‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> (
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;context&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;go.mongodb.org/mongo-driver/mongo&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;go.mongodb.org/mongo-driver/mongo/options&#34;</span>
</span></span><span style="display:flex;"><span>	<span style="color:#e6db74">&#34;go.mongodb.org/mongo-driver/mongo/readpref&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// Connection URI
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">uri</span> = <span style="color:#e6db74">&#34;mongodb://user:pass@sample.host:27017/?maxPoolSize=20&amp;w=majority&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Create a new client and connect to the server
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#a6e22e">client</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">mongo</span>.<span style="color:#a6e22e">Connect</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">TODO</span>(), <span style="color:#a6e22e">options</span>.<span style="color:#a6e22e">Client</span>().<span style="color:#a6e22e">ApplyURI</span>(<span style="color:#a6e22e">uri</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">defer</span> <span style="color:#66d9ef">func</span>() {
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Disconnect</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">TODO</span>()); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>			panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>	}()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">// Ping the primary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">Ping</span>(<span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">TODO</span>(), <span style="color:#a6e22e">readpref</span>.<span style="color:#a6e22e">Primary</span>()); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
</span></span><span style="display:flex;"><span>		panic(<span style="color:#a6e22e">err</span>)
</span></span><span style="display:flex;"><span>	}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;Successfully connected and pinged.&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h3 id="bsonç®€ä»‹">BSONç®€ä»‹<a hidden class="anchor" aria-hidden="true" href="#bsonç®€ä»‹">#</a></h3>
<p>â€‹    MongoDBä¸­çš„JSONæ–‡æ¡£å­˜å‚¨åœ¨åä¸ºBSON(äºŒè¿›åˆ¶ç¼–ç çš„JSON)çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ã€‚ä¸å…¶ä»–å°†JSONæ•°æ®å­˜å‚¨ä¸ºç®€å•å­—ç¬¦ä¸²å’Œæ•°å­—çš„æ•°æ®åº“ä¸åŒï¼ŒBSONç¼–ç æ‰©å±•äº†JSONè¡¨ç¤ºï¼Œä½¿å…¶åŒ…å«é¢å¤–çš„ç±»å‹ï¼Œå¦‚intã€longã€dateã€æµ®ç‚¹æ•°å’Œdecimal128ã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºæ›´å®¹æ˜“å¯é åœ°å¤„ç†ã€æ’åºå’Œæ¯”è¾ƒæ•°æ®ã€‚</p>
<p>è¿æ¥MongoDBçš„Goé©±åŠ¨ç¨‹åºä¸­æœ‰ä¸¤å¤§ç±»å‹è¡¨ç¤ºBSONæ•°æ®ï¼š<code>D</code>å’Œ<code>Raw</code>ã€‚</p>
<p>ç±»å‹<code>D</code>å®¶æ—è¢«ç”¨æ¥ç®€æ´åœ°æ„å»ºä½¿ç”¨æœ¬åœ°Goç±»å‹çš„BSONå¯¹è±¡ã€‚è¿™å¯¹äºæ„é€ ä¼ é€’ç»™MongoDBçš„å‘½ä»¤ç‰¹åˆ«æœ‰ç”¨ã€‚<code>D</code>å®¶æ—åŒ…æ‹¬å››ç±»:</p>
<ul>
<li><code>D</code>ï¼šä¸€ä¸ªBSONæ–‡æ¡£ã€‚è¿™ç§ç±»å‹åº”è¯¥åœ¨é¡ºåºé‡è¦çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œæ¯”å¦‚MongoDBå‘½ä»¤ã€‚</li>
<li><code>M</code>ï¼šä¸€å¼ æ— åºçš„mapã€‚å®ƒå’ŒDæ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯å®ƒä¸ä¿æŒé¡ºåºã€‚</li>
<li><code>A</code>ï¼šä¸€ä¸ªBSONæ•°ç»„ã€‚</li>
<li><code>E</code>ï¼šDé‡Œé¢çš„ä¸€ä¸ªå…ƒç´ ã€‚</li>
</ul>
<p>è¦ä½¿ç”¨BSONï¼Œéœ€è¦å…ˆå¯¼å…¥ä¸‹é¢çš„åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;go.mongodb.org/mongo-driver/bson&#34;</span>
</span></span></code></pre></div><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨<code>D</code>ç±»å‹æ„å»ºçš„<strong>è¿‡æ»¤å™¨</strong>æ–‡æ¡£çš„ä¾‹å­ï¼Œå®ƒå¯ä»¥ç”¨æ¥æŸ¥æ‰¾nameå­—æ®µä¸â€™å¼ ä¸‰â€™æˆ–â€™æå››â€™åŒ¹é…çš„æ–‡æ¡£:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#a6e22e">bson</span>.<span style="color:#a6e22e">D</span>{{
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;name&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">bson</span>.<span style="color:#a6e22e">D</span>{{
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;$in&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">bson</span>.<span style="color:#a6e22e">A</span>{<span style="color:#e6db74">&#34;å¼ ä¸‰&#34;</span>, <span style="color:#e6db74">&#34;æå››&#34;</span>},
</span></span><span style="display:flex;"><span>    }},
</span></span><span style="display:flex;"><span>}}
</span></span></code></pre></div><p><code>Raw</code>ç±»å‹å®¶æ—ç”¨äºéªŒè¯å­—èŠ‚åˆ‡ç‰‡ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨<code>Lookup()</code>ä»åŸå§‹ç±»å‹æ£€ç´¢å•ä¸ªå…ƒç´ ã€‚å¦‚æœä½ ä¸æƒ³è¦å°†BSONååºåˆ—åŒ–æˆå¦ä¸€ç§ç±»å‹çš„å¼€é”€ï¼Œé‚£ä¹ˆè¿™æ˜¯å¾ˆæœ‰æ•ˆçš„ä¸€ç§æ‰‹æ®µã€‚ä¸‹é¢ä»‹ç»MongoDBçš„ä¸€äº›åŸºæœ¬æ“ä½œã€‚</p>
<h3 id="æ–°å¢æ•°æ®">æ–°å¢æ•°æ®<a hidden class="anchor" aria-hidden="true" href="#æ–°å¢æ•°æ®">#</a></h3>
<h4 id="insertone">insertOne<a hidden class="anchor" aria-hidden="true" href="#insertone">#</a></h4>
<p>insertOneç”¨äºæ’å…¥ä¸€æ¡è®°å½•:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>db.movies.insertOne(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;title&#34;</span> : <span style="color:#e6db74">&#34;Stand by Me&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>)
</span></span></code></pre></div><h4 id="insertmany">insertMany<a hidden class="anchor" aria-hidden="true" href="#insertmany">#</a></h4>
<p>insertManyç”¨äºæ’å…¥å¤šæ¡è®°å½•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>db.movies.insertMany([<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;title&#34;</span> : <span style="color:#e6db74">&#34;Ghostbusters&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;title&#34;</span> : <span style="color:#e6db74">&#34;E.T.&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;title&#34;</span> : <span style="color:#e6db74">&#34;Blade Runner&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>]);
</span></span></code></pre></div><h3 id="åˆ é™¤æ•°æ®">åˆ é™¤æ•°æ®<a hidden class="anchor" aria-hidden="true" href="#åˆ é™¤æ•°æ®">#</a></h3>
<h4 id="deleteone">deleteOne<a hidden class="anchor" aria-hidden="true" href="#deleteone">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span> db.movies.deleteOne(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;_id&#34;</span> : <span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">}</span>)
</span></span></code></pre></div><h4 id="deletemany">deleteMany<a hidden class="anchor" aria-hidden="true" href="#deletemany">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>db.mailing.list.deleteMany(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;opt-out&#34;</span> : <span style="color:#66d9ef">true</span><span style="color:#960050;background-color:#1e0010">}</span>)
</span></span></code></pre></div><h4 id="drop">drop<a hidden class="anchor" aria-hidden="true" href="#drop">#</a></h4>
<p>dropç”¨äºåˆ é™¤collection</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span> db.movies.<span style="color:#66d9ef">drop</span>()
</span></span></code></pre></div><h3 id="æ›´æ–°æ•°æ®">æ›´æ–°æ•°æ®<a hidden class="anchor" aria-hidden="true" href="#æ›´æ–°æ•°æ®">#</a></h3>
<h4 id="ä¸€èˆ¬æ›´æ–°">ä¸€èˆ¬æ›´æ–°<a hidden class="anchor" aria-hidden="true" href="#ä¸€èˆ¬æ›´æ–°">#</a></h4>
<p>ä¸€èˆ¬æ›´æ–°ä½¿ç”¨<code>findOneAndReplace</code> <code>updateOne</code> <code>updateMany</code>æ–¹æ³•ã€‚</p>
<p>å¸¸è§é€»è¾‘æ“ä½œç¬¦</p>
<table>
<thead>
<tr>
<th>æ“ä½œç¬¦</th>
<th>å«ä¹‰</th>
<th style="text-align:left">ç¤ºä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>$inc</td>
<td>æ•°å€¼ç±»å‹æ•°æ®å¢åŠ ã€‚å¯ç”¨äºæ•°å€¼ç±»å‹ <code>integer</code> <code>long</code> <code>double</code> <code>decimal</code>çš„å¢åŠ åŠå‡å°ã€‚</td>
<td style="text-align:left"><code>db.analytics.updateOne({&quot;url&quot; : &quot;www.example.com&quot;}, {&quot;$inc&quot; : {&quot;pageviews&quot; : 1}})</code></td>
</tr>
<tr>
<td>$mul</td>
<td>ä¹˜æ³•ï¼ˆ$mulï¼‰è¿ç®—ç¬¦ç”¨äºå°†ä¸€ä¸ªæ•°å­—å­—æ®µçš„å€¼ä¹˜ä»¥ ç»™å®šçš„æ•°å­—ã€‚</td>
<td style="text-align:left"><code>db.movies.findOneAndUpdate( {&quot;title&quot; : &quot;Macbeth&quot;},{$mul : {&quot;rating&quot; : 2}},{returnNewDocument : true})</code></td>
</tr>
<tr>
<td>$rename</td>
<td>$renameæ“ä½œç¬¦ç”¨äºé‡å‘½åå­—æ®µã€‚</td>
<td style="text-align:left"><code>db.movies.findOneAndUpdate({&quot;title&quot; : &quot;Macbeth&quot;},{$rename : {&quot;num_mflix_comments&quot; : &quot;comments&quot;,     &quot;imdb_rating&quot; : &quot;rating&quot;}}, {returnNewDocument : true})</code></td>
</tr>
<tr>
<td>$set</td>
<td>æ›´æ–°å­—æ®µå€¼ï¼Œä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºã€‚</td>
<td style="text-align:left"><code>db.user.updateOne({_id:2},{&quot;$set&quot;:{&quot;lovemusic&quot;:&quot;jaychou&quot;}});</code></td>
</tr>
<tr>
<td>$setOnInsert</td>
<td>$setOnInsertä¸$setç±»ä¼¼ï¼Œä½†æ˜¯ï¼Œå®ƒåªåœ¨upsertæ’å…¥æ“ä½œæ—¶è®¾ç½®ç»™å®šçš„å­—æ®µã€‚å¦‚æœè¦æ›´æ–°çš„æ–‡æ¡£å­˜åœ¨åˆ™ä¸æ›´æ–°ã€‚</td>
<td style="text-align:left"><code>db.products.update(  { _id: 1 },  {     $set: { item: &quot;apple&quot; },     $setOnInsert: { defaultQty: 100 }  },  { upsert: true } )</code></td>
</tr>
<tr>
<td>$unset</td>
<td>åˆ é™¤é”®åŠå¯¹åº”çš„å€¼</td>
<td style="text-align:left">ç¤ºä¾‹1<code>db.user.updateOne({_id:2},{&quot;$unset&quot;:{&quot;lovemusic&quot;:&quot;jaychou&quot;}});</code><!-- raw HTML omitted -->ç¤ºä¾‹2<code>db.user.update({&quot;email_state&quot;:{&quot;$exists&quot;:true}},{&quot;$unset&quot;:{&quot;email_state&quot;,&quot;&quot;}},{multi:true});</code>è¯¥è¯­å¥å°†åˆ é™¤è¡¨çš„<code>email_state</code>å­—æ®µ</td>
</tr>
<tr>
<td>$push</td>
<td>å½“å­—æ®µä¸ºæ•°ç»„å¯¹è±¡æ—¶ï¼Œæ›´æ–°å­—æ®µä½¿ç”¨ã€‚å¯ä»¥å¾€æ•°ç»„å¯¹è±¡æ·»åŠ è®°å½•ã€‚</td>
<td style="text-align:left"><code>db.blog.posts.updateOne({&quot;title&quot; : &quot;A blog post&quot;},{&quot;$push&quot; : {&quot;comments&quot; :{&quot;name&quot; : &quot;joe&quot;, &quot;email&quot; : &quot;joe@example.com&quot;,&quot;content&quot; : &quot;nice post.&quot;}}})</code></td>
</tr>
<tr>
<td>$each</td>
<td>å’Œ$pushé…åˆä½¿ç”¨ï¼Œé€‚ç”¨äºä¸€æ¬¡æ“ä½œæ·»åŠ å¤šä¸ªè®°å½•çš„æƒ…å†µ</td>
<td style="text-align:left"><code>db.stock.ticker.updateOne({&quot;_id&quot; : &quot;GOOG&quot;}, {&quot;$push&quot; : {&quot;hourly&quot; : {&quot;$each&quot; : [562.776, 562.790, 559.123]}}})</code></td>
</tr>
<tr>
<td>$slice</td>
<td>é…åˆ$pushå’Œ$eachä½¿ç”¨ï¼Œç”¨äºé™åˆ¶å­—æ®µæ•°ç»„çš„æœ€å¤§é•¿åº¦ã€‚å³ä¾§çš„ç¤ºä¾‹æ„æ€ä¸ºï¼Œå°†æ•°ç»„å†…å®¹é™åˆ¶ä¸º10æ¡è®°å½•ï¼Œå¯¼å…¥ä¼˜å…ˆçº§ä»åå‘å‰ã€‚å•ç‹¬ä½¿ç”¨ï¼Œå¯ä»¥å®ç°TOPçš„æ•ˆæœ</td>
<td style="text-align:left">é…åˆä½¿ç”¨<code>db.movies.updateOne({&quot;genre&quot; : &quot;horror&quot;}, {&quot;$push&quot; : {&quot;top10&quot; : {&quot;$each&quot; : [&quot;Nightmare on Elm Street&quot;, &quot;Saw&quot;], &quot;$slice&quot; : -10}}})</code>å•ç‹¬ä½¿ç”¨<code>db.blog.posts.findOne(criteria, {&quot;comments&quot; : {&quot;$slice&quot; : 10}})</code>è¿”å›å‰10æ¡è®°å½•<code>db.blog.posts.findOne(criteria, {&quot;comments&quot; : {&quot;$slice&quot; : [23, 10]}})</code>è¿”å›ä»24æ¡å¼€å§‹çš„10æ¡æ•°æ® <code> db.blog.posts.findOne(criteria, {&quot;comments&quot; : {&quot;$slice&quot; : -1}})</code>è¿”å›æœ€åä¸€æ¡è¯„è®º</td>
</tr>
<tr>
<td>$sort</td>
<td>é…åˆ$pushå’Œ$eachä½¿ç”¨,ç”¨äºè®¾ç½®æ·»åŠ è®°å½•å­—æ®µçš„æ’åºï¼Œ1å‡åº -1 é™åº</td>
<td style="text-align:left"><code>db.movies.updateOne({&quot;genre&quot; : &quot;horror&quot;}, {&quot;$push&quot; : {&quot;top10&quot; : {&quot;$each&quot; : [{&quot;name&quot; : &quot;Nightmare on Elm Street&quot;, &quot;rating&quot; : 6.6}, {&quot;name&quot; : &quot;Saw&quot;, &quot;rating&quot; : 4.3}], &quot;$slice&quot; : -10, &quot;$sort&quot; : {&quot;rating&quot; : -1}}}})</code></td>
</tr>
<tr>
<td>$ne</td>
<td>åˆ¤æ–­è®°å½•æ˜¯å¦å·²ç»å­˜åœ¨äºæ•°ç»„ã€‚å¯ä»¥ç†è§£ä¸ºIs Not Exist</td>
<td style="text-align:left"><code>db.papers.updateOne({&quot;authors cited&quot; : {&quot;$ne&quot; : &quot;Richie&quot;}},{$push : {&quot;authors cited&quot; : &quot;Richie&quot;}})</code></td>
</tr>
<tr>
<td>$currentDate</td>
<td>$currentDateç”¨äºè®¾ç½®ä¸€ä¸ªç»™å®šå­—æ®µçš„å€¼ä¸ºå½“å‰çš„ æ—¥æœŸæˆ–æ—¶é—´æˆ³ã€‚</td>
<td style="text-align:left"><code>db.movies.findOneAndUpdate( {&quot;title&quot; : &quot;Macbeth&quot;}, {$currentDate : {   &quot;created_date&quot; : true,       &quot;last_updated.date&quot; : {$type : &quot;date&quot;},      &quot;last_updated.timestamp&quot; : {$type : &quot;timestamp&quot;},}}, {returnNewDocument : true})</code></td>
</tr>
<tr>
<td>$addToSet</td>
<td>åŠŸèƒ½ä¸$neæœ‰éƒ¨åˆ†é‡å ï¼Œæ·»åŠ å‰ä¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ä»¥é¿å…é‡å¤ï¼Œé€‚ç”¨äº$neä¸é€‚ç”¨çš„åœºæ™¯ä¸”æœ‰æ›´å¥½çš„æè¿°æ€§ã€‚</td>
<td style="text-align:left"><code>db.users.updateOne({&quot;_id&quot; : ObjectId(&quot;4b2d75476cc613d5ee930164&quot;)},{&quot;$addToSet&quot; : {&quot;emails&quot; : &quot;joe@hotmail.com&quot;}})</code></td>
</tr>
<tr>
<td>$pop</td>
<td>ä»æ•°ç»„å°¾éƒ¨ç§»é™¤ã€‚{&quot;$pop&quot; : {&ldquo;key&rdquo; : 1}}ä»å°¾éƒ¨ç§»é™¤1æ¡è®°å½•ï¼Œ{&quot;$pop&quot; : {&ldquo;key&rdquo; : -1}}ä»å‰é¢ç§»é™¤1æ¡è®°å½•ã€‚</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td>$pull</td>
<td>ç§»é™¤æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è®°å½•ã€‚ä¾‹å¦‚è®°å½•ä¸º[1,2,3,1]è°ƒç”¨$pullåˆ é™¤1ï¼Œåˆ™åªå‰©ä¸‹[2,3]</td>
<td style="text-align:left">æ’å…¥å‡ æ¡æ•°æ®<code>db.lists.insertOne({&quot;todo&quot; : [&quot;dishes&quot;,dishes&quot;, &quot;laundry&quot;, &quot;dry cleaning&quot;]})  </code>  åˆ é™¤ä¸€æ¡æ•°æ®<code> db.lists.updateOne({}, {&quot;$pull&quot; : {&quot;todo&quot; : &quot;dishes&quot;}})</code></td>
</tr>
<tr>
<td>$</td>
<td>ä½ç½®è¿ç®—ç¬¦ï¼Œç”¨äºæ›¿ä»£ç­›é€‰è®°å½•çš„Indexã€‚è¯¥è¿ç®—ç¬¦åªæ›´æ–°ç¬¬ä¸€ä¸ªåŒ¹é…çš„è®°å½•ã€‚</td>
<td style="text-align:left"><code>db.blog.updateOne({&quot;comments.author&quot; : &quot;John&quot;},{&quot;$set&quot; : {&quot;comments.$.author&quot; : &quot;Jim&quot;}})</code></td>
</tr>
<tr>
<td>arrayFilters</td>
<td></td>
<td style="text-align:left"><code>db.blog.updateOne({&quot;post&quot; : post_id },{ $set: { &quot;comments.$[elem].hidden&quot; : true } },{   arrayFilters: [ { &quot;elem.votes&quot;: { $lte: -5 } } ]})</code></td>
</tr>
</tbody>
</table>
<h4 id="upsertæ›´æ–°">Upsertæ›´æ–°<a hidden class="anchor" aria-hidden="true" href="#upsertæ›´æ–°">#</a></h4>
<p>Upsertæ˜¯ä¸€ç§ç‰¹æ®Šçš„æ›´æ–°ã€‚å¦‚æœè®°å½•ä¸å­˜åœ¨ä¼šåˆå¹¶ç­›é€‰æ¡ä»¶å’Œæ›´æ–°è®°å½•æ¥è‡ªåŠ¨åˆ›å»ºè®°å½•ã€‚ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>db.post.updateOne(<span style="color:#960050;background-color:#1e0010">{</span>title:<span style="color:#e6db74">&#34;my love song&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>,<span style="color:#960050;background-color:#1e0010">{$</span><span style="color:#66d9ef">set</span>:<span style="color:#960050;background-color:#1e0010">{</span>content:<span style="color:#960050;background-color:#1e0010">{</span>head:<span style="color:#e6db74">&#34;js&#34;</span>,body:<span style="color:#e6db74">&#34;javascript&#34;</span><span style="color:#960050;background-color:#1e0010">}}}</span>,<span style="color:#960050;background-color:#1e0010">{</span>upsert:<span style="color:#66d9ef">true</span><span style="color:#960050;background-color:#1e0010">}</span>);
</span></span></code></pre></div><h3 id="æŸ¥è¯¢æ•°æ®">æŸ¥è¯¢æ•°æ®<a hidden class="anchor" aria-hidden="true" href="#æŸ¥è¯¢æ•°æ®">#</a></h3>
<p>MongoDB å¸¸ç”¨æŸ¥è¯¢çš„é€»è¾‘æ“ä½œç¬¦å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>è¿ç®—ç¬¦</th>
<th>å«ä¹‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>$lt</td>
<td>&lt;</td>
</tr>
<tr>
<td>$lte</td>
<td>&lt;=</td>
</tr>
<tr>
<td>$gt</td>
<td>&gt;</td>
</tr>
<tr>
<td>$gte</td>
<td>&gt;=</td>
</tr>
<tr>
<td>$ne</td>
<td>!=</td>
</tr>
<tr>
<td>$in</td>
<td>in</td>
</tr>
<tr>
<td>$nin</td>
<td>not in</td>
</tr>
<tr>
<td>$or</td>
<td>or</td>
</tr>
<tr>
<td>$not</td>
<td>not</td>
</tr>
<tr>
<td>$nor</td>
<td>$noræ“ä½œç¬¦åœ¨è¯­æ³•ä¸Šä¸$orç›¸ä¼¼ï¼Œä½†è¡Œä¸ºæ–¹å¼ç›¸åã€‚$norè¿ç®—ç¬¦$noræ“ä½œç¬¦ä»¥æ•°ç»„çš„å½¢å¼æ¥å—å¤šä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œå¹¶ä¸” è¿”å›ä¸æ»¡è¶³ä»»ä½•ç»™å®šæ¡ä»¶çš„æ–‡æ¡£ã€‚<code>db.movies.find({$nor:[{&quot;rated&quot; : &quot;G&quot;},{&quot;year&quot; : 2005},       {&quot;num_mflix_comments&quot; : {$gte : 5}}]})</code></td>
</tr>
<tr>
<td>$mod</td>
<td>modå–æ¨¡è¿ç®—ã€‚å¦‚<code> db.users.find({&quot;id_num&quot; : {&quot;$mod&quot; : [5, 1]}})</code>è¿”å›ç”¨æˆ·idä¸º1 ,  6 ,  11 ,  16ç­‰ç¬¦åˆå–æ¨¡è¿ç®—çš„è®°å½•ã€‚</td>
</tr>
<tr>
<td>$regex</td>
<td>æ­£åˆ™åŒ¹é…</td>
</tr>
<tr>
<td>$all</td>
<td><strong>æ‰€æœ‰</strong> æ»¡è¶³æ¡ä»¶çš„è®°å½•</td>
</tr>
<tr>
<td>$size</td>
<td>å°†æ•°ç»„é•¿åº¦ä½œä¸ºæŸ¥è¯¢çš„ä¸€éƒ¨åˆ†ã€‚å¦‚<code>db.food.find({&quot;fruit&quot; : {&quot;$size&quot; : 3}})</code>è¡¨ç¤ºæŸ¥è¯¢æ‰€æœ‰fruitå­—æ®µå€¼ä¸º3å…ƒç´ æ•°ç»„çš„è®°å½•ã€‚</td>
</tr>
<tr>
<td>$elemMatch</td>
<td>å¼ºè¿«MongoDBç”¨ä¸€ä¸ªå•ä¸ªæ•°ç»„å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œä¸åŒ¹é…éæ•°ç»„å…ƒç´ .<code>db.test.find({&quot;x&quot; : {&quot;$elemMatch&quot; : {&quot;$gt&quot; : 10, &quot;$lt&quot; : 20}}})</code>è¡¨ç¤ºæŸ¥è¯¢å­—æ®µä¸ºæ•°ç»„ä¸”æ•°ç»„å…ƒç´ å‡æ»¡è¶³ 10&lt;x&lt;20çš„è®°å½•ã€‚</td>
</tr>
<tr>
<td>$where</td>
<td></td>
</tr>
<tr>
<td>$match</td>
<td><code>db.companies.aggregate([{$match: {founded_year: 2004}}])</code>ç­‰ä»·äº<code>db.companies.find({founded_year: 2004})</code></td>
</tr>
</tbody>
</table>
<h4 id="findfindone">find/findOne<a hidden class="anchor" aria-hidden="true" href="#findfindone">#</a></h4>
<p><code>find</code>ç”¨äºæŸ¥è¯¢æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„è®°å½•ã€‚ç¤ºä¾‹:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>db.users.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;username&#34;</span> : <span style="color:#e6db74">&#34;joe&#34;</span><span style="color:#960050;background-color:#1e0010">}</span>)
</span></span></code></pre></div><p>æ³¨:ä¼ å…¥<code>{}</code>è¡¨ç¤ºå…¨éƒ¨æŸ¥è¯¢ã€‚</p>
<ul>
<li>æŒ‡å®šè¿”å›å­—æ®µçš„æŸ¥è¯¢ï¼Œç¤ºä¾‹:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>db.users.find(<span style="color:#960050;background-color:#1e0010">{}</span>, <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;username&#34;</span> : <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;email&#34;</span> : <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">}</span>)
</span></span></code></pre></div><p>é»˜è®¤æ˜¯è¦è¿”å›<code>_id</code>å­—æ®µï¼Œå¦‚æœè¦éšè—ï¼Œåˆ™ä¸Šé¢çš„è¯­å¥éœ€è¦æ”¹æˆä¸‹é¢çš„è¯­å¥(å…¶ä»–å­—æ®µå¦‚æœéœ€è¦éšè—ï¼Œæ“ä½œä¹Ÿæ˜¯ç±»ä¼¼):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>db.users.find(<span style="color:#960050;background-color:#1e0010">{}</span>, <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;username&#34;</span> : <span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#34;email&#34;</span> : <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;_id&#34;</span> : <span style="color:#ae81ff">0</span><span style="color:#960050;background-color:#1e0010">}</span>)
</span></span></code></pre></div><ul>
<li>æ¯”è¾ƒæŸ¥è¯¢</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>db.users.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;age&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$gte&#34;</span> : <span style="color:#ae81ff">18</span>, <span style="color:#e6db74">&#34;$lte&#34;</span> : <span style="color:#ae81ff">30</span><span style="color:#960050;background-color:#1e0010">}}</span>)
</span></span></code></pre></div><ul>
<li>INæŸ¥è¯¢</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span> db.raffle.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;ticket_no&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$in&#34;</span> : [<span style="color:#ae81ff">725</span>, <span style="color:#ae81ff">542</span>, <span style="color:#ae81ff">390</span>]<span style="color:#960050;background-color:#1e0010">}}</span>)
</span></span></code></pre></div><ul>
<li>ORæŸ¥è¯¢</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>db.raffle.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$or&#34;</span> : [<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;ticket_no&#34;</span> : <span style="color:#ae81ff">725</span><span style="color:#960050;background-color:#1e0010">}</span>, <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;winner&#34;</span> : <span style="color:#66d9ef">true</span><span style="color:#960050;background-color:#1e0010">}</span>]<span style="color:#960050;background-color:#1e0010">}</span>)
</span></span></code></pre></div><ul>
<li>æŸ¥è¯¢å­—æ®µä¸ºnullçš„è®°å½•</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span> db.<span style="color:#66d9ef">c</span>.find(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;z&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$eq&#34;</span> : <span style="color:#66d9ef">null</span>, <span style="color:#e6db74">&#34;$exists&#34;</span> : <span style="color:#66d9ef">true</span><span style="color:#960050;background-color:#1e0010">}}</span>)
</span></span></code></pre></div><p>é»˜è®¤æŸ¥è¯¢ä¸å­˜åœ¨çš„è®°å½•ä¼šè¿”å›æ‰€æœ‰çš„è®°å½•ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ <code>$exist</code>æ¥æ£€æŸ¥è®°å½•æ˜¯å¦å­˜åœ¨ã€‚</p>
<ul>
<li>
<p>æ•°ç»„æŸ¥è¯¢ï¼Œå¦‚ä¸€ä¸ªè¡¨æœ‰ä¸‹é¢çš„è®°å½•ï¼š
<img loading="lazy" src="https://assets.czyt.tech/img/mongo_record_sample.png" alt="image-20220527144010401"  />
</p>
<p>åˆ™å¯ä»¥ä½¿ç”¨è¯­å¥<code>db.food.find({&quot;fruit&quot; : &quot;banana&quot;})</code>è¿›è¡ŒæŸ¥è¯¢ã€‚å¦‚æœè¦æŸ¥è¯¢å¤šæ¡æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨<code>$all</code>æ¥æŸ¥è¯¢ï¼Œç¤ºä¾‹è¯­å¥<code>db.food.find({fruit : {$all : [&quot;apple&quot;, &quot;banana&quot;]}})</code>è¡¨ç¤ºæŸ¥è¯¢æ‰€æœ‰fruitä¸ºappleå’Œbananaçš„è®°å½•ã€‚</p>
</li>
<li>
<p>æ­£åˆ™æ¨¡ç³ŠåŒ¹é…æŸ¥è¯¢</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>db.users.find( <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;name&#34;</span> : <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;$regex&#34;</span> : <span style="color:#f92672">/</span>joe<span style="color:#f92672">/</span>i <span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#960050;background-color:#1e0010">}</span>)
</span></span></code></pre></div><p>æ³¨ï¼šMongoDBçš„æ­£åˆ™å¼•æ“ä¸º<code>PCRE</code></p>
</li>
</ul>
<h4 id="sort">sort<a hidden class="anchor" aria-hidden="true" href="#sort">#</a></h4>
<p>è®¾ç½®æŒ‰è®°å½•å­—æ®µçš„æ’åºã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span> db.<span style="color:#66d9ef">c</span>.find().sort(<span style="color:#960050;background-color:#1e0010">{</span>username : <span style="color:#ae81ff">1</span>, age : <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">}</span>)
</span></span></code></pre></div><p>æ³¨ï¼š<code>1</code> è¡¨ç¤ºå‡åºæ’åˆ— <code>-1</code> è¡¨ç¤ºé™åºæ’åˆ—ã€‚</p>
<h4 id="skip">skip<a hidden class="anchor" aria-hidden="true" href="#skip">#</a></h4>
<p>è·³è¿‡æ•°æ®æ¡æ•°ã€‚ç±»ä¼¼äºlimitï¼ŒåŒºåˆ«åœ¨äºSkipè®¾ç½®çš„æ˜¯æ•°æ®æ•°é‡çš„ä¸‹é™ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span> db.<span style="color:#66d9ef">c</span>.find().skip(<span style="color:#ae81ff">3</span>)
</span></span></code></pre></div><p>å½“Skipçš„æ•°å­—è¾ƒå¤§æ—¶ï¼Œè¯·å‹¿ä½¿ç”¨skipï¼Œè¿™ä¼šå½±å“æ•°æ®åº“çš„æ€§èƒ½ã€‚</p>
<h4 id="limit">limit<a hidden class="anchor" aria-hidden="true" href="#limit">#</a></h4>
<p>é™åˆ¶è¿”å›è®°å½•æ¡æ•°ã€‚limitè®¾ç½®çš„æ˜¯æ•°æ®æ•°é‡çš„ä¸Šé™ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>db.<span style="color:#66d9ef">c</span>.find().<span style="color:#66d9ef">limit</span>(<span style="color:#ae81ff">3</span>)
</span></span></code></pre></div><h4 id="distinct">distinct<a hidden class="anchor" aria-hidden="true" href="#distinct">#</a></h4>
<p>æŸ¥è¯¢å»é‡ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>db.movies.<span style="color:#66d9ef">distinct</span>(<span style="color:#e6db74">&#34;rated&#34;</span>, <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;year&#34;</span> : <span style="color:#ae81ff">1994</span><span style="color:#960050;background-color:#1e0010">}</span>) 
</span></span></code></pre></div><h4 id="countdocumentscountestimateddocumentcount">countDocuments/count/estimatedDocumentCount<a hidden class="anchor" aria-hidden="true" href="#countdocumentscountestimateddocumentcount">#</a></h4>
<p>æŸ¥è¯¢ç»Ÿè®¡</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>db.movies.countDocuments(<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;year&#34;</span>: <span style="color:#ae81ff">1999</span><span style="color:#960050;background-color:#1e0010">}</span>)
</span></span></code></pre></div><h4 id="èšåˆæŸ¥è¯¢-aggregation">èšåˆæŸ¥è¯¢ Aggregation<a hidden class="anchor" aria-hidden="true" href="#èšåˆæŸ¥è¯¢-aggregation">#</a></h4>
<p><img loading="lazy" src="https://assets.czyt.tech/img/mongodb_aggregation_pipe_line.png" alt="image-20220527160917081"  />
</p>
<p>â€‹	MongoDBèšåˆæŸ¥è¯¢ç”¨äºå¯¹æ•°æ®æ–‡æ¡£è¿›è¡Œå˜æ¢å’Œç»„åˆã€‚å®ç°ä¸Šï¼ŒMongoDBèšåˆç®¡é“åŸºäºæ•°æ®æµçš„æ¦‚å¿µï¼Œæ•°æ®è¿›å…¥ç®¡é“ç»è¿‡å¤šä¸ªstageæ“ä½œï¼ˆä¸»è¦æœ‰ç­›é€‰ã€æŠ•å°„ã€åˆ†ç»„ã€æ’åºã€é™åˆ¶åŠè·³è¿‡ï¼‰ï¼Œæœ€ç»ˆè¾“å‡ºã€‚å¸¸ç”¨ç®¡é“æ“ä½œç¬¦å‚è€ƒä¸‹è¡¨ï¼š</p>
<table>
<thead>
<tr>
<th>æ“ä½œç¬¦</th>
<th>ç®€è¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>$project</td>
<td>æŠ•å°„æ“ä½œç¬¦ï¼Œç”¨äºé‡æ„æ¯ä¸€ä¸ªæ–‡æ¡£çš„å­—æ®µï¼Œå¯ä»¥æå–å­—æ®µï¼Œé‡å‘½åå­—æ®µï¼Œç”šè‡³å¯ä»¥å¯¹åŸæœ‰å­—æ®µè¿›è¡Œæ“ä½œåæ–°å¢å­—æ®µã€‚å¦‚<code>db.users.aggregate([{ $project : { userId: '$_id', _id: 0 } }]);</code>å°†<code>_id</code> å­—æ®µé‡å‘½åä¸º<code>userId </code>ï¼Œä¸æ˜¾ç¤ºå­—æ®µ<code>_id</code>ã€‚</td>
</tr>
<tr>
<td>$match</td>
<td>åŒ¹é…æ“ä½œç¬¦ï¼Œç”¨äºå¯¹æ–‡æ¡£é›†åˆè¿›è¡Œç­›é€‰ã€‚</td>
</tr>
<tr>
<td>$group</td>
<td>åˆ†ç»„æ“ä½œç¬¦ï¼Œç”¨äºå¯¹æ–‡æ¡£é›†åˆè¿›è¡Œåˆ†ç»„ã€‚<code>_id</code>å­—æ®µæ˜¯å¿…é¡»çš„ã€‚<code>db.users.aggregate([{$group : {_id: '$sex',avgAge: { $avg: '$age' }, count: { $sum: 1 }}} ]);</code>å°†ç”¨æˆ·æŒ‰æ€§åˆ«åˆ†ç»„å¹¶æ˜¾ç¤ºå„æ€§åˆ«çš„å¹³å‡å¹´é¾„ï¼Œæœ€åè¿”å›å„æ€§åˆ«äººæ•°ã€‚<code>db.users.aggregate([{$match:{locale:{$eq:&quot;zh-Hans&quot;}}},{$group: {_id: &quot;$username&quot;,Email: {$addToSet: &quot;$email&quot;,}}}])</code>è¿”å›è¯­è¨€ä¸ºä¸­æ–‡çš„ç”¨æˆ·é‚®ä»¶åœ°å€å¹¶æŒ‰ç”¨æˆ·ååˆ†ç»„</td>
</tr>
<tr>
<td>$unwind</td>
<td>æ‹†åˆ†æ“ä½œç¬¦ï¼Œç”¨äºå°†æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå€¼æ‹†åˆ†ä¸ºå•ç‹¬çš„æ–‡æ¡£ã€‚</td>
</tr>
<tr>
<td>$sort</td>
<td>æ’åºæ“ä½œç¬¦ï¼Œç”¨äºæ ¹æ®ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µå¯¹æ–‡æ¡£è¿›è¡Œæ’åºã€‚å¦‚<code>db.users.aggregate([{ $sort : { age: 1 } }]);</code>å°†ç”¨æˆ·æŒ‰å­—æ®µ<code>age</code>å‡åºæ’åˆ—ã€‚</td>
</tr>
<tr>
<td>$limit</td>
<td>é™åˆ¶æ“ä½œç¬¦ï¼Œç”¨äºé™åˆ¶è¿”å›æ–‡æ¡£çš„æ•°é‡ã€‚</td>
</tr>
<tr>
<td>$skip</td>
<td>è·³è¿‡æ“ä½œç¬¦ï¼Œç”¨äºè·³è¿‡æŒ‡å®šæ•°é‡çš„æ–‡æ¡£ã€‚</td>
</tr>
<tr>
<td>$lookup</td>
<td>è¿æ¥æ“ä½œç¬¦ï¼Œç”¨äºè¿æ¥åŒä¸€ä¸ªæ•°æ®åº“ä¸­å¦ä¸€ä¸ªé›†åˆï¼Œå¹¶è·å–æŒ‡å®šçš„æ–‡æ¡£ï¼Œç±»ä¼¼äºpopulateã€‚</td>
</tr>
<tr>
<td>$count</td>
<td>ç»Ÿè®¡æ“ä½œç¬¦ï¼Œç”¨äºç»Ÿè®¡æ–‡æ¡£çš„æ•°é‡ã€‚</td>
</tr>
<tr>
<td>$sum</td>
<td>å¯¹æ–‡æ¡£å­—æ®µæ±‚å’Œã€‚</td>
</tr>
<tr>
<td>$avg</td>
<td>å¯¹æ–‡æ¡£å­—æ®µè¿›è¡Œå¹³å‡å€¼è®¡ç®—ã€‚</td>
</tr>
</tbody>
</table>
<p>æ›´å¤šç®¡é“æ“ä½œç¬¦,å‚è€ƒ<a href="https://link.jianshu.com/?t=https://docs.mongodb.com/manual/reference/operator/aggregation/">å®˜ç½‘</a>ã€<a href="https://mongodb.net.cn/manual/reference/operator/aggregation-pipeline/">ä¸­æ–‡æ–‡æ¡£</a>ã€‚</p>
<h2 id="æ•°æ®åº“å®šä¹‰ä¸è®¾è®¡">æ•°æ®åº“å®šä¹‰ä¸è®¾è®¡<a hidden class="anchor" aria-hidden="true" href="#æ•°æ®åº“å®šä¹‰ä¸è®¾è®¡">#</a></h2>
<p><img loading="lazy" src="https://assets.czyt.tech/img/mongoDB-with-patterns.png" alt="image-20220531090947932"  />
</p>
<p>æŒ‰å®˜æ–¹åšå®¢çš„MongoDBè®¾è®¡æ¨¡å¼ï¼Œå¤§è‡´å¯åˆ†ä¸ºä¸‹é¢å‡ ç§ï¼ˆæœºç¿»æ•´ç†ï¼‰ã€‚</p>
<table>
<thead>
<tr>
<th>æ¨¡å¼å</th>
<th>é€‚ç”¨åœºæ™¯</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-approximation-pattern">Approximation</a></td>
<td>å½“é¢‘ç¹è¿›è¡Œæ˜‚è´µçš„è®¡ç®—å¹¶ä¸”è¿™äº›è®¡ç®—çš„ç²¾åº¦ä¸æ˜¯æœ€é«˜ä¼˜å…ˆçº§æ—¶ï¼Œè¿‘ä¼¼æ¨¡å¼å¾ˆæœ‰ç”¨ã€‚</td>
<td>å¯¹æ•°æ®åº“çš„å†™å…¥æ›´å°‘ã€‚ä¿æŒç»Ÿè®¡ä¸Šæœ‰æ•ˆçš„æ•°å­—ã€‚</td>
<td>æ²¡æœ‰è¡¨ç¤ºç¡®åˆ‡çš„æ•°å­—ã€‚å¿…é¡»åœ¨åº”ç”¨ç¨‹åºä¸­æ‰§è¡Œã€‚</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-attribute-pattern">Attribute</a></td>
<td>å±æ€§æ¨¡å¼å¯¹äºåŸºäºå…·æœ‰è®¸å¤šç›¸ä¼¼å­—æ®µçš„å¤§å‹æ–‡æ¡£çš„é—®é¢˜å¾ˆæœ‰ç”¨ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå…±äº«å…±åŒç‰¹å¾çš„å­—æ®µå­é›†ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹è¯¥å­—æ®µå­é›†è¿›è¡Œæ’åºæˆ–æŸ¥è¯¢ã€‚å½“æˆ‘ä»¬éœ€è¦æ’åºçš„å­—æ®µä»…åœ¨ä¸€å°éƒ¨åˆ†æ–‡æ¡£ä¸­æ‰¾åˆ°æ—¶ã€‚æˆ–è€…å½“æ–‡æ¡£ä¸­åŒæ—¶æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶æ—¶ã€‚</td>
<td>éœ€è¦æ›´å°‘çš„ç´¢å¼•ã€‚æŸ¥è¯¢å˜å¾—æ›´å®¹æ˜“ç¼–å†™å¹¶ä¸”é€šå¸¸æ›´å¿«ã€‚</td>
<td></td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-bucket-pattern">Bucket</a></td>
<td>å½“éœ€è¦ç®¡ç†æµæ•°æ®æ—¶ï¼Œæ¡¶æ¨¡å¼æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆï¼Œä¾‹å¦‚æ—¶é—´åºåˆ—ã€å®æ—¶åˆ†ææˆ–ç‰©è”ç½‘ (IoT) åº”ç”¨ç¨‹åºã€‚</td>
<td>å‡å°‘é›†åˆä¸­çš„æ–‡æ¡£æ€»æ•°ã€‚æé«˜ç´¢å¼•æ€§èƒ½ã€‚å¯ä»¥é€šè¿‡åˆ©ç”¨é¢„èšåˆæ¥ç®€åŒ–æ•°æ®è®¿é—®ã€‚</td>
<td></td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-computed-pattern">Computed</a></td>
<td>å½“å­˜åœ¨è¯»å–å¯†é›†å‹æ•°æ®è®¿é—®æ¨¡å¼å¹¶ä¸”è¯¥æ•°æ®éœ€è¦ç”±åº”ç”¨ç¨‹åºé‡å¤è®¡ç®—æ—¶ï¼Œè®¡ç®—æ¨¡å¼æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ¢ç´¢é€‰æ‹©ã€‚</td>
<td>å‡å°‘é¢‘ç¹è®¡ç®—çš„ CPU å·¥ä½œé‡ã€‚æŸ¥è¯¢å˜å¾—æ›´å®¹æ˜“ç¼–å†™å¹¶ä¸”é€šå¸¸æ›´å¿«ã€‚</td>
<td>å¯èƒ½å¾ˆéš¾ç¡®å®šå¯¹è¿™ç§æ¨¡å¼çš„éœ€æ±‚ã€‚é™¤ééœ€è¦ï¼Œå¦åˆ™åº”é¿å…åº”ç”¨æˆ–è¿‡åº¦ä½¿ç”¨è¯¥æ¨¡å¼ã€‚</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-document-versioning-pattern">Document Versioning</a></td>
<td>å½“æ‚¨éœ€è¦åœ¨ MongoDB ä¸­ç»´æŠ¤ä»¥å‰ç‰ˆæœ¬çš„æ–‡æ¡£æ—¶ï¼Œæ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼æ˜¯ä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆã€‚</td>
<td>å³ä½¿åœ¨ç°æœ‰ç³»ç»Ÿä¸Šä¹Ÿæ˜“äºå®æ–½ã€‚å¯¹æœ€æ–°ç‰ˆæœ¬çš„æŸ¥è¯¢æ²¡æœ‰æ€§èƒ½å½±å“ã€‚</td>
<td>å†™å…¥æ¬¡æ•°ç¿»å€ã€‚æŸ¥è¯¢éœ€è¦é’ˆå¯¹æ­£ç¡®çš„é›†åˆã€‚</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-extended-reference-pattern">Extended Reference</a></td>
<td>å½“æ‚¨çš„åº”ç”¨ç¨‹åºç»å†å¤§é‡ JOIN æ“ä½œä»¥æ±‡é›†ç»å¸¸è®¿é—®çš„æ•°æ®æ—¶ï¼Œ æ‚¨ä¼šå‘ç°æ‰©å±•å¼•ç”¨æ¨¡å¼æœ€æœ‰ç”¨ã€‚</td>
<td>å½“æœ‰å¾ˆå¤š JOIN æ“ä½œæ—¶æé«˜æ€§èƒ½ã€‚æ›´å¿«çš„è¯»å–å’Œ JOIN æ€»æ•°çš„å‡å°‘ã€‚</td>
<td>æ•°æ®é‡å¤ã€‚</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-outlier-pattern">Outlier</a></td>
<td>æ‚¨æ˜¯å¦å‘ç°æœ‰ä¸€äº›æŸ¥è¯¢æˆ–æ–‡æ¡£ä¸é€‚åˆæ‚¨çš„å…¶ä»–å…¸å‹æ•°æ®æ¨¡å¼ï¼Ÿè¿™äº›ä¾‹å¤–æ˜¯å¦åœ¨æ¨åŠ¨æ‚¨çš„åº”ç”¨è§£å†³æ–¹æ¡ˆï¼Ÿå¦‚æœæ˜¯è¿™æ ·ï¼Œå¼‚å¸¸å€¼æ¨¡å¼æ˜¯è§£å†³è¿™ç§æƒ…å†µçš„ç»å¦™æ–¹æ³•ã€‚</td>
<td>é˜²æ­¢ä¸€äº›æ–‡æ¡£æˆ–æŸ¥è¯¢ç¡®å®šåº”ç”¨ç¨‹åºçš„è§£å†³æ–¹æ¡ˆã€‚æŸ¥è¯¢æ˜¯é’ˆå¯¹â€œå…¸å‹â€ç”¨ä¾‹é‡èº«å®šåˆ¶çš„ï¼Œä½†ä»ä¼šå¤„ç†å¼‚å¸¸å€¼ã€‚</td>
<td>é€šå¸¸ä¸ºç‰¹å®šæŸ¥è¯¢é‡èº«å®šåˆ¶ï¼Œå› æ­¤ä¸´æ—¶æŸ¥è¯¢å¯èƒ½è¡¨ç°ä¸ä½³ã€‚è¿™ç§æ¨¡å¼çš„å¤§éƒ¨åˆ†æ˜¯é€šè¿‡åº”ç”¨ç¨‹åºä»£ç å®Œæˆçš„ã€‚</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-preallocation-pattern">Pre-allocation</a></td>
<td>å½“æ‚¨çŸ¥é“æ‚¨çš„æ–‡æ¡£ç»“æ„å¹¶ä¸”æ‚¨çš„åº”ç”¨ç¨‹åºåªéœ€è¦ç”¨æ•°æ®å¡«å……å®ƒæ—¶ï¼Œé¢„åˆ†é…æ¨¡å¼æ˜¯æ­£ç¡®çš„é€‰æ‹©ã€‚</td>
<td>äº‹å…ˆçŸ¥é“æ–‡æ¡£ç»“æ„æ—¶çš„è®¾è®¡ç®€åŒ–ã€‚</td>
<td>ç®€å•æ€§ä¸æ€§èƒ½ã€‚</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-polymorphic-pattern">Polymorphic</a></td>
<td>å¤šæ€æ¨¡å¼æ˜¯å½“å­˜åœ¨å¤šç§æ–‡æ¡£çš„ç›¸ä¼¼æ€§å¤šäºå·®å¼‚å¹¶ä¸”éœ€è¦å°†æ–‡æ¡£ä¿å­˜åœ¨å•ä¸ªé›†åˆä¸­æ—¶çš„è§£å†³æ–¹æ¡ˆã€‚</td>
<td>æ˜“äºå®æ–½ã€‚æŸ¥è¯¢å¯ä»¥è·¨å•ä¸ªé›†åˆè¿è¡Œã€‚</td>
<td></td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-schema-versioning-pattern">Schema Versioning</a></td>
<td>å‡ ä¹æ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½å¯ä»¥ä»æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼ä¸­å—ç›Šï¼Œå› ä¸ºæ•°æ®æ¨¡å¼çš„æ›´æ”¹ç»å¸¸å‘ç”Ÿåœ¨åº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸­ã€‚æ­¤æ¨¡å¼å…è®¸æ–‡æ¡£çš„å…ˆå‰ç‰ˆæœ¬å’Œå½“å‰ç‰ˆæœ¬å¹¶æ’å­˜åœ¨äºé›†åˆä¸­ã€‚</td>
<td>æ— éœ€åœæœºã€‚æ§åˆ¶æ¨¡å¼è¿ç§»ã€‚å‡å°‘æœªæ¥çš„æŠ€æœ¯å€ºåŠ¡ã€‚</td>
<td>åœ¨è¿ç§»æœŸé—´å¯èƒ½éœ€è¦ä¸ºåŒä¸€å­—æ®µåˆ›å»ºä¸¤ä¸ªç´¢å¼•ã€‚</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-subset-pattern">Subset</a></td>
<td>å­é›†æ¨¡å¼è§£å†³äº†ç”±äºæ–‡æ¡£ä¸­çš„å¤§éƒ¨åˆ†æ•°æ®æœªè¢«åº”ç”¨ç¨‹åºä½¿ç”¨è€Œå¯¼è‡´<a href="https://docs.mongodb.com/manual/reference/glossary/#term-working-set">å·¥ä½œé›†</a>è¶…å‡º RAM å®¹é‡çš„é—®é¢˜ã€‚</td>
<td>å‡å°‘å·¥ä½œé›†çš„æ•´ä½“å¤§å°ã€‚æœ€å¸¸ç”¨æ•°æ®çš„ç£ç›˜è®¿é—®æ—¶é—´æ›´çŸ­ã€‚</td>
<td>æˆ‘ä»¬å¿…é¡»ç®¡ç†å­é›†ã€‚æå–é¢å¤–æ•°æ®éœ€è¦é¢å¤–è®¿é—®æ•°æ®åº“ã€‚</td>
</tr>
<tr>
<td><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-tree-pattern">Tree</a></td>
<td>å½“æ•°æ®å…·æœ‰å±‚æ¬¡ç»“æ„å¹¶ä¸”ç»å¸¸è¢«æŸ¥è¯¢æ—¶ï¼Œæ ‘æ¨¡å¼æ˜¯è¦å®ç°çš„è®¾è®¡æ¨¡å¼ã€‚</td>
<td>é€šè¿‡é¿å…å¤šæ¬¡ JOIN æ“ä½œæ¥æé«˜æ€§èƒ½ã€‚</td>
<td>éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­ç®¡ç†å¯¹å›¾å½¢çš„æ›´æ–°ã€‚</td>
</tr>
</tbody>
</table>
<h3 id="è¿‘ä¼¼æ¨¡å¼approximation">è¿‘ä¼¼æ¨¡å¼Approximation<a hidden class="anchor" aria-hidden="true" href="#è¿‘ä¼¼æ¨¡å¼approximation">#</a></h3>
<p>æƒ³è±¡ä¸€ä¸ªç›¸å½“å¤§çš„åŸå¸‚ï¼Œå¤§çº¦æœ‰ 39,000 äººã€‚éšç€äººä»¬è¿›å‡ºåŸå¸‚ã€å©´å„¿å‡ºç”Ÿå’Œäººä»¬æ­»äº¡ï¼Œç¡®åˆ‡çš„æ•°å­—éå¸¸ä¸ç¨³å®šã€‚æˆ‘ä»¬å¯ä»¥èŠ±æ—¶é—´å°è¯•æ¯å¤©è·å¾—å‡†ç¡®æ•°é‡çš„å±…æ°‘ã€‚ä½†å¤§å¤šæ•°æ—¶å€™ï¼Œ39,000 è¿™ä¸ªæ•°å­—â€œè¶³å¤Ÿå¥½â€ã€‚åŒæ ·ï¼Œåœ¨æˆ‘ä»¬å¼€å‘çš„è®¸å¤šåº”ç”¨ç¨‹åºä¸­ï¼ŒçŸ¥é“ä¸€ä¸ªâ€œè¶³å¤Ÿå¥½â€çš„æ•°å­—å°±è¶³å¤Ÿäº†ã€‚å¦‚æœâ€œè¶³å¤Ÿå¥½â€çš„æ•°å­—è¶³å¤Ÿå¥½ï¼Œé‚£ä¹ˆè¿™æ˜¯å°†<em>è¿‘ä¼¼æ¨¡å¼</em>åº”ç”¨äºæ‚¨çš„æ¨¡å¼è®¾è®¡çš„ç»ä½³æœºä¼šã€‚</p>
<h4 id="è¿‘ä¼¼æ¨¡å¼">è¿‘ä¼¼æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#è¿‘ä¼¼æ¨¡å¼">#</a></h4>
<p>å½“æˆ‘ä»¬éœ€è¦æ˜¾ç¤ºå…·æœ‰æŒ‘æˆ˜æ€§æˆ–èµ„æºæ˜‚è´µçš„è®¡ç®—ï¼ˆæ—¶é—´ã€å†…å­˜ã€CPU å‘¨æœŸï¼‰æ¥è®¡ç®—ä»¥åŠç²¾åº¦ä¸æ˜¯æœ€é«˜ä¼˜å…ˆçº§æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨*è¿‘ä¼¼æ¨¡å¼ã€‚*å†æƒ³æƒ³äººå£é—®é¢˜ã€‚<strong>å‡†ç¡®</strong>è®¡ç®—è¯¥æ•°å­—çš„æˆæœ¬æ˜¯å¤šå°‘ï¼Ÿè‡ªä»æˆ‘å¼€å§‹è®¡ç®—ä»¥æ¥ï¼Œå®ƒä¼šæ”¹å˜è¿˜æ˜¯å¯èƒ½æ”¹å˜ï¼Ÿå¦‚æœæŠ¥å‘Šä¸º 39,000 è€Œå®é™…ä¸Šæ˜¯ 39,012ï¼Œå¯¹åŸå¸‚çš„è§„åˆ’æˆ˜ç•¥æœ‰ä½•å½±å“ï¼Ÿ</p>
<p>ä»åº”ç”¨ç¨‹åºçš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªè¿‘ä¼¼å› å­ï¼Œè¿™å°†å…è®¸æ›´å°‘çš„æ•°æ®åº“å†™å…¥ï¼Œå¹¶ä¸”ä»ç„¶æä¾›ç»Ÿè®¡ä¸Šæœ‰æ•ˆçš„æ•°å­—ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬çš„åŸå¸‚è§„åˆ’ç­–ç•¥æ˜¯åŸºäºæ¯ 10,000 äººéœ€è¦ä¸€è¾†æ¶ˆé˜²è½¦ã€‚100 äººä¼¼ä¹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§„åˆ’â€œæ›´æ–°â€æœŸã€‚â€œæˆ‘ä»¬æ­£åœ¨æ¥è¿‘ä¸‹ä¸€ä¸ªé—¨æ§›ï¼Œæ›´å¥½åœ°å¼€å§‹é¢„ç®—ã€‚â€</p>
<p>ç„¶ååœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªè®¡æ•°å™¨ï¼Œè€Œä¸æ˜¯æ¯æ¬¡æ›´æ”¹éƒ½æ›´æ–°æ•°æ®åº“ä¸­çš„äººå£ï¼Œå¹¶ä¸”åªæ›´æ–° 100 æ¬¡ï¼Œå³ 1% çš„æ—¶é—´ã€‚æˆ‘ä»¬çš„å†™å…¥åœ¨è¿™é‡Œæ˜¾ç€å‡å°‘ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­å‡å°‘äº† 99%ã€‚å¦ä¸€ç§é€‰æ‹©å¯èƒ½æ˜¯æœ‰ä¸€ä¸ªè¿”å›éšæœºæ•°çš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªä» 0 åˆ° 100 çš„æ•°å­—ï¼Œé‚£ä¹ˆå®ƒå°†åœ¨å¤§çº¦ 1% çš„æ—¶é—´å†…è¿”å› 0ã€‚å½“æ»¡è¶³è¯¥æ¡ä»¶æ—¶ï¼Œæˆ‘ä»¬å°†è®¡æ•°å™¨å¢åŠ  100ã€‚</p>
<p>æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å…³å¿ƒè¿™ä¸ªï¼Ÿå¥½å§ï¼Œå½“å¤„ç†å¤§é‡æ•°æ®æˆ–å¤§é‡ç”¨æˆ·æ—¶ï¼Œå†™å…¥æ“ä½œå¯¹æ€§èƒ½çš„å½±å“ä¹Ÿä¼šå¾ˆå¤§ã€‚ä½ æ‰©å¤§çš„è§„æ¨¡è¶Šå¤§ï¼Œå½±å“ä¹Ÿè¶Šå¤§ï¼Œè€Œä¸”åœ¨è§„æ¨¡ä¸Šï¼Œè¿™é€šå¸¸æ˜¯ä½ æœ€é‡è¦çš„è€ƒè™‘å› ç´ ã€‚é€šè¿‡å‡å°‘å†™å…¥å¹¶å‡å°‘ä¸éœ€è¦â€œå®Œç¾â€çš„æ•°æ®çš„èµ„æºï¼Œå®ƒå¯ä»¥å¸¦æ¥æ€§èƒ½çš„å·¨å¤§æ”¹è¿›ã€‚</p>
<h4 id="ç¤ºä¾‹ç”¨ä¾‹">ç¤ºä¾‹ç”¨ä¾‹<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹ç”¨ä¾‹">#</a></h4>
<p>äººå£æ¨¡å¼æ˜¯<em>è¿‘ä¼¼æ¨¡å¼</em>çš„ä¸€ä¸ªä¾‹å­ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ­¤æ¨¡å¼çš„å¦ä¸€ä¸ªç”¨ä¾‹æ˜¯ç½‘ç«™è§†å›¾ã€‚ä¸€èˆ¬æ¥è¯´ï¼ŒçŸ¥é“æ˜¯å¦æœ‰ 700,000 äººè®¿é—®äº†è¯¥ç½‘ç«™ï¼Œè¿˜æ˜¯ 699,983 äººå¹¶ä¸é‡è¦ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­æ„å»ºä¸€ä¸ªè®¡æ•°å™¨ï¼Œå¹¶åœ¨è¾¾åˆ°æˆ‘ä»¬çš„é˜ˆå€¼æ—¶åœ¨æ•°æ®åº“ä¸­æ›´æ–°å®ƒã€‚</p>
<p>è¿™å¯èƒ½ä¼šæå¤§åœ°é™ä½ç½‘ç«™çš„æ€§èƒ½ã€‚å°†æ—¶é—´å’Œèµ„æºèŠ±åœ¨ä¸šåŠ¡å…³é”®çš„æ•°æ®å†™å…¥ä¸Šæ˜¯æœ‰æ„ä¹‰çš„ã€‚å°†å®ƒä»¬å…¨éƒ¨èŠ±åœ¨é¡µé¢è®¡æ•°å™¨ä¸Šä¼¼ä¹å¹¶ä¸æ˜¯å¯¹èµ„æºçš„å……åˆ†åˆ©ç”¨ã€‚</p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/image1-jxnz80p1y4.png" alt="è¿‘ä¼¼å€¼å¯¹å†™å…¥å·¥ä½œé‡çš„å½±å“"  />
</p>
<p><em>ç”µå½±ç½‘ç«™ - å‡å°‘å†™ä½œå·¥ä½œé‡</em></p>
<p>åœ¨ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•ä½¿ç”¨<em>è¿‘ä¼¼æ¨¡å¼</em>å¹¶ä¸ä»…å‡å°‘è®¡æ•°å™¨æ“ä½œçš„å†™å…¥ï¼Œè€Œä¸”æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°é€šè¿‡å‡å°‘è¿™äº›å†™å…¥æ¥é™ä½æ¶æ„å¤æ‚æ€§å’Œæˆæœ¬ã€‚è¿™å¯ä»¥è¿›ä¸€æ­¥èŠ‚çœå†™å…¥æ•°æ®çš„æ—¶é—´ã€‚*<a href="https://www.mongodb.com/blog/post/building-with-patterns-the-computed-pattern">ä¸æˆ‘ä»¬ä¹‹å‰æ¢è®¨çš„è®¡ç®—æ¨¡å¼</a>*ç±»ä¼¼ï¼Œå®ƒä¸å¿…é¢‘ç¹åœ°è¿è¡Œè®¡ç®—ï¼Œä»è€ŒèŠ‚çœäº†æ•´ä½“ CPU ä½¿ç”¨ç‡ã€‚</p>
<h4 id="ç»“è®º">ç»“è®º<a hidden class="anchor" aria-hidden="true" href="#ç»“è®º">#</a></h4>
<p>å¯¹äºå¤„ç†éš¾ä»¥è®¡ç®—å’Œ/æˆ–è®¡ç®—æˆæœ¬é«˜æ˜‚çš„æ•°æ®å¹¶ä¸”è¿™äº›æ•°å­—çš„å‡†ç¡®æ€§ä¸æ˜¯å…³é”®ä»»åŠ¡çš„åº”ç”¨ç¨‹åºï¼Œ*è¿‘ä¼¼æ¨¡å¼æ˜¯ä¸€ç§å‡ºè‰²çš„è§£å†³æ–¹æ¡ˆã€‚*æˆ‘ä»¬å¯ä»¥å‡å°‘å¯¹æ•°æ®åº“çš„å†™å…¥ï¼Œä»è€Œæé«˜æ€§èƒ½ï¼Œå¹¶ä¸”ä»ç„¶ä¿æŒç»Ÿè®¡ä¸Šæœ‰æ•ˆçš„æ•°å­—ã€‚ç„¶è€Œï¼Œä½¿ç”¨è¿™ç§æ¨¡å¼çš„ä»£ä»·æ˜¯æ²¡æœ‰è¡¨ç¤ºç¡®åˆ‡çš„æ•°å­—ï¼Œå¹¶ä¸”å¿…é¡»åœ¨åº”ç”¨ç¨‹åºæœ¬èº«ä¸­å®Œæˆå®ç°ã€‚</p>
<h3 id="å±æ€§æ¨¡å¼attribute">å±æ€§æ¨¡å¼Attribute<a hidden class="anchor" aria-hidden="true" href="#å±æ€§æ¨¡å¼attribute">#</a></h3>
<p>å±æ€§æ¨¡å¼ç‰¹åˆ«é€‚åˆä»¥ä¸‹æƒ…å†µï¼š</p>
<ul>
<li>æˆ‘ä»¬æœ‰åŒ…å«è®¸å¤šç›¸ä¼¼å­—æ®µçš„å¤§å‹æ–‡æ¡£ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå…·æœ‰å…±åŒç‰¹å¾çš„å­—æ®µå­é›†ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹è¯¥å­—æ®µå­é›†è¿›è¡Œæ’åºæˆ–æŸ¥è¯¢ï¼Œ<em>æˆ–è€…</em></li>
<li>æˆ‘ä»¬éœ€è¦æ’åºçš„å­—æ®µåªèƒ½åœ¨ä¸€å°éƒ¨åˆ†æ–‡æ¡£ä¸­æ‰¾åˆ°ï¼Œ<em>æˆ–è€…</em></li>
<li>ä¸Šè¿°ä¸¤ä¸ªæ¡ä»¶éƒ½åœ¨æ–‡ä»¶ä¸­å¾—åˆ°æ»¡è¶³ã€‚</li>
</ul>
<p>å‡ºäºæ€§èƒ½åŸå› ï¼Œä¸ºäº†ä¼˜åŒ–æˆ‘ä»¬çš„æœç´¢ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦è®¸å¤šç´¢å¼•æ¥è§£é‡Šæ‰€æœ‰å­é›†ã€‚åˆ›å»ºæ‰€æœ‰è¿™äº›ç´¢å¼•å¯èƒ½ä¼šé™ä½æ€§èƒ½ã€‚å±æ€§æ¨¡å¼ä¸ºè¿™äº›æƒ…å†µæä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h4 id="å±æ€§æ¨¡å¼">å±æ€§æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#å±æ€§æ¨¡å¼">#</a></h4>
<p>è®©æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹ç”µå½±çš„é›†åˆã€‚è¿™äº›æ–‡æ¡£å¯èƒ½åœ¨æ‰€æœ‰æ–‡æ¡£ä¸­éƒ½æ¶‰åŠç±»ä¼¼çš„å­—æ®µï¼šæ ‡é¢˜ã€å¯¼æ¼”ã€åˆ¶ç‰‡äººã€æ¼”å‘˜ç­‰ã€‚å‡è®¾æˆ‘ä»¬è¦æœç´¢å‘å¸ƒæ—¥æœŸã€‚è¿™æ ·åšæ—¶æˆ‘ä»¬é¢ä¸´çš„ä¸€ä¸ªæŒ‘æˆ˜æ˜¯<em>å“ªä¸ª</em>å‘å¸ƒæ—¥æœŸï¼Ÿç”µå½±é€šå¸¸åœ¨ä¸åŒå›½å®¶çš„ä¸åŒæ—¥æœŸä¸Šæ˜ ã€‚</p>
<pre tabindex="0"><code>{
    title: &#34;Star Wars&#34;,
    director: &#34;George Lucas&#34;,
    ...
    release_US: ISODate(&#34;1977-05-20T01:00:00+01:00&#34;),
    release_France: ISODate(&#34;1977-10-19T01:00:00+01:00&#34;),
    release_Italy: ISODate(&#34;1977-10-20T01:00:00+01:00&#34;),
    release_UK: ISODate(&#34;1977-12-27T01:00:00+01:00&#34;),
    ...
}
</code></pre><p>æœç´¢å‘å¸ƒæ—¥æœŸéœ€è¦åŒæ—¶æŸ¥çœ‹å¤šä¸ªå­—æ®µã€‚ä¸ºäº†å¿«é€Ÿæœç´¢ä¸Šæ˜ æ—¥æœŸï¼Œæˆ‘ä»¬çš„ç”µå½±æ”¶è—éœ€è¦å‡ ä¸ªç´¢å¼•ï¼š</p>
<pre tabindex="0"><code>{release_US: 1}
{release_France: 1}
{release_Italy: 1}
...
</code></pre><p>é€šè¿‡ä½¿ç”¨å±æ€§æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªä¿¡æ¯å­é›†ç§»åŠ¨åˆ°ä¸€ä¸ªæ•°ç»„ä¸­å¹¶å‡å°‘ç´¢å¼•éœ€æ±‚ã€‚æˆ‘ä»¬å°†æ­¤ä¿¡æ¯è½¬æ¢ä¸ºé”®å€¼å¯¹æ•°ç»„ï¼š</p>
<pre tabindex="0"><code>{
    title: &#34;Star Wars&#34;,
    director: &#34;George Lucas&#34;,
    â€¦
    releases: [
        {
        location: &#34;USA&#34;,
        date: ISODate(&#34;1977-05-20T01:00:00+01:00&#34;)
        },
        {
        location: &#34;France&#34;,
        date: ISODate(&#34;1977-10-19T01:00:00+01:00&#34;)
        },
        {
        location: &#34;Italy&#34;,
        date: ISODate(&#34;1977-10-20T01:00:00+01:00&#34;)
        },
        {
        location: &#34;UK&#34;,
        date: ISODate(&#34;1977-12-27T01:00:00+01:00&#34;)
        },
        â€¦ 
    ],
    â€¦ 
}
</code></pre><p>é€šè¿‡åœ¨æ•°ç»„ä¸­çš„å…ƒç´ ä¸Šåˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œç´¢å¼•å˜å¾—æ›´æ˜“äºç®¡ç†ï¼š</p>
<pre tabindex="0"><code>{ &#34;releases.location&#34;: 1, &#34;releases.date&#34;: 1}
</code></pre><p>é€šè¿‡ä½¿ç”¨å±æ€§æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºæˆ‘ä»¬çš„æ–‡æ¡£æ·»åŠ ç»„ç»‡ä»¥è·å–å¸¸è§ç‰¹å¾å¹¶è§£é‡Šç¨€æœ‰/ä¸å¯é¢„æµ‹çš„å­—æ®µã€‚ä¾‹å¦‚ï¼Œåœ¨æ–°çš„æˆ–å°å‹çš„ç”µå½±èŠ‚ä¸Šä¸Šæ˜ çš„ç”µå½±ã€‚æ­¤å¤–ï¼Œè½¬å‘é”®/å€¼çº¦å®šå…è®¸ä½¿ç”¨éç¡®å®šæ€§å‘½åå’Œè½»æ¾æ·»åŠ é™å®šç¬¦ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬çš„æ•°æ®æ”¶é›†æ˜¯å…³äºç“¶è£…æ°´ï¼Œæˆ‘ä»¬çš„å±æ€§å¯èƒ½ç±»ä¼¼äºï¼š</p>
<pre tabindex="0"><code>&#34;specs&#34;: [
    { k: &#34;volume&#34;, v: &#34;500&#34;, u: &#34;ml&#34; },
    { k: &#34;volume&#34;, v: &#34;12&#34;, u: &#34;ounces&#34; }
]
</code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä¿¡æ¯åˆ†è§£ä¸ºé”®å’Œå€¼ï¼Œâ€œkâ€å’Œâ€œvâ€ï¼Œå¹¶æ·»åŠ ç¬¬ä¸‰ä¸ªå­—æ®µâ€œuâ€ï¼Œå®ƒå…è®¸å•ç‹¬å­˜å‚¨åº¦é‡å•ä½ã€‚</p>
<pre tabindex="0"><code>{&#34;specks.k&#34;: 1, &#34;specs.v&#34;: 1, &#34;specs.u&#34;: 1}
</code></pre><h4 id="ç¤ºä¾‹ç”¨ä¾‹-1">ç¤ºä¾‹ç”¨ä¾‹<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹ç”¨ä¾‹-1">#</a></h4>
<p>å±æ€§æ¨¡å¼éå¸¸é€‚åˆå…·æœ‰ç›¸åŒå€¼ç±»å‹çš„å­—æ®µé›†çš„æ¨¡å¼ï¼Œä¾‹å¦‚æ—¥æœŸåˆ—è¡¨ã€‚åœ¨å¤„ç†äº§å“ç‰¹æ€§æ—¶ï¼Œå®ƒä¹Ÿèƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚æŸäº›äº§å“ï¼ˆä¾‹å¦‚æœè£…ï¼‰çš„å°ºå¯¸å¯èƒ½ä»¥å°å·ã€ä¸­å·æˆ–å¤§å·è¡¨ç¤ºã€‚åŒä¸€é›†åˆä¸­çš„å…¶ä»–äº§å“å¯èƒ½ä»¥æ•°é‡è¡¨ç¤ºã€‚è¿˜æœ‰ä¸€äº›å¯ä»¥ç”¨ç‰©ç†å°ºå¯¸æˆ–é‡é‡æ¥è¡¨ç¤ºã€‚</p>
<p>èµ„äº§ç®¡ç†é¢†åŸŸçš„ä¸€ä½å®¢æˆ·æœ€è¿‘ä½¿ç”¨å±æ€§æ¨¡å¼éƒ¨ç½²äº†ä»–ä»¬çš„è§£å†³æ–¹æ¡ˆã€‚å®¢æˆ·ä½¿ç”¨è¯¥æ¨¡å¼æ¥å­˜å‚¨ç»™å®šèµ„äº§çš„æ‰€æœ‰ç‰¹å¾ã€‚è¿™äº›ç‰¹å¾åœ¨èµ„äº§ä¸­å¾ˆå°‘å¸¸è§ï¼Œæˆ–è€…åœ¨è®¾è®¡æ—¶å¾ˆéš¾é¢„æµ‹ã€‚å…³ç³»æ¨¡å‹é€šå¸¸ä½¿ç”¨å¤æ‚çš„è®¾è®¡è¿‡ç¨‹ä»¥<a href="https://martinfowler.com/bliki/UserDefinedField.html">ç”¨æˆ·å®šä¹‰å­—æ®µ</a>çš„å½¢å¼è¡¨è¾¾ç›¸åŒçš„æƒ³æ³•ã€‚</p>
<p>è™½ç„¶äº§å“ç›®å½•ä¸­çš„è®¸å¤šå­—æ®µç›¸ä¼¼ï¼Œä¾‹å¦‚åç§°ã€ä¾›åº”å•†ã€åˆ¶é€ å•†ã€åŸäº§å›½ç­‰ï¼Œä½†é¡¹ç›®çš„è§„æ ¼æˆ–å±æ€§å¯èƒ½ä¸åŒã€‚å¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºå’Œæ•°æ®è®¿é—®æ¨¡å¼ä¾èµ–äºåŒæ—¶æœç´¢è®¸å¤šä¸åŒçš„å­—æ®µï¼Œåˆ™å±æ€§æ¨¡å¼ä¸ºæ•°æ®æä¾›äº†è‰¯å¥½çš„ç»“æ„ã€‚</p>
<h4 id="ç»“è®º-1">ç»“è®º<a hidden class="anchor" aria-hidden="true" href="#ç»“è®º-1">#</a></h4>
<p>å±æ€§æ¨¡å¼æä¾›äº†æ›´è½»æ¾çš„æ–‡æ¡£ç´¢å¼•ï¼Œé’ˆå¯¹æ¯ä¸ªæ–‡æ¡£çš„è®¸å¤šç›¸ä¼¼å­—æ®µã€‚é€šè¿‡å°†è¿™ä¸ªæ•°æ®å­é›†ç§»åŠ¨åˆ°ä¸€ä¸ªé”®å€¼å­æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨éç¡®å®šæ€§çš„å­—æ®µåç§°ï¼Œä¸ºä¿¡æ¯æ·»åŠ é¢å¤–çš„é™å®šç¬¦ï¼Œæ›´æ¸…æ¥šåœ°è¯´æ˜åŸå§‹å­—æ®µå’Œå€¼çš„å…³ç³»ã€‚å½“æˆ‘ä»¬ä½¿ç”¨å±æ€§æ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ›´å°‘çš„ç´¢å¼•ï¼Œæˆ‘ä»¬çš„æŸ¥è¯¢å˜å¾—æ›´å®¹æ˜“ç¼–å†™ï¼Œæˆ‘ä»¬çš„æŸ¥è¯¢å˜å¾—æ›´å¿«ã€‚</p>
<h3 id="æ¡¶æ¨¡å¼-bucket">æ¡¶æ¨¡å¼ Bucket<a hidden class="anchor" aria-hidden="true" href="#æ¡¶æ¨¡å¼-bucket">#</a></h3>
<p>è¿™ç§æ¨¡å¼åœ¨å¤„ç†ç‰©è”ç½‘ (IoT)ã€å®æ—¶åˆ†ææˆ–ä¸€èˆ¬æ—¶é—´åºåˆ—æ•°æ®æ—¶ç‰¹åˆ«æœ‰æ•ˆã€‚é€šè¿‡<em>å°†</em>æ•°æ®åˆ†ç»„åœ¨ä¸€èµ·ï¼Œæˆ‘ä»¬å¯ä»¥æ›´è½»æ¾åœ°ç»„ç»‡ç‰¹å®šçš„æ•°æ®ç»„ï¼Œæé«˜å‘ç°å†å²è¶‹åŠ¿æˆ–æä¾›æœªæ¥é¢„æµ‹çš„èƒ½åŠ›ï¼Œå¹¶ä¼˜åŒ–æˆ‘ä»¬å¯¹å­˜å‚¨çš„ä½¿ç”¨ã€‚</p>
<h4 id="æ¡¶æ¨¡å¼">æ¡¶æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#æ¡¶æ¨¡å¼">#</a></h4>
<p>éšç€ä¸€æ®µæ—¶é—´å†…çš„æ•°æ®æµï¼ˆæ—¶é—´åºåˆ—æ•°æ®ï¼‰è¿›å…¥ï¼Œæˆ‘ä»¬å¯èƒ½å€¾å‘äºå°†æ¯ä¸ªæµ‹é‡å€¼å­˜å‚¨åœ¨è‡ªå·±çš„æ–‡æ¡£ä¸­ã€‚ç„¶è€Œï¼Œè¿™ç§å€¾å‘æ˜¯å¤„ç†æ•°æ®çš„ä¸€ç§éå¸¸ç›¸å…³çš„æ–¹æ³•ã€‚å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªä¼ æ„Ÿå™¨æ¯åˆ†é’Ÿæµ‹é‡ä¸€æ¬¡æ¸©åº¦å¹¶å°†å…¶ä¿å­˜åˆ°æ•°æ®åº“ä¸­ï¼Œæˆ‘ä»¬çš„æ•°æ®æµå¯èƒ½ç±»ä¼¼äºï¼š</p>
<pre tabindex="0"><code>{
   sensor_id: 12345,
   timestamp: ISODate(&#34;2019-01-31T10:00:00.000Z&#34;),
   temperature: 40
}

{
   sensor_id: 12345,
   timestamp: ISODate(&#34;2019-01-31T10:01:00.000Z&#34;),
   temperature: 40
}

{
   sensor_id: 12345,
   timestamp: ISODate(&#34;2019-01-31T10:02:00.000Z&#34;),
   temperature: 41
}
</code></pre><p>éšç€æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåœ¨æ•°æ®å’Œç´¢å¼•å¤§å°æ–¹é¢çš„æ‰©å±•ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ€ç»ˆå¯èƒ½ä¸å¾—ä¸ä¸ºæ¯ä¸€ä¸ªå•ç‹¬çš„æµ‹é‡å»ºç«‹ç´¢å¼•<code>sensor_id</code>ï¼Œ<code>timestamp</code>ä»¥ä¾¿ä»¥ RAM ä¸ºä»£ä»·å®ç°å¿«é€Ÿè®¿é—®ã€‚ä½†æ˜¯ï¼Œé€šè¿‡åˆ©ç”¨æ–‡æ¡£æ•°æ®æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰æ—¶é—´å°†è¿™äº›æ•°æ®â€œå­˜å‚¨â€åˆ°åŒ…å«ç‰¹å®šæ—¶é—´è·¨åº¦çš„æµ‹é‡å€¼çš„æ–‡æ¡£ä¸­ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä»¥ç¼–ç¨‹æ–¹å¼å‘è¿™äº›â€œæ¡¶â€ä¸­çš„æ¯ä¸€ä¸ªæ·»åŠ é™„åŠ ä¿¡æ¯ã€‚</p>
<p>é€šè¿‡å°†æ¡¶æ¨¡å¼åº”ç”¨äºæˆ‘ä»¬çš„æ•°æ®æ¨¡å‹ï¼Œæˆ‘ä»¬åœ¨èŠ‚çœç´¢å¼•å¤§å°ã€æ½œåœ¨çš„æŸ¥è¯¢ç®€åŒ–ä»¥åŠåœ¨æ–‡æ¡£ä¸­ä½¿ç”¨é¢„èšåˆæ•°æ®çš„èƒ½åŠ›æ–¹é¢è·å¾—äº†ä¸€äº›å¥½å¤„ã€‚ä»ä¸Šé¢è·å–æ•°æ®æµå¹¶å°† Bucket Pattern åº”ç”¨åˆ°å®ƒï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šå¾—åˆ°ï¼š</p>
<pre tabindex="0"><code>{
    sensor_id: 12345,
    start_date: ISODate(&#34;2019-01-31T10:00:00.000Z&#34;),
    end_date: ISODate(&#34;2019-01-31T10:59:59.000Z&#34;),
    measurements: [
       {
       timestamp: ISODate(&#34;2019-01-31T10:00:00.000Z&#34;),
       temperature: 40
       },
       {
       timestamp: ISODate(&#34;2019-01-31T10:01:00.000Z&#34;),
       temperature: 40
       },
       â€¦ 
       {
       timestamp: ISODate(&#34;2019-01-31T10:42:00.000Z&#34;),
       temperature: 42
       }
    ],
   transaction_count: 42,
   sum_temperature: 2413
} 
</code></pre><p>é€šè¿‡ä½¿ç”¨å­˜å‚¨æ¡¶æ¨¡å¼ï¼Œæˆ‘ä»¬å°†æ•°æ®â€œå­˜å‚¨â€åˆ°äº†ä¸€ä¸ªä¸€å°æ—¶çš„å­˜å‚¨æ¡¶ä¸­ã€‚è¿™ä¸ªç‰¹å®šçš„æ•°æ®æµä»ç„¶ä¼šå¢é•¿ï¼Œå› ä¸ºå®ƒç›®å‰åªæœ‰ 42 ä¸ªæµ‹é‡å€¼ï¼›è¯¥å°æ—¶è¿˜æœ‰æ›´å¤šæµ‹é‡å€¼è¦æ·»åŠ åˆ°â€œå­˜å‚¨æ¡¶â€ä¸­ã€‚å½“å®ƒä»¬è¢«æ·»åŠ åˆ°<code>measurements</code>æ•°ç»„ä¸­æ—¶ï¼Œ<code>transaction_count</code>å°†å¢åŠ å¹¶ä¸”<code>sum_temperature</code>ä¹Ÿå°†è¢«æ›´æ–°ã€‚</p>
<p>ä½¿ç”¨é¢„å…ˆæ±‡æ€»çš„<code>sum_temperature</code>å€¼ï¼Œå°±å¯ä»¥è½»æ¾åœ°æ‹‰èµ·ç‰¹å®šçš„æ¡¶å¹¶ç¡®å®šè¯¥æ¡¶çš„å¹³å‡æ¸©åº¦ ( <code>sum_temperature / transaction_count</code>)ã€‚åœ¨å¤„ç†æ—¶é—´åºåˆ—æ•°æ®æ—¶ï¼Œäº†è§£ 2018 å¹´ 7 æœˆ 13 æ—¥åŠ åˆ©ç¦å°¼äºšå·åº·å®å¸‚ä¸‹åˆ 2:00 è‡³ä¸‹åˆ 3:00 çš„å¹³å‡æ¸©åº¦é€šå¸¸æ¯”äº†è§£ä¸‹åˆ 2:03 çš„æ¸©åº¦æ›´æœ‰è¶£å’Œé‡è¦ã€‚é€šè¿‡åˆ†æ¡¶å’Œè¿›è¡Œé¢„èšåˆï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´è½»æ¾åœ°æä¾›è¯¥ä¿¡æ¯ã€‚</p>
<p>æ­¤å¤–ï¼Œéšç€æˆ‘ä»¬æ”¶é›†è¶Šæ¥è¶Šå¤šçš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šç¡®å®šå°†æ‰€æœ‰æºæ•°æ®ä¿å­˜åœ¨å­˜æ¡£ä¸­ä¼šæ›´æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬éœ€è¦å¤šä¹…è·å–ä¸€æ¬¡åº·å® 1948 å¹´ä»¥æ¥çš„æ¸©åº¦ï¼Ÿèƒ½å¤Ÿå°†è¿™äº›æ•°æ®æ¡¶ç§»åŠ¨åˆ°æ•°æ®å­˜æ¡£ä¸­å¯èƒ½æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å¥½å¤„ã€‚</p>
<h4 id="ç¤ºä¾‹ç”¨ä¾‹-2">ç¤ºä¾‹ç”¨ä¾‹<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹ç”¨ä¾‹-2">#</a></h4>
<p>ä½¿æ—¶é—´åºåˆ—æ•°æ®åœ¨ç°å®ä¸–ç•Œä¸­æœ‰ä»·å€¼çš„ä¸€ä¸ªä¾‹å­æ¥è‡ª<a href="https://www.mongodb.com/customers/bosch">åšä¸–çš„ç‰©è”ç½‘å®æ–½</a>ã€‚ä»–ä»¬åœ¨æ±½è½¦ç°åœºæ•°æ®åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ MongoDB å’Œæ—¶é—´åºåˆ—æ•°æ®ã€‚è¯¥åº”ç”¨ç¨‹åºä»æ•´ä¸ªè½¦è¾†çš„å„ç§ä¼ æ„Ÿå™¨æ•è·æ•°æ®ï¼Œä»è€Œæ”¹è¿›å¯¹è½¦è¾†æœ¬èº«å’Œç»„ä»¶æ€§èƒ½çš„è¯Šæ–­ã€‚</p>
<p>å…¶ä»–ç¤ºä¾‹åŒ…æ‹¬å·²å°†è¿™ç§æ¨¡å¼çº³å…¥é‡‘èåº”ç”¨ç¨‹åºä»¥å°†äº¤æ˜“ç»„åˆåœ¨ä¸€èµ·çš„ä¸»è¦é“¶è¡Œã€‚</p>
<h4 id="ç»“è®º-2">ç»“è®º<a hidden class="anchor" aria-hidden="true" href="#ç»“è®º-2">#</a></h4>
<p>åœ¨å¤„ç†æ—¶é—´åºåˆ—æ•°æ®æ—¶ï¼Œåœ¨ MongoDB ä¸­ä½¿ç”¨ Bucket Pattern æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å®ƒå‡å°‘äº†é›†åˆä¸­çš„æ–‡æ¡£æ€»æ•°ï¼Œæé«˜äº†ç´¢å¼•æ€§èƒ½ï¼Œå¹¶ä¸”é€šè¿‡åˆ©ç”¨é¢„èšåˆï¼Œå®ƒå¯ä»¥ç®€åŒ–æ•°æ®è®¿é—®ã€‚</p>
<h3 id="è®¡ç®—æ¨¡å¼computed">è®¡ç®—æ¨¡å¼Computed<a hidden class="anchor" aria-hidden="true" href="#è®¡ç®—æ¨¡å¼computed">#</a></h3>
<p>*æˆ‘ä»¬å·²ç»ç ”ç©¶äº†åœ¨â€œä½¿ç”¨æ¨¡å¼æ„å»ºâ€*ç³»åˆ—ä¸­ä¼˜åŒ–å­˜å‚¨æ•°æ®çš„å„ç§æ–¹æ³•ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†ç ”ç©¶æ¨¡å¼è®¾è®¡çš„ä¸åŒæ–¹é¢ã€‚é€šå¸¸ï¼Œä»…å­˜å‚¨æ•°æ®å¹¶ä½¿å…¶å¯ç”¨å¹¶ä¸æ˜¯é‚£ä¹ˆæœ‰ç”¨ã€‚å½“æˆ‘ä»¬å¯ä»¥ä»ä¸­è®¡ç®—å€¼æ—¶ï¼Œæ•°æ®çš„æœ‰ç”¨æ€§å˜å¾—æ›´åŠ æ˜æ˜¾ã€‚æœ€æ–°çš„äºšé©¬é€Š Alexa çš„æ€»é”€å”®æ”¶å…¥æ˜¯å¤šå°‘ï¼Ÿæœ‰å¤šå°‘è§‚ä¼—è§‚çœ‹äº†æœ€æ–°çš„å¤§ç‰‡ï¼Ÿè¿™äº›ç±»å‹çš„é—®é¢˜å¯ä»¥ä»å­˜å‚¨åœ¨æ•°æ®åº“ä¸­çš„æ•°æ®ä¸­å›ç­”ï¼Œä½†å¿…é¡»è¿›è¡Œè®¡ç®—ã€‚</p>
<p>æ¯æ¬¡è¯·æ±‚æ—¶éƒ½è¿è¡Œè¿™äº›è®¡ç®—æˆä¸ºä¸€ä¸ªé«˜åº¦èµ„æºå¯†é›†å‹çš„è¿‡ç¨‹ï¼Œå°¤å…¶æ˜¯åœ¨å·¨å¤§çš„æ•°æ®é›†ä¸Šã€‚CPU å‘¨æœŸã€ç£ç›˜è®¿é—®ã€å†…å­˜éƒ½å¯èƒ½æ¶‰åŠã€‚</p>
<p>æƒ³ä¸€æƒ³ç”µå½±ä¿¡æ¯ Web åº”ç”¨ç¨‹åºã€‚æ¯æ¬¡æˆ‘ä»¬è®¿é—®è¯¥åº”ç”¨ç¨‹åºæŸ¥æ‰¾ç”µå½±æ—¶ï¼Œè¯¥é¡µé¢éƒ½ä¼šæä¾›æœ‰å…³è¯¥ç”µå½±å·²æ’­æ”¾çš„ç”µå½±é™¢æ•°é‡ã€è§‚çœ‹è¯¥ç”µå½±çš„æ€»äººæ•°ä»¥åŠæ€»æ”¶å…¥çš„ä¿¡æ¯ã€‚å¦‚æœåº”ç”¨ç¨‹åºå¿…é¡»ä¸ºæ¯æ¬¡é¡µé¢è®¿é—®ä¸æ–­è®¡ç®—è¿™äº›å€¼ï¼Œå®ƒå¯èƒ½ä¼šåœ¨æµè¡Œç”µå½±ä¸Šä½¿ç”¨å¤§é‡å¤„ç†èµ„æº</p>
<p>ç„¶è€Œï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“è¿™äº›ç¡®åˆ‡çš„æ•°å­—ã€‚æˆ‘ä»¬å¯ä»¥åœ¨åå°è¿›è¡Œè®¡ç®—å¹¶å¶å°”æ›´æ–°ä¸»ç”µå½±ä¿¡æ¯æ–‡æ¡£ã€‚ç„¶åï¼Œè¿™äº›<em>è®¡ç®—</em>ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ˜¾ç¤ºæ•°æ®çš„æœ‰æ•ˆè¡¨ç¤ºï¼Œè€Œæ— éœ€åœ¨ CPU ä¸Šä»˜å‡ºé¢å¤–çš„åŠªåŠ›ã€‚</p>
<h4 id="è®¡ç®—æ¨¡å¼">è®¡ç®—æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#è®¡ç®—æ¨¡å¼">#</a></h4>
<p>å½“æˆ‘ä»¬æœ‰éœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­é‡å¤è®¡ç®—çš„æ•°æ®æ—¶ï¼Œå°±ä¼šä½¿ç”¨è®¡ç®—æ¨¡å¼ã€‚å½“æ•°æ®è®¿é—®æ¨¡å¼æ˜¯è¯»å–å¯†é›†å‹æ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨è®¡ç®—æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ¯å°æ—¶æœ‰ 1,000,000 æ¬¡è¯»å–ï¼Œä½†æ¯å°æ—¶åªæœ‰ 1,000 æ¬¡å†™å…¥ï¼Œåˆ™åœ¨å†™å…¥æ—¶è¿›è¡Œè®¡ç®—ä¼šå°†è®¡ç®—æ¬¡æ•°é™¤ä»¥ 1000ã€‚</p>
<p><a href="https://webassets.mongodb.com/_com_assets/cms/cpucomputed-fbcpkmvbsy.png"><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/cpucomputed-fbcpkmvbsy.png" alt="è¿è¡Œä¸­çš„è®¡ç®—æ¨¡å¼"  />
</a></p>
<p>åœ¨æˆ‘ä»¬çš„ç”µå½±æ•°æ®åº“ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®æˆ‘ä»¬å¯¹ç‰¹å®šç”µå½±çš„æ‰€æœ‰æ”¾æ˜ ä¿¡æ¯è¿›è¡Œè®¡ç®—ï¼Œè®¡ç®—ç»“æœï¼Œå¹¶å°†å®ƒä»¬ä¸ç”µå½±æœ¬èº«çš„ä¿¡æ¯ä¸€èµ·å­˜å‚¨ã€‚åœ¨ä½å†™å…¥ç¯å¢ƒä¸­ï¼Œå¯ä»¥ç»“åˆæºæ•°æ®çš„ä»»ä½•æ›´æ–°æ¥å®Œæˆè®¡ç®—ã€‚åœ¨æœ‰æ›´å¤šå®šæœŸå†™å…¥çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æŒ‰å®šä¹‰çš„æ—¶é—´é—´éš”è¿›è¡Œè®¡ç®— - ä¾‹å¦‚æ¯å°æ—¶ã€‚ç”±äºæˆ‘ä»¬ä¸ä¼šå¹²æ‰°ç­›é€‰ä¿¡æ¯ä¸­çš„æºæ•°æ®ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨ä»»ä½•æ—¶é—´ç‚¹ç»§ç»­é‡æ–°è¿è¡Œç°æœ‰è®¡ç®—æˆ–è¿è¡Œæ–°è®¡ç®—ï¼Œå¹¶ä¸”çŸ¥é“æˆ‘ä»¬ä¼šå¾—åˆ°æ­£ç¡®çš„ç»“æœã€‚</p>
<p>æ‰§è¡Œè®¡ç®—çš„å…¶ä»–ç­–ç•¥å¯èƒ½æ¶‰åŠï¼Œä¾‹å¦‚ï¼Œå‘æ–‡æ¡£æ·»åŠ æ—¶é—´æˆ³ä»¥æŒ‡ç¤ºå…¶ä¸Šæ¬¡æ›´æ–°æ—¶é—´ã€‚ç„¶ååº”ç”¨ç¨‹åºå¯ä»¥ç¡®å®šä½•æ—¶éœ€è¦è¿›è¡Œè®¡ç®—ã€‚å¦ä¸€ç§é€‰æ‹©å¯èƒ½æ˜¯æœ‰ä¸€ä¸ªéœ€è¦å®Œæˆçš„è®¡ç®—é˜Ÿåˆ—ã€‚é€‰æ‹©æ›´æ–°ç­–ç•¥æœ€å¥½ç•™ç»™åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ã€‚</p>
<h4 id="ç¤ºä¾‹ç”¨ä¾‹-3">ç¤ºä¾‹ç”¨ä¾‹<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹ç”¨ä¾‹-3">#</a></h4>
<p><em>è®¡ç®—æ¨¡å¼</em>å¯ç”¨äºéœ€è¦å¯¹æ•°æ®è¿›è¡Œè®¡ç®—çš„ä»»ä½•åœ°æ–¹ã€‚éœ€è¦æ€»å’Œçš„æ•°æ®é›†ï¼ˆä¾‹å¦‚æ”¶å…¥æˆ–è§‚ä¼—ï¼‰å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ï¼Œä½†æ—¶é—´åºåˆ—æ•°æ®ã€äº§å“ç›®å½•ã€å•ä¸€è§†å›¾åº”ç”¨ç¨‹åºå’Œäº‹ä»¶æº¯æºä¹Ÿæ˜¯è¿™ç§æ¨¡å¼çš„ä¸»è¦å€™é€‰è€…ã€‚</p>
<p>è¿™æ˜¯è®¸å¤šå®¢æˆ·å·²ç»å®æ–½çš„æ¨¡å¼ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·å¯¹è½¦è¾†æ•°æ®è¿›è¡Œå¤§é‡èšåˆæŸ¥è¯¢ï¼Œå¹¶å°†ç»“æœå­˜å‚¨ç»™æœåŠ¡å™¨ä»¥æ˜¾ç¤ºæ¥ä¸‹æ¥å‡ ä¸ªå°æ—¶çš„ä¿¡æ¯ã€‚</p>
<p>ä¸€å®¶å‡ºç‰ˆå…¬å¸ç¼–è¯‘æ‰€æœ‰ç±»å‹çš„æ•°æ®ä»¥åˆ›å»ºåƒâ€œ100 Best &hellip;â€è¿™æ ·çš„æœ‰åºåˆ—è¡¨ã€‚è¿™äº›åˆ—è¡¨åªéœ€è¦å¶å°”é‡æ–°ç”Ÿæˆä¸€æ¬¡ï¼Œè€ŒåŸºç¡€æ•°æ®å¯èƒ½ä¼šåœ¨å…¶ä»–æ—¶é—´æ›´æ–°ã€‚</p>
<h4 id="ç»“è®º-3">ç»“è®º<a hidden class="anchor" aria-hidden="true" href="#ç»“è®º-3">#</a></h4>
<p>è¿™ç§å¼ºå¤§çš„è®¾è®¡æ¨¡å¼å¯ä»¥å‡å°‘ CPU å·¥ä½œé‡å¹¶æé«˜åº”ç”¨ç¨‹åºæ€§èƒ½ã€‚å®ƒå¯ç”¨äºå¯¹é›†åˆä¸­çš„æ•°æ®è¿›è¡Œè®¡ç®—æˆ–æ“ä½œï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨æ–‡æ¡£ä¸­ã€‚è¿™å…è®¸é¿å…é‡å¤è¿›è¡Œç›¸åŒçš„è®¡ç®—ã€‚æ¯å½“æ‚¨çš„ç³»ç»Ÿé‡å¤æ‰§è¡Œç›¸åŒçš„è®¡ç®—å¹¶ä¸”æ‚¨å…·æœ‰è¾ƒé«˜çš„è¯»å†™æ¯”ç‡æ—¶ï¼Œè¯·è€ƒè™‘<em>Computed Pattern</em>ã€‚</p>
<h3 id="æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼-document-versioning">æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼ Document Versioning<a hidden class="anchor" aria-hidden="true" href="#æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼-document-versioning">#</a></h3>
<p>æ•°æ®åº“ï¼Œå¦‚ MongoDBï¼Œéå¸¸æ“…é•¿æŸ¥è¯¢å¤§é‡æ•°æ®å¹¶ç»å¸¸æ›´æ–°è¿™äº›æ•°æ®ã€‚ç„¶è€Œï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªå¯¹æ•°æ®çš„æœ€æ–°çŠ¶æ€æ‰§è¡ŒæŸ¥è¯¢ã€‚æˆ‘ä»¬éœ€è¦æŸ¥è¯¢æ•°æ®çš„<em>å…ˆå‰</em>çŠ¶æ€çš„æƒ…å†µå‘¢ï¼Ÿå¦‚æœæˆ‘ä»¬éœ€è¦å¯¹æ–‡æ¡£è¿›è¡Œç‰ˆæœ¬æ§åˆ¶æ€ä¹ˆåŠï¼Ÿè¿™æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼çš„åœ°æ–¹ã€‚</p>
<p>è¿™ç§æ¨¡å¼æ˜¯å…³äºä¿æŒæ–‡æ¡£çš„ç‰ˆæœ¬å†å²å¯ç”¨å’Œå¯ç”¨ã€‚æˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªç³»ç»Ÿï¼Œå°†ä¸“ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸ MongoDB ç»“åˆä½¿ç”¨ã€‚ä¸€ä¸ªç³»ç»Ÿç”¨äºå°‘æ•°æ›´æ”¹çš„æ–‡æ¡£ï¼Œè€Œ MongoDB ç”¨äºå…¶ä»–æ–‡æ¡£ã€‚è¿™å¯èƒ½ä¼šå¾ˆéº»çƒ¦ã€‚ç„¶è€Œï¼Œé€šè¿‡ä½¿ç”¨æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé¿å…ä½¿ç”¨å¤šä¸ªç³»ç»Ÿæ¥ç®¡ç†å½“å‰æ–‡æ¡£åŠå…¶å†å²è®°å½•ï¼Œæ–¹æ³•æ˜¯å°†å®ƒä»¬ä¿å­˜åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­ã€‚</p>
<h4 id="æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼">æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼">#</a></h4>
<p>è¿™ç§æ¨¡å¼è§£å†³äº†å¸Œæœ›åœ¨ MongoDB ä¸­ä¿ç•™æŸäº›æ–‡æ¡£çš„æ—§ç‰ˆæœ¬è€Œä¸æ˜¯å¼•å…¥ç¬¬äºŒä¸ªç®¡ç†ç³»ç»Ÿçš„é—®é¢˜ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å‘æ¯ä¸ªæ–‡æ¡£æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œä»¥ä¾¿æˆ‘ä»¬è·Ÿè¸ªæ–‡æ¡£ç‰ˆæœ¬ã€‚ç„¶åæ•°æ®åº“å°†æœ‰ä¸¤ä¸ªé›†åˆï¼šä¸€ä¸ªåŒ…å«æœ€æ–°ï¼ˆå’ŒæŸ¥è¯¢æœ€å¤šçš„æ•°æ®ï¼‰ï¼Œå¦ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ•°æ®çš„ä¿®è®¢ã€‚</p>
<p>æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼å¯¹æ•°æ®åº“ä¸­çš„æ•°æ®å’Œåº”ç”¨ç¨‹åºæ‰€åšçš„æ•°æ®è®¿é—®æ¨¡å¼åšäº†ä¸€äº›å‡è®¾ã€‚</p>
<ol>
<li>æ¯ä¸ªæ–‡æ¡£æ²¡æœ‰å¤ªå¤šçš„ä¿®è®¢ã€‚</li>
<li>æ²¡æœ‰å¤ªå¤šè¦ç‰ˆæœ¬çš„æ–‡æ¡£ã€‚</li>
<li>æ‰§è¡Œçš„å¤§å¤šæ•°æŸ¥è¯¢éƒ½æ˜¯åœ¨æ–‡æ¡£çš„æœ€æ–°ç‰ˆæœ¬ä¸Šå®Œæˆçš„ã€‚</li>
</ol>
<p>å¦‚æœæ‚¨å‘ç°è¿™äº›å‡è®¾ä¸é€‚åˆæ‚¨çš„ç”¨ä¾‹ï¼Œåˆ™æ­¤æ¨¡å¼å¯èƒ½ä¸å¤ªé€‚åˆã€‚æ‚¨å¯èƒ½éœ€è¦æ›´æ”¹å®ç°æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼ç‰ˆæœ¬çš„æ–¹å¼ï¼Œæˆ–è€…æ‚¨çš„ç”¨ä¾‹å¯èƒ½åªéœ€è¦ä¸åŒçš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h4 id="ç¤ºä¾‹ç”¨ä¾‹-4">ç¤ºä¾‹ç”¨ä¾‹<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹ç”¨ä¾‹-4">#</a></h4>
<p>æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼åœ¨éœ€è¦ä¸€ç»„æ•°æ®çš„ç‰¹å®šæ—¶é—´ç‚¹ç‰ˆæœ¬çš„é«˜åº¦ç›‘ç®¡è¡Œä¸šä¸­éå¸¸æœ‰ç”¨ã€‚é‡‘èå’ŒåŒ»ç–—ä¿å¥è¡Œä¸šå°±æ˜¯å¾ˆå¥½çš„ä¾‹å­ã€‚ä¿é™©å’Œæ³•å¾‹è¡Œä¸šæ˜¯å…¶ä»–ä¸€äº›è¡Œä¸šã€‚æœ‰è®¸å¤šç”¨ä¾‹å¯ä»¥è·Ÿè¸ªæ•°æ®çš„æŸäº›éƒ¨åˆ†çš„å†å²è®°å½•ã€‚</p>
<p>æƒ³æƒ³ä¿é™©å…¬å¸å¦‚ä½•åˆ©ç”¨è¿™ç§æ¨¡å¼ã€‚æ¯ä¸ªå®¢æˆ·éƒ½æœ‰ä¸€ä¸ªâ€œæ ‡å‡†â€ä¿å•å’Œä¸€ä¸ªç‰¹å®šäºè¯¥å®¢æˆ·çš„ç¬¬äºŒéƒ¨åˆ†ï¼Œå¦‚æœä½ æ„¿æ„çš„è¯ï¼Œä¸€ä¸ªä¿å•é™„åŠ æ¡æ¬¾ã€‚ç¬¬äºŒéƒ¨åˆ†å°†åŒ…å«ä¸€ä»½ä¿å•é™„åŠ é¡¹åˆ—è¡¨å’Œä¸€ä»½æ­£åœ¨æŠ•ä¿çš„ç‰¹å®šé¡¹ç›®åˆ—è¡¨ã€‚éšç€å®¢æˆ·æ›´æ”¹æŠ•ä¿çš„ç‰¹å®šé¡¹ç›®ï¼Œéœ€è¦æ›´æ–°æ­¤ä¿¡æ¯ï¼ŒåŒæ—¶è¿˜éœ€è¦æä¾›å†å²ä¿¡æ¯ã€‚è¿™åœ¨æˆ¿ä¸»æˆ–ç§Ÿæˆ¿è€…ä¿é™©å•ä¸­ç›¸å½“æ™®éã€‚ä¾‹å¦‚ï¼Œå¦‚æœæŸäººæœ‰è¶…å‡ºæ‰€æä¾›çš„å…¸å‹æ‰¿ä¿èŒƒå›´çš„ç‰¹å®šé¡¹ç›®ï¼Œä»–ä»¬å°†ä½œä¸ºé™„åŠ é™©å•ç‹¬åˆ—å‡ºã€‚ä¿é™©å…¬å¸çš„å¦ä¸€ä¸ªç”¨ä¾‹å¯èƒ½æ˜¯ä¿ç•™ä»–ä»¬éšæ—¶é—´é‚®å¯„ç»™å®¢æˆ·çš„â€œæ ‡å‡†ä¿å•â€çš„æ‰€æœ‰ç‰ˆæœ¬ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬çœ‹ä¸€ä¸‹æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼çš„è¦æ±‚ï¼Œè¿™ä¼¼ä¹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç”¨ä¾‹ã€‚ä¿é™©å…¬å¸å¯èƒ½æœ‰å‡ ç™¾ä¸‡å®¢æˆ·ï¼Œå¯¹â€œé™„åŠ â€åˆ—è¡¨çš„ä¿®æ”¹å¯èƒ½ä¸ä¼šå¤ªé¢‘ç¹ï¼Œå¹¶ä¸”å¤§å¤šæ•°å¯¹ä¿å•çš„æœç´¢å°†æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„æ•°æ®åº“ä¸­ï¼Œæ¯ä¸ªå®¢æˆ·å¯èƒ½éƒ½æœ‰ä¸€ä¸ª<code>current_policy</code>æ–‡æ¡£â€”â€”åŒ…å«å®¢æˆ·ç‰¹å®šä¿¡æ¯â€”â€”åœ¨ä¸€ä¸ª<code>current_policies</code>é›†åˆä¸­ï¼Œ<code>policy_revision</code>æ–‡æ¡£åœ¨ä¸€ä¸ª<code>policy_revisions</code>é›†åˆä¸­ã€‚æ­¤å¤–ï¼Œ<code>standard_policy</code>å¯¹äºå¤§å¤šæ•°å®¢æˆ·æ¥è¯´ï¼Œä¼šæœ‰ä¸€ä¸ªç›¸åŒçš„é›†åˆã€‚å½“å®¢æˆ·è´­ä¹°æ–°é¡¹ç›®å¹¶å¸Œæœ›å°†å…¶æ·»åŠ åˆ°ä»–ä»¬çš„ä¿å•ä¸­æ—¶ï¼Œ<code>policy_revision</code>ä¼šä½¿ç”¨è¯¥æ–‡æ¡£åˆ›å»ºä¸€ä¸ªæ–°<code>current_policy</code>æ–‡æ¡£ã€‚ç„¶åå¢åŠ æ–‡æ¡£ä¸­çš„ç‰ˆæœ¬å­—æ®µä»¥å°†å…¶æ ‡è¯†ä¸ºæœ€æ–°ä¿®è®¢å¹¶æ·»åŠ å®¢æˆ·çš„æ›´æ”¹ã€‚</p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/documentversioning0-qex0ek1957.png" alt="åŸæ¥çš„"  />
</p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/document_ver_2a-mw8mlpazzy.png" alt="æ”¿ç­–ä¿®è®¢å’Œç°è¡Œæ”¿ç­–"  />
</p>
<p>æœ€æ–°ç‰ˆæœ¬å°†å­˜å‚¨åœ¨<code>current_policies</code>é›†åˆä¸­ï¼Œæ—§ç‰ˆæœ¬å°†å†™å…¥<code>policy_revisions</code>é›†åˆã€‚<code>current_policy</code>é€šè¿‡åœ¨é›†åˆä¸­ä¿ç•™æœ€æ–°ç‰ˆæœ¬ï¼ŒæŸ¥è¯¢å¯ä»¥ä¿æŒç®€å•ã€‚è¯¥<code>policy_revisions</code>é›†åˆä¹Ÿå¯èƒ½åªä¿ç•™å‡ ä¸ªç‰ˆæœ¬ï¼Œå…·ä½“å–å†³äºæ•°æ®éœ€æ±‚å’Œè¦æ±‚ã€‚</p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/document_ver_3a-nqhnglt0yj.png" alt="æ”¿ç­–ä¿®è®¢å’Œå½“å‰æ”¿ç­–é›†åˆ"  />
</p>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ <em>Middle-earth Insurance</em>å°†<code>standard_policy</code>ä¸ºå…¶å®¢æˆ·æä¾›ä¸€ä¸ªã€‚<em>The Shire</em>çš„æ‰€æœ‰å±…æ°‘éƒ½å°†åˆ†äº«è¿™ä»½ç‰¹å®šçš„æ”¿ç­–æ–‡ä»¶ã€‚Bilbo åœ¨ä»–çš„æ­£å¸¸ä¿é™©èŒƒå›´ä¹‹å¤–è¿˜æœ‰ä¸€äº›ä»–æƒ³è¦æŠ•ä¿çš„ç‰¹å®šäº‹é¡¹ã€‚ä»–çš„<em>ç²¾çµä¹‹å‰‘</em>ï¼Œæœ€ç»ˆï¼Œ<em>ä¸€ç¯</em>è¢«æ·»åŠ åˆ°ä»–çš„æ”¿ç­–ä¸­ã€‚è¿™äº›å°†é©»ç•™åœ¨<code>current_policies</code>é›†åˆä¸­ï¼Œå¹¶ä¸”åœ¨è¿›è¡Œæ›´æ”¹æ—¶ï¼Œ<code>policy_revisions</code>é›†åˆå°†ä¿ç•™æ›´æ”¹çš„å†å²è®°å½•ã€‚</p>
<p>æ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼ç›¸å¯¹å®¹æ˜“å®ç°ã€‚å®ƒå¯ä»¥åœ¨ç°æœ‰ç³»ç»Ÿä¸Šå®ç°ï¼Œè€Œæ— éœ€å¯¹åº”ç”¨ç¨‹åºæˆ–ç°æœ‰æ–‡æ¡£è¿›è¡Œå¤ªå¤šæ›´æ”¹ã€‚æ­¤å¤–ï¼Œè®¿é—®æ–‡æ¡£æœ€æ–°ç‰ˆæœ¬çš„æŸ¥è¯¢ä»ç„¶æœ‰æ•ˆã€‚</p>
<p>è¿™ç§æ¨¡å¼çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯éœ€è¦è®¿é—®ä¸åŒçš„å†å²ä¿¡æ¯é›†åˆã€‚å¦ä¸€ä¸ªäº‹å®æ˜¯ï¼Œå¯¹æ•°æ®åº“çš„æ€»ä½“å†™å…¥é‡ä¼šæ›´é«˜ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½¿ç”¨æ­¤æ¨¡å¼çš„è¦æ±‚ä¹‹ä¸€æ˜¯å®ƒå‘ç”Ÿåœ¨ä¸å¤ªé¢‘ç¹æ›´æ”¹çš„æ•°æ®ä¸Šã€‚</p>
<h4 id="ç»“è®º-4">ç»“è®º<a hidden class="anchor" aria-hidden="true" href="#ç»“è®º-4">#</a></h4>
<p>å½“æ‚¨éœ€è¦è·Ÿè¸ªå¯¹æ–‡æ¡£çš„æ›´æ”¹æ—¶ï¼Œæ–‡æ¡£ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å®ƒç›¸å¯¹å®¹æ˜“å®ç°ï¼Œå¹¶ä¸”å¯ä»¥åº”ç”¨äºç°æœ‰çš„æ–‡æ¡£é›†ã€‚å¦ä¸€ä¸ªå¥½å¤„æ˜¯å¯¹æœ€æ–°ç‰ˆæœ¬æ•°æ®çš„æŸ¥è¯¢ä»ç„¶è¡¨ç°è‰¯å¥½ã€‚ä½†æ˜¯ï¼Œå®ƒä¸ä¼šå–ä»£ä¸“ç”¨çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚</p>
<h3 id="æ‰©å±•å¼•ç”¨æ¨¡å¼-extended-reference">æ‰©å±•å¼•ç”¨æ¨¡å¼ Extended Reference<a hidden class="anchor" aria-hidden="true" href="#æ‰©å±•å¼•ç”¨æ¨¡å¼-extended-reference">#</a></h3>
<p>åœ¨æ•´ä¸ªä½¿ç”¨æ¨¡å¼æ„å»ºç³»åˆ—ä¸­ï¼Œæˆ‘å¸Œæœ›æ‚¨å·²ç»å‘ç°ï¼Œæ¨¡å¼åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„é©±åŠ¨åŠ›æ˜¯è¯¥æ•°æ®çš„æ•°æ®è®¿é—®æ¨¡å¼æ˜¯ä»€ä¹ˆã€‚å¦‚æœæˆ‘ä»¬æœ‰è®¸å¤šç±»ä¼¼çš„å­—æ®µï¼Œ<em><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-attribute-pattern">å±æ€§æ¨¡å¼</a><em>å¯èƒ½æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚å®¹çº³å¯¹ä¸€å°éƒ¨åˆ†æ•°æ®çš„è®¿é—®æ˜¯å¦ä¼šæå¤§åœ°æ”¹å˜æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Ÿä¹Ÿè®¸</em><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-outlier-pattern">å¼‚å¸¸å€¼æ¨¡å¼</a><em>æ˜¯éœ€è¦è€ƒè™‘çš„ã€‚ä¸€äº›æ¨¡å¼ï¼Œä¾‹å¦‚</em><a href="https://www.mongodb.com/blog/post/building-with-patterns-the-subset-pattern">Subset Pattern</a></em>ï¼Œå¼•ç”¨é¢å¤–çš„é›†åˆå¹¶ä¾é  JOIN æ“ä½œå°†æ¯æ¡æ•°æ®é‡æ–°ç»„åˆåœ¨ä¸€èµ·ã€‚å½“éœ€è¦å¤§é‡ JOIN æ“ä½œæ¥æ±‡é›†ç»å¸¸è®¿é—®çš„æ•°æ®æ—¶ï¼Œå®ä¾‹ä¼šæ€æ ·å‘¢ï¼Ÿè¿™æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<em>æ‰©å±•å‚è€ƒ</em>æ¨¡å¼çš„åœ°æ–¹ã€‚</p>
<h4 id="æ‰©å±•å¼•ç”¨æ¨¡å¼">æ‰©å±•å¼•ç”¨æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#æ‰©å±•å¼•ç”¨æ¨¡å¼">#</a></h4>
<p>æœ‰æ—¶å•ç‹¬æ”¶é›†æ•°æ®æ˜¯æœ‰æ„ä¹‰çš„ã€‚å¦‚æœä¸€ä¸ªå®ä½“å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå•ç‹¬çš„â€œäº‹ç‰©â€ï¼Œé‚£ä¹ˆæ‹¥æœ‰ä¸€ä¸ªå•ç‹¬çš„é›†åˆé€šå¸¸æ˜¯æœ‰æ„ä¹‰çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨ç”µå­å•†åŠ¡åº”ç”¨ç¨‹åºä¸­ï¼Œå­˜åœ¨è®¢å•ã€å®¢æˆ·å’Œåº“å­˜çš„æ¦‚å¿µã€‚å®ƒä»¬æ˜¯ç‹¬ç«‹çš„é€»è¾‘å®ä½“ã€‚</p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/extended_reference2-6m5aqkuunk.png" alt="æ¶æ„è®¾è®¡"  />
</p>
<p>ç„¶è€Œï¼Œä»æ€§èƒ½çš„è§’åº¦æ¥çœ‹ï¼Œè¿™ä¼šæˆä¸ºé—®é¢˜ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å°†ä¿¡æ¯ç‰‡æ®µæ”¾åœ¨ä¸€èµ·ä»¥å®ç°ç‰¹å®šçš„é¡ºåºã€‚ä¸€ä¸ªå®¢æˆ·å¯ä»¥æœ‰ N ä¸ªè®¢å•ï¼Œå½¢æˆ 1-N å…³ç³»ã€‚ä»<em>è®¢å•</em>çš„è§’åº¦æ¥çœ‹ï¼Œå¦‚æœæˆ‘ä»¬åè¿‡æ¥çœ‹ï¼Œä»–ä»¬ä¸å®¢æˆ·çš„å…³ç³»æ˜¯ N-1ã€‚ä¸ºæ¯ä¸ªè®¢å•åµŒå…¥æœ‰å…³å®¢æˆ·çš„<strong>æ‰€æœ‰</strong>ä¿¡æ¯åªæ˜¯ä¸ºäº†å‡å°‘ JOIN æ“ä½œä¼šå¯¼è‡´å¤§é‡é‡å¤ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œè®¢å•å¯èƒ½ä¸éœ€è¦æ‰€æœ‰å®¢æˆ·ä¿¡æ¯ã€‚</p>
<p><em>æ‰©å±•å‚è€ƒ</em>æ¨¡å¼æä¾›äº†ä¸€ç§å¤„ç†è¿™äº›æƒ…å†µçš„å¥½æ–¹æ³•ã€‚æˆ‘ä»¬ä¸ä¼šå¤åˆ¶å®¢æˆ·çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè€Œæ˜¯åªå¤åˆ¶æˆ‘ä»¬ç»å¸¸è®¿é—®çš„å­—æ®µã€‚æˆ‘ä»¬æ²¡æœ‰åµŒå…¥<strong>æ‰€æœ‰</strong>ä¿¡æ¯æˆ–åŒ…å«å¯¹ JOIN ä¿¡æ¯çš„å¼•ç”¨ï¼Œè€Œæ˜¯ä»…åµŒå…¥é‚£äº›å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§å’Œæœ€å¸¸è®¿é—®çš„å­—æ®µï¼Œä¾‹å¦‚å§“åå’Œåœ°å€ã€‚</p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/extended_reference1-o1xbjhqpca.png" alt="æ‰©å±•å‚è€ƒ"  />
</p>
<p>ä½¿ç”¨è¿™ç§æ¨¡å¼æ—¶è¦è€ƒè™‘çš„ä¸€ç‚¹æ˜¯æ•°æ®æ˜¯é‡å¤çš„ã€‚å› æ­¤ï¼Œå¦‚æœå­˜å‚¨åœ¨ä¸»æ–‡æ¡£ä¸­çš„æ•°æ®æ˜¯ä¸ç»å¸¸æ›´æ”¹çš„å­—æ®µï¼Œåˆ™æ•ˆæœæœ€å¥½ã€‚åƒ user_id å’Œäººåè¿™æ ·çš„ä¸œè¥¿æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚è¿™äº›å¾ˆå°‘æ”¹å˜ã€‚</p>
<p>æ­¤å¤–ï¼Œä»…å¼•å…¥å¹¶å¤åˆ¶æ‰€éœ€çš„æ•°æ®ã€‚æƒ³æƒ³è®¢å•å‘ç¥¨ã€‚å¦‚æœæˆ‘ä»¬åœ¨å‘ç¥¨ä¸Šæ³¨æ˜å®¢æˆ·çš„å§“åï¼Œæˆ‘ä»¬æ˜¯å¦éœ€è¦ä»–ä»¬å½“æ—¶çš„è¾…åŠ©ç”µè¯å·ç å’Œéé€è´§åœ°å€ï¼Ÿå¯èƒ½ä¸ä¼šï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å°†è¯¥æ•°æ®ä»<code>invoice</code>é›†åˆä¸­åˆ é™¤å¹¶å¼•ç”¨ä¸€ä¸ª<code>customer</code>é›†åˆã€‚</p>
<p>å½“ä¿¡æ¯æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦è€ƒè™‘å¦‚ä½•å¤„ç†ã€‚å“ªäº›æ‰©å±•å¼•ç”¨å‘ç”Ÿäº†å˜åŒ–ï¼Ÿè¿™äº›åº”è¯¥ä»€ä¹ˆæ—¶å€™æ›´æ–°ï¼Ÿå¦‚æœä¿¡æ¯æ˜¯å¸å•åœ°å€ï¼Œæˆ‘ä»¬æ˜¯å¦éœ€è¦å‡ºäºå†å²ç›®çš„ç»´æŠ¤è¯¥åœ°å€ï¼Œè¿˜æ˜¯å¯ä»¥æ›´æ–°ï¼Ÿæœ‰æ—¶é‡å¤æ•°æ®ä¼šæ›´å¥½ï¼Œå› ä¸ºæ‚¨å¯ä»¥ä¿ç•™å†å²å€¼ï¼Œè¿™å¯èƒ½æ›´æœ‰æ„ä¹‰ã€‚æˆ‘ä»¬è¿é€äº§å“æ—¶å®¢æˆ·å±…ä½çš„åœ°å€åœ¨è®¢å•æ–‡æ¡£ä¸­æ›´æœ‰æ„ä¹‰ï¼Œç„¶åé€šè¿‡å®¢æˆ·é›†åˆè·å–å½“å‰åœ°å€ã€‚</p>
<h4 id="ç¤ºä¾‹ç”¨ä¾‹-5">ç¤ºä¾‹ç”¨ä¾‹<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹ç”¨ä¾‹-5">#</a></h4>
<p>è®¢å•ç®¡ç†åº”ç”¨ç¨‹åºæ˜¯è¿™ç§æ¨¡å¼çš„ç»å…¸ç”¨ä¾‹ã€‚åœ¨è€ƒè™‘ N-1 å…³ç³»ã€å‘å®¢æˆ·ä¸‹è®¢å•æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å‡å°‘ä¿¡æ¯çš„åŠ å…¥ä»¥æé«˜ç»©æ•ˆã€‚é€šè¿‡åŒ…å«å¯¹æœ€å¸¸è¿æ¥çš„æ•°æ®çš„ç®€å•å¼•ç”¨ï¼Œæˆ‘ä»¬èŠ‚çœäº†å¤„ç†æ­¥éª¤ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬ç»§ç»­ä»¥è®¢å•ç®¡ç†ç³»ç»Ÿä¸ºä¾‹ï¼Œåœ¨å‘ç¥¨ä¸Š Acme Co. å¯èƒ½è¢«åˆ—ä¸ºé“ç §ä¾›åº”å•†ã€‚ä»å‘ç¥¨çš„è§’åº¦æ¥çœ‹ï¼Œæ‹¥æœ‰ Acme Co. çš„è”ç³»ä¿¡æ¯å¯èƒ½å¹¶ä¸æ˜¯å¾ˆé‡è¦ã€‚ä¾‹å¦‚ï¼Œè¯¥ä¿¡æ¯æœ€å¥½å­˜æ”¾åœ¨å•ç‹¬çš„<code>supplier</code>é›†åˆä¸­ã€‚åœ¨<code>invoice</code>é›†åˆä¸­ï¼Œæˆ‘ä»¬ä¼šä¿ç•™æœ‰å…³ä¾›åº”å•†çš„æ‰€éœ€ä¿¡æ¯ï¼Œä½œä¸ºå¯¹ä¾›åº”å•†ä¿¡æ¯çš„æ‰©å±•å‚è€ƒã€‚</p>
<h4 id="ç»“è®º-5">ç»“è®º<a hidden class="anchor" aria-hidden="true" href="#ç»“è®º-5">#</a></h4>
<p>å½“æ‚¨çš„åº”ç”¨ç¨‹åºç»å†è®¸å¤šé‡å¤çš„ JOIN æ“ä½œæ—¶ï¼Œ<em>æ‰©å±•å¼•ç”¨</em>æ¨¡å¼æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡åœ¨æŸ¥æ‰¾ç«¯è¯†åˆ«å­—æ®µå¹¶å°†é‚£äº›ç»å¸¸è®¿é—®çš„å­—æ®µå¸¦å…¥ä¸»æ–‡æ¡£ï¼Œå¯ä»¥æé«˜æ€§èƒ½ã€‚è¿™æ˜¯é€šè¿‡æ›´å¿«çš„è¯»å–å’Œå‡å°‘ JOIN çš„æ€»æ•°æ¥å®ç°çš„ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œæ•°æ®é‡å¤æ˜¯è¿™ç§æ¨¡å¼è®¾è®¡æ¨¡å¼çš„å‰¯ä½œç”¨ã€‚</p>
<h3 id="å¼‚å¸¸å€¼æ¨¡å¼outlier">å¼‚å¸¸å€¼æ¨¡å¼Outlier<a hidden class="anchor" aria-hidden="true" href="#å¼‚å¸¸å€¼æ¨¡å¼outlier">#</a></h3>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œåœ¨<em>ä½¿ç”¨æ¨¡å¼æ„å»º</em>ç³»åˆ—ä¸­ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†<a href="https://www.mongodb.com/blog/post/building-with-patterns-the-polymorphic-pattern">Polymorphic</a>ã€<a href="https://www.mongodb.com/blog/post/building-with-patterns-the-attribute-pattern">Attribute</a>å’Œ<a href="https://www.mongodb.com/blog/post/building-with-patterns-the-bucket-pattern">Bucket</a>æ¨¡å¼ã€‚è™½ç„¶è¿™äº›æ¨¡å¼ä¸­çš„æ–‡æ¡£æ¨¡å¼ç•¥æœ‰ä¸åŒï¼Œä½†ä»åº”ç”¨ç¨‹åºå’ŒæŸ¥è¯¢çš„è§’åº¦æ¥çœ‹ï¼Œæ–‡æ¡£ç»“æ„æ˜¯ç›¸å½“ä¸€è‡´çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœä¸æ˜¯è¿™ç§æƒ…å†µï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå½“å­˜åœ¨è¶…å‡ºâ€œæ­£å¸¸â€æ¨¡å¼çš„æ•°æ®æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå¦‚æœæœ‰å¼‚å¸¸å€¼æ€ä¹ˆåŠï¼Ÿ</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæ‚¨æ­£åœ¨åˆ›å»ºä¸€ä¸ªé”€å”®ä¹¦ç±çš„ç”µå­å•†åŠ¡ç½‘ç«™ã€‚æ‚¨å¯èƒ½æœ‰å…´è¶£è¿è¡Œçš„æŸ¥è¯¢ä¹‹ä¸€æ˜¯â€œè°è´­ä¹°äº†ç‰¹å®šçš„ä¹¦â€ã€‚è¿™å¯¹äºæ¨èç³»ç»Ÿå‘æ‚¨çš„å®¢æˆ·å±•ç¤ºæ‚¨æ„Ÿå…´è¶£çš„ç±»ä¼¼ä¹¦ç±å¯èƒ½å¾ˆæœ‰ç”¨ã€‚æ‚¨å†³å®š<code>user_id</code>ä¸ºæ¯æœ¬ä¹¦å­˜å‚¨ä¸€ä¸ªå®¢æˆ·çš„æ•°ç»„ã€‚å¾ˆç®€å•ï¼Œå¯¹å§ï¼Ÿ</p>
<p>å¥½å§ï¼Œè¿™å¯èƒ½ç¡®å®é€‚ç”¨äº 99.99% çš„æ¡ˆä¾‹ï¼Œä½†æ˜¯å½“ JK ç½—ç³å‘å¸ƒæ–°çš„ã€Šå“ˆåˆ©æ³¢ç‰¹ã€‹ä¹¦ç±å¹¶ä¸”é”€é‡é£™å‡æ•°ç™¾ä¸‡æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿå¾ˆå®¹æ˜“è¾¾åˆ°16MB <a href="https://www.mongodb.com/json-and-bson">BSON æ–‡æ¡£å¤§å°çš„é™åˆ¶ã€‚</a><em>é’ˆå¯¹è¿™ç§å¼‚å¸¸</em>æƒ…å†µé‡æ–°è®¾è®¡æˆ‘ä»¬çš„æ•´ä¸ªåº”ç”¨ç¨‹åºå¯èƒ½ä¼šå¯¼è‡´å…¸å‹ä¹¦ç±çš„æ€§èƒ½é™ä½ï¼Œä½†æˆ‘ä»¬ç¡®å®éœ€è¦è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ã€‚</p>
<h4 id="å¼‚å¸¸å€¼æ¨¡å¼">å¼‚å¸¸å€¼æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#å¼‚å¸¸å€¼æ¨¡å¼">#</a></h4>
<p>ä½¿ç”¨ç¦»ç¾¤å€¼æ¨¡å¼ï¼Œæˆ‘ä»¬æ­£åœ¨åŠªåŠ›é˜²æ­¢ä¸€äº›æŸ¥è¯¢æˆ–æ–‡æ¡£å°†æˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆæ¨å‘ä¸€ç§å¯¹äºæˆ‘ä»¬çš„å¤§å¤šæ•°ç”¨ä¾‹è€Œè¨€å¹¶éæœ€ä½³çš„è§£å†³æ–¹æ¡ˆã€‚å¹¶éæ¯æœ¬ä¹¦å”®å‡ºéƒ½ä¼šå”®å‡ºæ•°ç™¾ä¸‡å†Œã€‚</p>
<p>å­˜å‚¨ä¿¡æ¯çš„å…¸å‹<code>book</code>æ–‡æ¡£<code>user_id</code>å¯èƒ½ç±»ä¼¼äºï¼š</p>
<pre tabindex="0"><code>{
    &#34;_id&#34;: ObjectID(&#34;507f1f77bcf86cd799439011&#34;)
    &#34;title&#34;: &#34;A Genealogical Record of a Line of Alger&#34;,
    &#34;author&#34;: &#34;Ken W. Alger&#34;,
    â€¦,
    &#34;customers_purchased&#34;: [&#34;user00&#34;, &#34;user01&#34;, &#34;user02&#34;]

}
</code></pre><p>è¿™å¯¹äºå¤§å¤šæ•°ä¸å¤ªå¯èƒ½è¿›å…¥â€œç•…é”€ä¹¦â€åˆ—è¡¨çš„ä¹¦ç±éå¸¸æœ‰æ•ˆã€‚è€ƒè™‘å¼‚å¸¸å€¼è™½ç„¶ä¼šå¯¼è‡´<code>customers_purchased</code>æ•°ç»„æ‰©å±•è¶…å‡ºæˆ‘ä»¬è®¾ç½®çš„ 1000 é¡¹é™åˆ¶ï¼Œä½†æˆ‘ä»¬å°†æ·»åŠ ä¸€ä¸ªæ–°å­—æ®µä»¥å°†å›¾ä¹¦â€œæ ‡è®°â€ä¸ºå¼‚å¸¸å€¼ã€‚</p>
<pre tabindex="0"><code>{
    &#34;_id&#34;: ObjectID(&#34;507f191e810c19729de860ea&#34;),
    &#34;title&#34;: &#34;Harry Potter, the Next Chapter&#34;,
    &#34;author&#34;: &#34;J.K. Rowling&#34;,
    â€¦,
   &#34;customers_purchased&#34;: [&#34;user00&#34;, &#34;user01&#34;, &#34;user02&#34;, â€¦, &#34;user999&#34;],
   &#34;has_extras&#34;: &#34;true&#34;
}
</code></pre><p>ç„¶åï¼Œæˆ‘ä»¬ä¼šå°†æº¢å‡ºä¿¡æ¯ç§»åŠ¨åˆ°ä¸æœ¬ä¹¦é“¾æ¥çš„å•ç‹¬æ–‡æ¡£ä¸­<code>id</code>ã€‚åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿç¡®å®šæ–‡æ¡£æ˜¯å¦å…·æœ‰<code>has_extras</code>å€¼ä¸º çš„å­—æ®µ<code>true</code>ã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œåº”ç”¨ç¨‹åºå°†æ£€ç´¢é¢å¤–ä¿¡æ¯ã€‚è¿™å¯ä»¥è¢«å¤„ç†ï¼Œä»¥ä¾¿å®ƒå¯¹å¤§å¤šæ•°åº”ç”¨ç¨‹åºä»£ç æ¥è¯´æ˜¯ç›¸å½“é€æ˜çš„ã€‚</p>
<p>è®¸å¤šè®¾è®¡å†³ç­–å°†åŸºäºåº”ç”¨ç¨‹åºå·¥ä½œè´Ÿè½½ï¼Œå› æ­¤æ­¤è§£å†³æ–¹æ¡ˆæ—¨åœ¨å±•ç¤ºå¼‚å¸¸å€¼æ¨¡å¼çš„ç¤ºä¾‹ã€‚è¿™é‡Œè¦æŒæ¡çš„é‡è¦æ¦‚å¿µæ˜¯ï¼Œå¼‚å¸¸å€¼åœ¨å…¶æ•°æ®ä¸­å…·æœ‰è¶³å¤Ÿå¤§çš„å·®å¼‚ï¼Œå¦‚æœå°†å®ƒä»¬è§†ä¸ºâ€œæ­£å¸¸â€ï¼Œåˆ™ä¸ºå®ƒä»¬æ›´æ”¹åº”ç”¨ç¨‹åºè®¾è®¡ä¼šé™ä½æ›´å…¸å‹æŸ¥è¯¢å’Œæ–‡æ¡£çš„æ€§èƒ½ã€‚</p>
<h4 id="ç¤ºä¾‹ç”¨ä¾‹-6">ç¤ºä¾‹ç”¨ä¾‹<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹ç”¨ä¾‹-6">#</a></h4>
<p>å¼‚å¸¸å€¼æ¨¡å¼æ˜¯ä¸€ç§é«˜çº§æ¨¡å¼ï¼Œä½†å®ƒå¯ä»¥å¸¦æ¥å¾ˆå¤§çš„æ€§èƒ½æ”¹è¿›ã€‚å®ƒç»å¸¸ç”¨äºå—æ¬¢è¿ç¨‹åº¦æ˜¯ä¸€ä¸ªå› ç´ çš„æƒ…å†µï¼Œä¾‹å¦‚ç¤¾äº¤ç½‘ç»œå…³ç³»ã€å›¾ä¹¦é”€å”®ã€ç”µå½±è¯„è®ºç­‰ã€‚äº’è”ç½‘å·²ç»æŠŠæˆ‘ä»¬çš„ä¸–ç•Œå˜æˆäº†ä¸€ä¸ªå°å¾—å¤šçš„åœ°æ–¹ï¼Œå½“æŸä»¶äº‹å˜å¾—æµè¡Œæ—¶ï¼Œå®ƒæ”¹å˜äº†æˆ‘ä»¬éœ€è¦çš„æ–¹å¼å¯¹é¡¹ç›®å‘¨å›´çš„æ•°æ®è¿›è¡Œå»ºæ¨¡ã€‚</p>
<p>ä¸€ä¸ªç¤ºä¾‹æ˜¯æ‹¥æœ‰è§†é¢‘ä¼šè®®äº§å“çš„å®¢æˆ·ã€‚å¤§å¤šæ•°è§†é¢‘ä¼šè®®ä¸­çš„æˆæƒä¸ä¼šè€…åˆ—è¡¨å¯ä»¥ä¿å­˜åœ¨ä¸ä¼šè®®ç›¸åŒçš„æ–‡æ¡£ä¸­ã€‚ç„¶è€Œï¼Œæœ‰ä¸€äº›æ´»åŠ¨ï¼Œæ¯”å¦‚å…¬å¸çš„å…¨ä½“å‘˜å·¥ï¼Œé¢„è®¡ä¼šæœ‰æˆåƒä¸Šä¸‡çš„å‚ä¸è€…ã€‚å¯¹äºé‚£äº›å¼‚å¸¸ä¼šè®®ï¼Œå®¢æˆ·å®æ–½äº†â€œæº¢å‡ºâ€æ–‡æ¡£æ¥è®°å½•é‚£äº›é•¿é•¿çš„ä¸ä¼šè€…åå•ã€‚</p>
<h4 id="ç»“è®º-6">ç»“è®º<a hidden class="anchor" aria-hidden="true" href="#ç»“è®º-6">#</a></h4>
<p>å¼‚å¸¸å€¼æ¨¡å¼è§£å†³çš„é—®é¢˜æ˜¯é˜»æ­¢ä¸€äº›æ–‡æ¡£æˆ–æŸ¥è¯¢æ¥ç¡®å®šåº”ç”¨ç¨‹åºçš„è§£å†³æ–¹æ¡ˆã€‚å°¤å…¶æ˜¯å½“è¯¥è§£å†³æ–¹æ¡ˆå¯¹äºå¤§å¤šæ•°ç”¨ä¾‹è€Œè¨€ä¸æ˜¯æœ€ä½³çš„æ—¶ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ MongoDB çµæ´»çš„æ•°æ®æ¨¡å‹å‘æ–‡æ¡£ä¸­æ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œå°†å…¶â€œæ ‡è®°â€ä¸ºå¼‚å¸¸å€¼ã€‚ç„¶åï¼Œåœ¨åº”ç”¨ç¨‹åºå†…éƒ¨ï¼Œæˆ‘ä»¬å¤„ç†å¼‚å¸¸å€¼çš„æ–¹å¼ç•¥æœ‰ä¸åŒã€‚é€šè¿‡ä¸ºå…¸å‹æ–‡æ¡£æˆ–æŸ¥è¯¢å®šåˆ¶æ¶æ„ï¼Œåº”ç”¨ç¨‹åºæ€§èƒ½å°†é’ˆå¯¹è¿™äº›æ­£å¸¸ç”¨ä¾‹è¿›è¡Œä¼˜åŒ–ï¼Œå¼‚å¸¸å€¼ä»å°†å¾—åˆ°è§£å†³ã€‚</p>
<p>è¿™ç§æ¨¡å¼éœ€è¦è€ƒè™‘çš„ä¸€ä»¶äº‹æ˜¯ï¼Œå®ƒé€šå¸¸æ˜¯ä¸ºç‰¹å®šçš„æŸ¥è¯¢å’Œæƒ…å†µé‡èº«å®šåˆ¶çš„ã€‚å› æ­¤ï¼Œå³å¸­æŸ¥è¯¢å¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸ä½³ã€‚æ­¤å¤–ï¼Œç”±äºå¤§éƒ¨åˆ†å·¥ä½œæ˜¯åœ¨åº”ç”¨ç¨‹åºä»£ç æœ¬èº«å†…å®Œæˆçš„ï¼Œå› æ­¤éšç€æ—¶é—´çš„æ¨ç§»å¯èƒ½éœ€è¦é¢å¤–çš„ä»£ç ç»´æŠ¤ã€‚</p>
<h3 id="é¢„åˆ†é…æ¨¡å¼-preallocation">é¢„åˆ†é…æ¨¡å¼ Preallocation<a hidden class="anchor" aria-hidden="true" href="#é¢„åˆ†é…æ¨¡å¼-preallocation">#</a></h3>
<p>MongoDB çš„ä¸€å¤§ä¼˜ç‚¹æ˜¯<a href="https://docs.mongodb.com/manual/core/document/">æ–‡æ¡£</a>æ•°æ®æ¨¡å‹ã€‚å®ƒä¸ä»…åœ¨æ¨¡å¼è®¾è®¡ä¸­è€Œä¸”åœ¨å¼€å‘å‘¨æœŸä¸­éƒ½æä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ã€‚ä¸çŸ¥é“ä»¥åéœ€è¦å“ªäº›å­—æ®µï¼Œä½¿ç”¨ MongoDB æ–‡æ¡£å¯ä»¥è½»æ¾å¤„ç†ã€‚ç„¶è€Œï¼Œæœ‰æ—¶ç»“æ„æ˜¯å·²çŸ¥çš„å¹¶ä¸”èƒ½å¤Ÿå¡«å……æˆ–å¢é•¿ç»“æ„ä½¿å¾—è®¾è®¡æ›´åŠ ç®€å•ã€‚è¿™æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢„åˆ†é…æ¨¡å¼çš„åœ°æ–¹ã€‚</p>
<p>å†…å­˜åˆ†é…é€šå¸¸åœ¨å—ä¸­å®Œæˆä»¥é¿å…æ€§èƒ½é—®é¢˜ã€‚åœ¨ MongoDB çš„æ—©æœŸï¼ˆMongoDB 3.2 ç‰ˆä¹‹å‰ï¼‰ï¼Œå½“å®ƒä½¿ç”¨<a href="https://docs.mongodb.com/manual/core/mmapv1/">MMAPv1</a>å­˜å‚¨å¼•æ“æ—¶ï¼Œä¸€ä¸ªå¸¸è§çš„ä¼˜åŒ–æ˜¯æå‰åˆ†é…ä¸æ–­å¢é•¿çš„æ–‡æ¡£æœªæ¥å¤§å°æ‰€éœ€çš„å†…å­˜ã€‚MMAPv1 ä¸­ä¸æ–­å¢é•¿çš„æ–‡æ¡£éœ€è¦ç”±æœåŠ¡å™¨ä»¥ç›¸å½“æ˜‚è´µçš„æˆæœ¬é‡æ–°å®šä½ã€‚å‡­å€Ÿå…¶æ— é”å’Œé‡å†™æ›´æ–°ç®—æ³•ï¼Œ<a href="https://docs.mongodb.com/manual/core/wiredtiger/">WiredTiger</a>ä¸éœ€è¦åŒæ ·çš„å¤„ç†ã€‚</p>
<p>éšç€ MongoDB 4.0 ä¸­ MMAPv1 çš„å¼ƒç”¨ï¼Œé¢„åˆ†é…æ¨¡å¼ä¼¼ä¹å¤±å»äº†ä¸€äº›å…‰å½©å’Œå¿…è¦æ€§ã€‚ç„¶è€Œï¼ŒWiredTiger çš„é¢„åˆ†é…æ¨¡å¼ä»æœ‰ä¸€äº›ç”¨ä¾‹ã€‚ä¸æˆ‘ä»¬åœ¨<em>ä½¿ç”¨æ¨¡å¼æ„å»º</em>ç³»åˆ—ä¸­è®¨è®ºçš„å…¶ä»–æ¨¡å¼ä¸€æ ·ï¼Œéœ€è¦è€ƒè™‘ä¸€äº›åº”ç”¨ç¨‹åºæ³¨æ„äº‹é¡¹ã€‚</p>
<h4 id="é¢„åˆ†é…æ¨¡å¼">é¢„åˆ†é…æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#é¢„åˆ†é…æ¨¡å¼">#</a></h4>
<p>è¿™ç§æ¨¡å¼åªæ˜¯è¦æ±‚åˆ›å»ºä¸€ä¸ªåˆå§‹çš„ç©ºç»“æ„ä»¥ä¾›ä»¥åå¡«å……ã€‚è¿™å¯èƒ½å¬èµ·æ¥å¾®ä¸è¶³é“ï¼Œä½†æ˜¯ï¼Œæ‚¨éœ€è¦åœ¨ç®€åŒ–çš„é¢„æœŸç»“æœä¸è§£å†³æ–¹æ¡ˆå¯èƒ½æ¶ˆè€—çš„é¢å¤–èµ„æºä¹‹é—´å–å¾—å¹³è¡¡ã€‚æ›´å¤§çš„æ–‡æ¡£å°†äº§ç”Ÿæ›´å¤§çš„å·¥ä½œé›†ï¼Œä»è€Œå¯¼è‡´æ›´å¤šçš„ RAM æ¥åŒ…å«è¯¥å·¥ä½œé›†ã€‚</p>
<p>å¦‚æœåº”ç”¨ç¨‹åºçš„ä»£ç ä½¿ç”¨æœªå®Œå…¨å¡«å……çš„ç»“æ„æ›´å®¹æ˜“ç¼–å†™å’Œç»´æŠ¤ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½å¾ˆå®¹æ˜“è¶…è¿‡ RAM çš„æˆæœ¬ã€‚å‡è®¾éœ€è¦å°†ä¸€ä¸ªå‰§é™¢æˆ¿é—´è¡¨ç¤ºä¸ºä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œå…¶ä¸­æ¯ä¸ªåº§ä½éƒ½æœ‰ä¸€ä¸ªâ€œè¡Œâ€å’Œâ€œç¼–å·â€ï¼Œä¾‹å¦‚åº§ä½â€œC7â€ã€‚æœ‰äº›è¡Œå¯èƒ½æœ‰æ›´å°‘çš„åº§ä½ï¼Œä½†æ˜¯åœ¨äºŒç»´æ•°ç»„ä¸­æ‰¾åˆ°åº§ä½â€œB3â€æ¯”åœ¨åªæœ‰ç°æœ‰åº§ä½çš„å•å…ƒæ ¼çš„ä¸€ç»´æ•°ç»„ä¸­æ‰¾åˆ°åº§ä½çš„å¤æ‚å…¬å¼æ›´å¿«ã€æ›´æ¸…æ™°ã€‚èƒ½å¤Ÿè¯†åˆ«æ— éšœç¢åº§ä½ä¹Ÿæ›´å®¹æ˜“ï¼Œå› ä¸ºå¯ä»¥ä¸ºè¿™äº›åº§ä½åˆ›å»ºå•ç‹¬çš„é˜µåˆ—ã€‚</p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/preallocation-1-qyzxrzc6w2.jpg" alt="åº§ä½å›¾"  />
</p>
<p><em>åœºåœ°çš„ä¸€ç»´è¡¨ç¤ºï¼Œå¯è®¿é—®çš„åº§ä½ä»¥è“è‰²æ˜¾ç¤ºã€‚</em></p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/preallocation-2a-f8obtyomt0.png" alt="äºŒç»´åº§ä½å›¾"  />
</p>
<p><em>åœºåœ°çš„äºŒç»´è¡¨ç¤ºï¼Œå¯ç”¨ç»¿è‰²çš„æœ‰æ•ˆåº§ä½ã€‚å¸¦æœ‰è“è‰²è½®å»“çš„æ— éšœç¢åº§ä½ã€‚</em></p>
<h4 id="ç¤ºä¾‹ç”¨ä¾‹-7">ç¤ºä¾‹ç”¨ä¾‹<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹ç”¨ä¾‹-7">#</a></h4>
<p>å¦‚å‰æ‰€è¿°ï¼Œè¡¨ç¤ºäºŒç»´ç»“æ„ï¼ˆå¦‚åœºåœ°ï¼‰æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç”¨ä¾‹ã€‚å¦ä¸€ä¸ªç¤ºä¾‹å¯ä»¥æ˜¯é¢„ç•™ç³»ç»Ÿï¼Œå…¶ä¸­èµ„æºæ¯å¤©è¢«é˜»æ­¢æˆ–é¢„ç•™ã€‚æ¯å¤©ä½¿ç”¨ä¸€ä¸ªå•å…ƒæ ¼å¯èƒ½ä¼šæ¯”ä¿ç•™èŒƒå›´åˆ—è¡¨æ›´å¿«åœ°è¿›è¡Œè®¡ç®—å’Œæ£€æŸ¥ã€‚</p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/preallocation-month1-6e7yq8s400.png" alt="å¸¦æœ‰æ•°ç»„çš„ 2019 å¹´ 4 æœˆçš„å›¾åƒ"  />
</p>
<p><em>2019 å¹´ 4 æœˆï¼Œæœ‰ä¸€ç³»åˆ—ç¾å›½å·¥ä½œæ—¥ã€‚</em></p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/preallocation-month2-v64w8svj6t.png" alt="å¸¦æœ‰èŒƒå›´åˆ—è¡¨çš„ 2019 å¹´ 4 æœˆå›¾åƒ"  />
</p>
<p><em>2019 å¹´ 4 æœˆï¼ŒåŒ…å«ä¸€ç³»åˆ—ç¾å›½å·¥ä½œæ—¥ä½œä¸ºèŒƒå›´åˆ—è¡¨ã€‚</em></p>
<h4 id="ç»“è®º-7">ç»“è®º<a hidden class="anchor" aria-hidden="true" href="#ç»“è®º-7">#</a></h4>
<p>åœ¨å°† MMAPv1 å­˜å‚¨å¼•æ“ä¸ MongoDB ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œè¿™ç§æ¨¡å¼å¯èƒ½æ˜¯æœ€å¸¸ç”¨çš„æ¨¡å¼ä¹‹ä¸€ã€‚ç„¶è€Œï¼Œç”±äºè¿™ä¸ªå­˜å‚¨å¼•æ“çš„å¼ƒç”¨ï¼Œå®ƒå·²ç»å¤±å»äº†å®ƒçš„é€šç”¨ç”¨ä¾‹ï¼Œä½†å®ƒåœ¨æŸäº›æƒ…å†µä¸‹ä»ç„¶æœ‰ç”¨ã€‚å’Œå…¶ä»–æ¨¡å¼ä¸€æ ·ï¼Œæ‚¨éœ€è¦åœ¨â€œç®€å•æ€§â€å’Œâ€œæ€§èƒ½â€ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚</p>
<h3 id="å¤šæ€æ¨¡å¼-polymorphic">å¤šæ€æ¨¡å¼ polymorphic<a hidden class="anchor" aria-hidden="true" href="#å¤šæ€æ¨¡å¼-polymorphic">#</a></h3>
<p>å½“æˆ‘ä»¬çš„æ–‡æ¡£ç›¸ä¼¼æ€§å¤šäºå·®å¼‚æ€§æ—¶ï¼Œå°±ä¼šä½¿ç”¨æ­¤æ¨¡å¼ã€‚å½“æˆ‘ä»¬æƒ³è¦å°†æ–‡æ¡£ä¿å­˜åœ¨å•ä¸ªé›†åˆä¸­æ—¶ï¼Œå®ƒä¹Ÿéå¸¸é€‚åˆã€‚</p>
<h4 id="å¤šæ€æ¨¡å¼">å¤šæ€æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#å¤šæ€æ¨¡å¼">#</a></h4>
<p>å½“é›†åˆä¸­çš„æ‰€æœ‰æ–‡æ¡£å…·æœ‰ç›¸ä¼¼ä½†ä¸ç›¸åŒçš„ç»“æ„æ—¶ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå¤šæ€æ¨¡å¼ã€‚å¦‚å‰æ‰€è¿°ï¼Œå½“æˆ‘ä»¬æƒ³è¦ä»å•ä¸ªé›†åˆè®¿é—®ï¼ˆæŸ¥è¯¢ï¼‰ä¿¡æ¯æ—¶ï¼Œå¤šæ€æ¨¡å¼å¾ˆæœ‰ç”¨ã€‚æ ¹æ®æˆ‘ä»¬æƒ³è¦è¿è¡Œçš„æŸ¥è¯¢å°†æ–‡æ¡£åˆ†ç»„åœ¨ä¸€èµ·ï¼ˆè€Œä¸æ˜¯è·¨è¡¨æˆ–é›†åˆåˆ†ç¦»å¯¹è±¡ï¼‰æœ‰åŠ©äºæé«˜æ€§èƒ½ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè·Ÿè¸ªæ‰€æœ‰ä¸åŒè¿åŠ¨çš„èŒä¸šè¿åŠ¨å‘˜ã€‚</p>
<p>æˆ‘ä»¬ä»ç„¶å¸Œæœ›èƒ½å¤Ÿè®¿é—®æˆ‘ä»¬åº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰è¿åŠ¨å‘˜ï¼Œä½†æ˜¯æ¯ä¸ªè¿åŠ¨å‘˜çš„å±æ€§éå¸¸ä¸åŒã€‚è¿™å°±æ˜¯å¤šæ€æ¨¡å¼å¤§æ”¾å¼‚å½©çš„åœ°æ–¹ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¥è‡ªä¸¤ä¸ªä¸åŒè¿åŠ¨çš„è¿åŠ¨å‘˜çš„æ•°æ®å­˜å‚¨åœ¨åŒä¸€ä¸ªé›†åˆä¸­ã€‚å³ä½¿æ–‡æ¡£åœ¨åŒä¸€ä¸ªé›†åˆä¸­ï¼Œå­˜å‚¨çš„å…³äºæ¯ä¸ªè¿åŠ¨å‘˜çš„æ•°æ®ä¹Ÿä¸å¿…ç›¸åŒã€‚</p>
<p><img loading="lazy" src="https://www.mongodb.com/developer/images/Polymorphic1-nanehssyv3.png" alt="å…·æœ‰å…¬å…±å­—æ®µçš„å¤šæ€è®¾è®¡æ¨¡å¼"  />
</p>
<p>èŒä¸šè¿åŠ¨å‘˜çš„è®°å½•æœ‰ä¸€äº›ç›¸ä¼¼ä¹‹å¤„ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›å·®å¼‚ã€‚ä½¿ç”¨å¤šæ€æ¨¡å¼ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“é€‚åº”è¿™äº›å·®å¼‚ã€‚å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨å¤šæ€æ¨¡å¼ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šæœ‰ä¿é¾„çƒè¿åŠ¨å‘˜çš„é›†åˆå’Œç½‘çƒè¿åŠ¨å‘˜çš„é›†åˆã€‚å½“æˆ‘ä»¬æƒ³è¦æŸ¥è¯¢æ‰€æœ‰è¿åŠ¨å‘˜æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œè€—æ—¶ä¸”å¯èƒ½å¤æ‚çš„è¿æ¥ã€‚ç›¸åï¼Œç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯å¤šæ€æ¨¡å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰€æœ‰çš„æ•°æ®éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªè¿åŠ¨å‘˜é›†åˆä¸­ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢æ¥å®Œæˆå¯¹æ‰€æœ‰è¿åŠ¨å‘˜çš„æŸ¥è¯¢ã€‚</p>
<p>è¿™ç§è®¾è®¡æ¨¡å¼ä¹Ÿå¯ä»¥æµå…¥åµŒå…¥çš„å­æ–‡æ¡£ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç›è’‚å¨œÂ·çº³èŠ™æ‹‰è’‚æ´›å¨ƒä¸åªæ˜¯ä½œä¸ºä¸€ä¸ªçƒå‘˜å‚åŠ æ¯”èµ›ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯èƒ½å¸Œæœ›å°†å¥¹çš„è®°å½•æ„é€ å¦‚ä¸‹ï¼š</p>
<p><img loading="lazy" src="https://www.mongodb.com/developer/images/Polymorphic2-bpk0w3ig5y.gif" alt="å¸¦æœ‰å­æ–‡æ¡£çš„å¤šæ€è®¾è®¡æ¨¡å¼"  />
</p>
<p>ä»åº”ç”¨ç¨‹åºå¼€å‘çš„è§’åº¦æ¥çœ‹ï¼Œå½“ä½¿ç”¨å¤šæ€æ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬å°†æŸ¥çœ‹æ–‡æ¡£æˆ–å­æ–‡æ¡£ä¸­çš„ç‰¹å®šå­—æ®µï¼Œä»¥ä¾¿èƒ½å¤Ÿè·Ÿè¸ªå·®å¼‚ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬çŸ¥é“ç½‘çƒè¿åŠ¨å‘˜å¯èƒ½ä¼šå‚ä¸ä¸åŒçš„èµ›äº‹ï¼Œè€Œä¸åŒçš„è¿åŠ¨å‘˜å¯èƒ½ä¸ä¼šã€‚è¿™é€šå¸¸éœ€è¦æ ¹æ®ç»™å®šæ–‡æ¡£ä¸­çš„ä¿¡æ¯åœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ä½¿ç”¨ä¸åŒçš„ä»£ç è·¯å¾„ã€‚æˆ–è€…ï¼Œå¯èƒ½ä¼šç¼–å†™ä¸åŒçš„ç±»æˆ–å­ç±»æ¥å¤„ç†ç½‘çƒã€ä¿é¾„çƒã€è¶³çƒå’Œæ©„æ¦„çƒè¿åŠ¨å‘˜ä¹‹é—´çš„å·®å¼‚ã€‚</p>
<h4 id="ç¤ºä¾‹ç”¨ä¾‹-8">ç¤ºä¾‹ç”¨ä¾‹<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹ç”¨ä¾‹-8">#</a></h4>
<p>å¤šæ€æ¨¡å¼çš„ä¸€ä¸ªç¤ºä¾‹ç”¨ä¾‹æ˜¯<a href="https://www.mongodb.com/use-cases/single-view">å•ä¸€è§†å›¾åº”ç”¨ç¨‹åº</a>. æƒ³è±¡ä¸€ä¸‹ä¸ºä¸€å®¶å…¬å¸å·¥ä½œï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¯¥å…¬å¸åˆ©ç”¨ä»–ä»¬çš„æŠ€æœ¯å’Œæ•°æ®æ¨¡å¼æ”¶è´­äº†å…¶ä»–å…¬å¸ã€‚ä¾‹å¦‚ï¼Œæ¯å®¶å…¬å¸éƒ½æœ‰è®¸å¤šæ•°æ®åº“ï¼Œæ¯ä¸ªæ•°æ®åº“éƒ½ä»¥ä¸åŒçš„æ–¹å¼æ¨¡æ‹Ÿâ€œä¸å®¢æˆ·çš„ä¿é™©â€ã€‚ç„¶åï¼Œæ‚¨è´­ä¹°äº†è¿™äº›å…¬å¸ï¼Œå¹¶å¸Œæœ›å°†æ‰€æœ‰è¿™äº›ç³»ç»Ÿé›†æˆä¸ºä¸€ä¸ªã€‚å°†è¿™äº›ä¸åŒçš„ç³»ç»Ÿåˆå¹¶åˆ°ä¸€ä¸ªç»Ÿä¸€çš„ SQL æ¨¡å¼ä¸­æ—¢è´¹é’±åˆè´¹æ—¶ã€‚</p>
<p><a href="https://www.metlife.com/">å¤§éƒ½ä¼šäººå¯¿</a>èƒ½å¤Ÿåˆ©ç”¨ MongoDB å’Œå¤šæ€æ¨¡å¼åœ¨å‡ ä¸ªæœˆå†…æ„å»ºä»–ä»¬çš„å•è§†å›¾åº”ç”¨ç¨‹åºã€‚ä»–ä»¬çš„ Single View åº”ç”¨ç¨‹åºå°†æ¥è‡ªå¤šä¸ªæ¥æºçš„æ•°æ®èšåˆåˆ°ä¸€ä¸ªä¸­å¤®å­˜å‚¨åº“ä¸­ï¼Œä½¿å®¢æˆ·æœåŠ¡ã€ä¿é™©ä»£ç†ã€è®¡è´¹å’Œå…¶ä»–éƒ¨é—¨èƒ½å¤Ÿè·å¾— 360 åº¦çš„å®¢æˆ·å›¾ç‰‡ã€‚è¿™ä½¿ä»–ä»¬èƒ½å¤Ÿä»¥æ›´ä½çš„æˆæœ¬ä¸ºå…¬å¸æä¾›æ›´å¥½çš„å®¢æˆ·æœåŠ¡ã€‚æ­¤å¤–ï¼Œä½¿ç”¨ MongoDB çš„çµæ´»æ•°æ®æ¨¡å‹å’Œå¤šæ€æ¨¡å¼ï¼Œå¼€å‘å›¢é˜Ÿèƒ½å¤Ÿå¿«é€Ÿåˆ›æ–°ï¼Œå°†ä»–ä»¬çš„äº§å“ä¸Šçº¿ã€‚</p>
<p>å•è§†å›¾åº”ç”¨ç¨‹åºæ˜¯å¤šæ€æ¨¡å¼çš„ä¸€ä¸ªç”¨ä¾‹ã€‚å®ƒä¹Ÿé€‚ç”¨äºè‡ªè¡Œè½¦ä¸é’“é±¼ç«¿å…·æœ‰ä¸åŒå±æ€§çš„äº§å“ç›®å½•ç­‰å†…å®¹ã€‚æˆ‘ä»¬çš„è¿åŠ¨å‘˜ç¤ºä¾‹å¯ä»¥å¾ˆå®¹æ˜“åœ°æ‰©å±•ä¸ºæ›´æˆç†Ÿçš„å†…å®¹ç®¡ç†ç³»ç»Ÿï¼Œå¹¶åœ¨é‚£é‡Œä½¿ç”¨å¤šæ€æ¨¡å¼ã€‚</p>
<h4 id="ç»“è®º-8">ç»“è®º<a hidden class="anchor" aria-hidden="true" href="#ç»“è®º-8">#</a></h4>
<p>å½“æ–‡æ¡£çš„ç›¸ä¼¼æ€§å¤šäºå·®å¼‚æ€§æ—¶ï¼Œä½¿ç”¨å¤šæ€æ¨¡å¼ã€‚è¿™ç§æ¨¡å¼è®¾è®¡çš„å…¸å‹ç”¨ä¾‹æ˜¯ï¼š</p>
<ul>
<li>å•ä¸€è§†å›¾åº”ç”¨ç¨‹åº</li>
<li>å†…å®¹ç®¡ç†</li>
<li>ç§»åŠ¨åº”ç”¨</li>
<li>äº§å“ç›®å½•</li>
</ul>
<p>å¤šæ€æ¨¡å¼æä¾›äº†ä¸€ç§æ˜“äºå®ç°çš„è®¾è®¡ï¼Œå…è®¸è·¨å•ä¸ªé›†åˆè¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸”æ˜¯æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­æ¢ç´¢çš„è®¸å¤šè®¾è®¡æ¨¡å¼çš„èµ·ç‚¹ã€‚</p>
<h3 id="æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼-schema-versioning">æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼ Schema Versioning<a hidden class="anchor" aria-hidden="true" href="#æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼-schema-versioning">#</a></h3>
<p>æœ‰äººè¯´ï¼Œç”Ÿæ´»ä¸­å”¯ä¸€ä¸å˜çš„å°±æ˜¯å˜åŒ–ã€‚è¿™ä¹Ÿé€‚ç”¨äºæ•°æ®åº“æ¨¡å¼ã€‚æˆ‘ä»¬æ›¾ç»è®¤ä¸ºä¸éœ€è¦çš„ä¿¡æ¯ï¼Œç°åœ¨æˆ‘ä»¬æƒ³è¦æ•è·ã€‚æˆ–è€…æ–°æœåŠ¡å˜å¾—å¯ç”¨å¹¶ä¸”éœ€è¦åŒ…å«åœ¨æ•°æ®åº“è®°å½•ä¸­ã€‚ä¸ç®¡æ›´æ”¹èƒŒåçš„åŸå› æ˜¯ä»€ä¹ˆï¼Œä¸€æ®µæ—¶é—´åï¼Œæˆ‘ä»¬ä¸å¯é¿å…åœ°éœ€è¦å¯¹åº”ç”¨ç¨‹åºä¸­çš„åº•å±‚æ¶æ„è®¾è®¡è¿›è¡Œæ›´æ”¹ã€‚è™½ç„¶è¿™é€šå¸¸ä¼šå¸¦æ¥æŒ‘æˆ˜ï¼Œå¹¶ä¸”åœ¨é—ç•™è¡¨æ ¼æ•°æ®åº“ç³»ç»Ÿä¸­å¯èƒ½è‡³å°‘ä¼šå¸¦æ¥ä¸€äº›ä»¤äººå¤´ç–¼çš„é—®é¢˜ï¼Œä½†åœ¨ MongoDB ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼æ¥ç®€åŒ–æ›´æ”¹ã€‚</p>
<p>å¦‚å‰æ‰€è¿°ï¼Œæ›´æ–°è¡¨æ ¼æ•°æ®åº“ä¸­çš„æ•°æ®åº“æ¨¡å¼å¯èƒ½å…·æœ‰æŒ‘æˆ˜æ€§ã€‚é€šå¸¸éœ€è¦åœæ­¢åº”ç”¨ç¨‹åºï¼Œè¿ç§»æ•°æ®åº“ä»¥æ”¯æŒæ–°æ¨¡å¼ï¼Œç„¶åé‡æ–°å¯åŠ¨ã€‚è¿™ç§åœæœºæ—¶é—´å¯èƒ½ä¼šå¯¼è‡´ç³Ÿç³•çš„å®¢æˆ·ä½“éªŒã€‚æ­¤å¤–ï¼Œå¦‚æœè¿ç§»æ²¡æœ‰å®Œå…¨æˆåŠŸï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€é€šå¸¸æ˜¯ä¸€ä¸ªæ›´å¤§çš„æŒ‘æˆ˜ã€‚</p>
<p>Schema Versioning æ¨¡å¼åˆ©ç”¨äº† MongoDB å¯¹ä¸åŒå½¢çŠ¶æ–‡æ¡£çš„æ”¯æŒä»¥å­˜åœ¨äºåŒä¸€æ•°æ®åº“é›†åˆä¸­ã€‚MongoDB çš„è¿™ç§å¤šæ€æ€§éå¸¸å¼ºå¤§ã€‚å®ƒå…è®¸å…·æœ‰ä¸åŒå­—æ®µç”šè‡³åŒä¸€å­—æ®µçš„ä¸åŒå­—æ®µç±»å‹çš„æ–‡æ¡£å’Œå¹³å…±å­˜ã€‚</p>
<h4 id="æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼">æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼">#</a></h4>
<p>è¿™ç§æ¨¡å¼çš„å®ç°ç›¸å¯¹å®¹æ˜“ã€‚æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä»æœ€ç»ˆéœ€è¦æ›´æ”¹çš„åŸå§‹æ¨¡å¼å¼€å§‹ã€‚å‘ç”Ÿè¿™ç§æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å­—æ®µåˆ›å»ºæ–°æ¨¡å¼å¹¶å°†å…¶ä¿å­˜åˆ°æ•°æ®åº“<code>schema_version</code>ä¸­ã€‚è¯¥å­—æ®µå°†å…è®¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºçŸ¥é“å¦‚ä½•å¤„ç†æ­¤ç‰¹å®šæ–‡æ¡£ã€‚æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥è®©æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ ¹æ®æŸäº›ç»™å®šå­—æ®µçš„å­˜åœ¨ä¸å¦æ¥æ¨æ–­ç‰ˆæœ¬ï¼Œä½†å‰ä¸€ç§æ–¹æ³•æ˜¯é¦–é€‰ã€‚æˆ‘ä»¬å¯ä»¥å‡è®¾<em>æ²¡æœ‰</em>è¿™ä¸ªå­—æ®µçš„æ–‡æ¡£æ˜¯ç‰ˆæœ¬ 1ã€‚ç„¶åæ¯ä¸ªæ–°çš„æ¨¡å¼ç‰ˆæœ¬éƒ½ä¼šå¢åŠ <code>schema_version</code>å­—æ®µå€¼ï¼Œå¹¶ä¸”å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</p>
<p>éšç€æ–°ä¿¡æ¯çš„ä¿å­˜ï¼Œæˆ‘ä»¬ä½¿ç”¨æœ€æ–°çš„æ¨¡å¼ç‰ˆæœ¬ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºå’Œç”¨ä¾‹æ¥ç¡®å®šæ˜¯å¦éœ€è¦å°†æ‰€æœ‰æ–‡æ¡£æ›´æ–°ä¸ºæ–°è®¾è®¡ã€ä½•æ—¶æ›´æ–°è®°å½•è¢«è®¿é—®æˆ–æ ¹æœ¬ä¸æ›´æ–°ã€‚åœ¨åº”ç”¨ç¨‹åºå†…éƒ¨ï¼Œæˆ‘ä»¬å°†ä¸ºæ¯ä¸ªæ¨¡å¼ç‰ˆæœ¬åˆ›å»ºå¤„ç†å‡½æ•°ã€‚</p>
<h4 id="ç¤ºä¾‹ç”¨ä¾‹-9">ç¤ºä¾‹ç”¨ä¾‹<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹ç”¨ä¾‹-9">#</a></h4>
<p>å¦‚å‰æ‰€è¿°ï¼Œå‡ ä¹æ¯ä¸ªæ•°æ®åº“éƒ½éœ€è¦åœ¨å…¶ç”Ÿå‘½å‘¨æœŸçš„æŸä¸ªæ—¶é—´ç‚¹è¿›è¡Œæ›´æ”¹ï¼Œå› æ­¤è¿™ç§æ¨¡å¼åœ¨è®¸å¤šæƒ…å†µä¸‹éƒ½å¾ˆæœ‰ç”¨ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å®¢æˆ·èµ„æ–™ç”¨ä¾‹ã€‚åœ¨æœ‰å¤šç§è”ç³»æ–¹å¼ä¹‹å‰ï¼Œæˆ‘ä»¬å°±å¼€å§‹ä¿ç•™å®¢æˆ·ä¿¡æ¯ã€‚ä»–ä»¬åªèƒ½åœ¨å®¶é‡Œæˆ–å·¥ä½œä¸­è”ç³»åˆ°ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;_id&#34;</span>: <span style="color:#e6db74">&#34;&lt;ObjectId&gt;&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Anakin Skywalker&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;home&#34;</span>: <span style="color:#e6db74">&#34;503-555-0000&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;work&#34;</span>: <span style="color:#e6db74">&#34;503-555-0010&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>éšç€å²æœˆçš„æµé€ï¼Œè¶Šæ¥è¶Šå¤šçš„å®¢æˆ·è®°å½•è¢«ä¿å­˜ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°æ‰‹æœºå·ç ä¹Ÿéœ€è¦ä¿å­˜ã€‚æ·»åŠ è¯¥å­—æ®µæ˜¯ç›´æˆªäº†å½“çš„ã€‚</p>
<pre tabindex="0"><code>{
    &#34;_id&#34;: &#34;&lt;ObjectId&gt;&#34;,
    &#34;name&#34;: &#34;Darth Vader&#34;,
    &#34;home&#34;: &#34;503-555-0100&#34;,
    &#34;work&#34;: &#34;503-555-0110&#34;,
    &#34;mobile&#34;: &#34;503-555-0120&#34;
}
</code></pre><p>éšç€æ—¶é—´çš„æµé€ï¼Œç°åœ¨æˆ‘ä»¬å‘ç°æ‹¥æœ‰å®¶åº­ç”µè¯çš„äººè¶Šæ¥è¶Šå°‘ï¼Œè€Œå…¶ä»–è”ç³»æ–¹å¼ä¹Ÿå˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚Twitterã€Skype å’Œ Google Hangouts ç­‰é¡¹ç›®æ­£å˜å¾—è¶Šæ¥è¶Šæµè¡Œï¼Œç”šè‡³å¯èƒ½åœ¨æˆ‘ä»¬åˆšå¼€å§‹ä¿ç•™è”ç³»ä¿¡æ¯æ—¶éƒ½ä¸å¯ç”¨ã€‚æˆ‘ä»¬è¿˜æƒ³å°½å¯èƒ½åœ°å°è¯•å¯¹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè¿›è¡Œæœªæ¥éªŒè¯ï¼Œå¹¶ä¸”åœ¨é˜…è¯»äº†<em>ä½¿ç”¨æ¨¡å¼æ„å»º</em>ç³»åˆ—ä¹‹åï¼Œæˆ‘ä»¬äº†è§£äº†<a href="https://www.mongodb.com/blog/post/building-with-patterns-the-attribute-pattern">å±æ€§æ¨¡å¼</a>å¹¶å°†å…¶å®ç°ä¸ºä¸€<code>contact_method</code>ç»„å€¼ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ¨¡å¼ç‰ˆæœ¬ã€‚</p>
<pre tabindex="0"><code>{
    &#34;_id&#34;: &#34;&lt;ObjectId&gt;&#34;,
    &#34;schema_version&#34;: &#34;2&#34;,
    &#34;name&#34;: &#34;Anakin Skywalker (Retired)&#34;,
    &#34;contact_method&#34;: [
        { &#34;work&#34;: &#34;503-555-0210&#34; },
        { &#34;mobile&#34;: &#34;503-555-0220&#34; },
        { &#34;twitter&#34;: &#34;@anakinskywalker&#34; },
        { &#34;skype&#34;: &#34;AlwaysWithYou&#34; }
    ]
}
</code></pre><p>MongoDB æ–‡æ¡£æ¨¡å‹çš„çµæ´»æ€§å…è®¸æ‰€æœ‰è¿™äº›éƒ½å‘ç”Ÿï¼Œè€Œæ— éœ€æ•°æ®åº“åœæœºã€‚ä»åº”ç”¨ç¨‹åºçš„è§’åº¦æ¥çœ‹ï¼Œå®ƒå¯ä»¥è®¾è®¡ä¸ºè¯»å–æ¨¡å¼çš„ä¸¤ä¸ªç‰ˆæœ¬ã€‚å‡è®¾æ¶‰åŠçš„åº”ç”¨ç¨‹åºæœåŠ¡å™¨ä¸æ­¢ä¸€ä¸ªï¼Œé‚£ä¹ˆå¦‚ä½•å¤„ç†æ¶æ„å·®å¼‚çš„è¿™ç§åº”ç”¨ç¨‹åºæ›´æ”¹ä¹Ÿä¸åº”è¯¥éœ€è¦åœæœºæ—¶é—´ã€‚</p>
<h4 id="ç»“è®º-9">ç»“è®º<a hidden class="anchor" aria-hidden="true" href="#ç»“è®º-9">#</a></h4>
<p>Schema Versioning æ¨¡å¼éå¸¸é€‚ç”¨äºæ— æ³•é€‰æ‹©åº”ç”¨ç¨‹åºåœæœºæ—¶é—´ã€æ›´æ–°æ–‡æ¡£å¯èƒ½éœ€è¦æ•°å°æ—¶ã€æ•°å¤©æˆ–æ•°å‘¨æ—¶é—´æ‰èƒ½å®Œæˆã€ä¸éœ€è¦å°†æ–‡æ¡£æ›´æ–°åˆ°æ–°ç‰ˆæœ¬æˆ–ä»»æ„ç»„åˆçš„æƒ…å†µã€‚è¿™äº›ã€‚å®ƒå…è®¸<code>schema_version</code>è½»æ¾æ·»åŠ æ–°å­—æ®µå¹¶ä½¿åº”ç”¨ç¨‹åºé€‚åº”è¿™äº›å˜åŒ–ã€‚æ­¤å¤–ï¼Œå®ƒä¸ºæˆ‘ä»¬ä½œä¸ºå¼€å‘äººå‘˜æä¾›äº†æ›´å¥½åœ°å†³å®šä½•æ—¶ä»¥åŠå¦‚ä½•è¿›è¡Œæ•°æ®è¿ç§»çš„æœºä¼šã€‚æ‰€æœ‰è¿™äº›éƒ½ä¼šå‡å°‘æœªæ¥çš„æŠ€æœ¯å€ºåŠ¡ï¼Œè¿™æ˜¯è¿™ç§æ¨¡å¼çš„å¦ä¸€å¤§ä¼˜åŠ¿ã€‚</p>
<p>ä¸æœ¬ç³»åˆ—ä¸­æåˆ°çš„å…¶ä»–æ¨¡å¼ä¸€æ ·ï¼ŒSchema Versioning æ¨¡å¼ä¹Ÿéœ€è¦è€ƒè™‘ä¸€äº›äº‹é¡¹ã€‚å¦‚æœæ‚¨åœ¨æ–‡æ¡£ä¸­ä¸åœ¨åŒä¸€çº§åˆ«çš„å­—æ®µä¸Šæœ‰ç´¢å¼•ï¼Œåˆ™åœ¨è¿ç§»æ–‡æ¡£æ—¶å¯èƒ½éœ€è¦ 2 ä¸ªç´¢å¼•ã€‚</p>
<p>è¿™ç§æ¨¡å¼çš„ä¸»è¦å¥½å¤„ä¹‹ä¸€æ˜¯æ•°æ®æ¨¡å‹æœ¬èº«çš„ç®€å•æ€§ã€‚æ‰€éœ€è¦çš„åªæ˜¯æ·»åŠ è¯¥<code>schema_version</code>å­—æ®µã€‚ç„¶åå…è®¸åº”ç”¨ç¨‹åºå¤„ç†å’Œå¤„ç†ä¸åŒçš„æ–‡æ¡£ç‰ˆæœ¬ã€‚</p>
<p>æ­¤å¤–ï¼Œæ­£å¦‚åœ¨ç”¨ä¾‹ç¤ºä¾‹ä¸­æ‰€è§ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå°†æ¨¡å¼è®¾è®¡æ¨¡å¼ç»„åˆåœ¨ä¸€èµ·ä»¥è·å¾—é¢å¤–çš„æ€§èƒ½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒåŒæ—¶ä½¿ç”¨æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶å’Œå±æ€§æ¨¡å¼ã€‚å…è®¸åœ¨ä¸åœæœºçš„æƒ…å†µä¸‹è¿›è¡Œæ¨¡å¼å‡çº§ä½¿å¾—æ¨¡å¼ç‰ˆæœ¬æ§åˆ¶æ¨¡å¼åœ¨ MongoDB ä¸­ç‰¹åˆ«å¼ºå¤§ï¼Œå¹¶ä¸”å¾ˆå¯èƒ½æœ‰è¶³å¤Ÿçš„ç†ç”±ä¸ºæ‚¨çš„ä¸‹ä¸€ä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨ MongoDB çš„æ–‡æ¡£æ¨¡å‹è€Œä¸æ˜¯æ—§çš„è¡¨æ ¼æ•°æ®åº“ã€‚</p>
<h3 id="å­é›†æ¨¡å¼-subset">å­é›†æ¨¡å¼ Subset<a hidden class="anchor" aria-hidden="true" href="#å­é›†æ¨¡å¼-subset">#</a></h3>
<p>å‡ å¹´å‰ï¼Œç¬¬ä¸€å° PC æ‹¥æœ‰é«˜è¾¾ 256KB çš„ RAM å’ŒåŒ 5.25&quot; è½¯ç›˜é©±åŠ¨å™¨ã€‚æ²¡æœ‰ç¡¬ç›˜é©±åŠ¨å™¨ï¼Œå› ä¸ºå®ƒä»¬å½“æ—¶éå¸¸æ˜‚è´µã€‚è¿™äº›é™åˆ¶å¯¼è‡´ç”±äºå·¥ä½œæ—¶å†…å­˜ä¸è¶³è€Œä¸å¾—ä¸ç‰©ç†äº¤æ¢è½¯ç›˜æœ‰å¤§é‡ï¼ˆå½“æ—¶ï¼‰æ•°æ®ã€‚å¦‚æœå½“æ—¶åªæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥åªå°†æˆ‘ç»å¸¸ä½¿ç”¨çš„æ•°æ®å¸¦å…¥å†…å­˜ï¼Œå°±åƒæ•´ä½“æ•°æ®çš„ä¸€ä¸ªå­é›†ä¸€æ ·ã€‚</p>
<p>ç°ä»£åº”ç”¨ç¨‹åºæ— æ³•é¿å…è€—å°½èµ„æºã€‚MongoDB å°†ç»å¸¸è®¿é—®çš„æ•°æ®ï¼ˆç§°ä¸º<a href="https://docs.mongodb.com/manual/reference/glossary/#term-working-set">å·¥ä½œé›†</a>ï¼‰ä¿å­˜åœ¨ RAM ä¸­ã€‚å½“æ•°æ®å’Œç´¢å¼•çš„å·¥ä½œé›†å¢é•¿åˆ°è¶…å‡ºåˆ†é…çš„ç‰©ç† RAM æ—¶ï¼Œæ€§èƒ½ä¼šéšç€ç£ç›˜è®¿é—®å¼€å§‹å‘ç”Ÿå¹¶ä¸”æ•°æ®ä» RAM ä¸­æ»šå‡ºè€Œé™ä½ã€‚</p>
<p>æˆ‘ä»¬å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å‘æœåŠ¡å™¨æ·»åŠ æ›´å¤š RAMã€‚ä¸è¿‡ï¼Œè¿™åªè§„æ¨¡å¾ˆå¤§ã€‚æˆ‘ä»¬å¯ä»¥è€ƒè™‘å¯¹æˆ‘ä»¬çš„é›†åˆè¿›è¡Œ<a href="https://docs.mongodb.com/manual/reference/glossary/#term-shard">åˆ†ç‰‡</a>ï¼Œä½†è¿™ä¼šå¸¦æ¥é¢å¤–çš„æˆæœ¬å’Œå¤æ‚æ€§ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¯èƒ½è¿˜æ²¡æœ‰å‡†å¤‡å¥½ã€‚å¦ä¸€ç§é€‰æ‹©æ˜¯å‡å°æˆ‘ä»¬å·¥ä½œé›†çš„å¤§å°ã€‚è¿™æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å­é›†æ¨¡å¼çš„åœ°æ–¹ã€‚</p>
<h4 id="å­é›†æ¨¡å¼">å­é›†æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#å­é›†æ¨¡å¼">#</a></h4>
<p>æ­¤æ¨¡å¼è§£å†³äº†ä¸è¶…å‡º RAM çš„å·¥ä½œé›†ç›¸å…³çš„é—®é¢˜ï¼Œä»è€Œå¯¼è‡´ä¿¡æ¯ä»å†…å­˜ä¸­åˆ é™¤ã€‚è¿™é€šå¸¸æ˜¯ç”±å…·æœ‰å¤§é‡åº”ç”¨ç¨‹åºå®é™…æœªä½¿ç”¨çš„æ•°æ®çš„å¤§å‹æ–‡æ¡£å¼•èµ·çš„ã€‚æˆ‘åˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</p>
<p>æƒ³è±¡ä¸€ä¸ªæœ‰ä¸€ä¸ªäº§å“è¯„è®ºåˆ—è¡¨çš„ç”µå­å•†åŠ¡ç½‘ç«™ã€‚åœ¨è®¿é—®è¯¥äº§å“çš„æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¾ˆå¯èƒ½åªéœ€è¦æœ€è¿‘åæ¡å·¦å³çš„è¯„è®ºã€‚<em>ä½¿ç”¨æ‰€æœ‰</em>è¯„è®ºæå–æ•´ä¸ªäº§å“æ•°æ®å¾ˆå®¹æ˜“å¯¼è‡´å·¥ä½œé›†æ‰©å±•ã€‚</p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/fulldocsubset-0jesu52gzs.png" alt="å¸¦æœ‰è¯„è®ºçš„å®Œæ•´æ–‡æ¡£"  />
</p>
<p>æˆ‘ä»¬å¯ä»¥å°†é›†åˆåˆ†æˆä¸¤ä¸ªé›†åˆï¼Œè€Œä¸æ˜¯å°†æ‰€æœ‰è¯„è®ºä¸äº§å“ä¸€èµ·å­˜å‚¨ã€‚ä¸€ä¸ªé›†åˆåŒ…å«æœ€å¸¸ç”¨çš„æ•°æ®ï¼Œä¾‹å¦‚å½“å‰è¯„è®ºï¼Œè€Œå¦ä¸€ä¸ªé›†åˆåŒ…å«ä¸å¸¸ç”¨çš„æ•°æ®ï¼Œä¾‹å¦‚æ—§è¯„è®ºã€äº§å“å†å²ç­‰ã€‚æˆ‘ä»¬å¯ä»¥å¤åˆ¶éƒ¨åˆ† 1-N æˆ– NN å…³ç³»ï¼Œè¯¥å…³ç³»ç”±å…³ç³»ä¸­æœ€å¸¸ç”¨çš„ä¸€é¢ã€‚</p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/docsubset2-ncq6t9lt01.png" alt="åŒ…å«å­é›†å’Œå®Œæ•´è¯„è®ºé›†åˆçš„æ–‡æ¡£"  />
</p>
<p>åœ¨<em>äº§å“</em>é›†åˆä¸­ï¼Œæˆ‘ä»¬åªä¼šä¿ç•™æœ€è¿‘çš„ 10 æ¡è¯„è®ºã€‚è¿™å…è®¸é€šè¿‡ä»…å¼•å…¥æ•´ä½“æ•°æ®çš„ä¸€éƒ¨åˆ†æˆ–å­é›†æ¥å‡å°‘å·¥ä½œé›†ã€‚é™„åŠ ä¿¡æ¯ï¼ˆæœ¬ä¾‹ä¸­çš„è¯„è®ºï¼‰å­˜å‚¨åœ¨å•ç‹¬çš„<em>è¯„è®º</em>é›†åˆä¸­ï¼Œå¦‚æœç”¨æˆ·æƒ³è¦æŸ¥çœ‹å…¶ä»–è¯„è®ºï¼Œå¯ä»¥è®¿é—®è¯¥é›†åˆã€‚åœ¨è€ƒè™‘åœ¨å“ªé‡Œæ‹†åˆ†æ•°æ®æ—¶ï¼Œæ–‡æ¡£ä¸­æœ€å¸¸ç”¨çš„éƒ¨åˆ†åº”è¯¥è¿›å…¥â€œä¸»â€é›†åˆï¼Œè€Œä¸å¤ªå¸¸ç”¨çš„æ•°æ®åº”è¯¥è¿›å…¥å¦ä¸€ä¸ªé›†åˆã€‚å¯¹äºæˆ‘ä»¬çš„è¯„è®ºï¼Œè¯¥æ‹†åˆ†å¯èƒ½æ˜¯äº§å“é¡µé¢ä¸Šå¯è§çš„è¯„è®ºæ•°é‡ã€‚</p>
<h4 id="ç¤ºä¾‹ç”¨ä¾‹-10">ç¤ºä¾‹ç”¨ä¾‹<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹ç”¨ä¾‹-10">#</a></h4>
<p>å½“æˆ‘ä»¬åœ¨æ–‡æ¡£ä¸­æœ‰å¤§é‡å¾ˆå°‘éœ€è¦çš„æ•°æ®æ—¶ï¼Œå­é›†æ¨¡å¼éå¸¸æœ‰ç”¨ã€‚äº§å“è¯„è®ºã€æ–‡ç« è¯„è®ºã€ç”µå½±ä¸­çš„æ¼”å‘˜éƒ½æ˜¯è¿™ç§æ¨¡å¼çš„ç”¨ä¾‹ç¤ºä¾‹ã€‚æ¯å½“æ–‡æ¡£å¤§å°å¯¹å·¥ä½œé›†çš„å¤§å°æ–½åŠ å‹åŠ›å¹¶å¯¼è‡´å·¥ä½œé›†è¶…å‡ºè®¡ç®—æœºçš„ RAM å®¹é‡æ—¶ï¼Œå­é›†æ¨¡å¼æ˜¯ä¸€ä¸ªå¯ä»¥è€ƒè™‘çš„é€‰é¡¹ã€‚</p>
<h4 id="ç»“è®º-10">ç»“è®º<a hidden class="anchor" aria-hidden="true" href="#ç»“è®º-10">#</a></h4>
<p>é€šè¿‡ä½¿ç”¨å…·æœ‰æ›´é¢‘ç¹è®¿é—®æ•°æ®çš„è¾ƒå°æ–‡æ¡£ï¼Œæˆ‘ä»¬å‡å°äº†å·¥ä½œé›†çš„æ•´ä½“å¤§å°ã€‚è¿™å…è®¸å¯¹åº”ç”¨ç¨‹åºéœ€è¦çš„æœ€å¸¸ç”¨ä¿¡æ¯è¿›è¡Œæ›´çŸ­çš„ç£ç›˜è®¿é—®æ—¶é—´ã€‚ä½¿ç”¨å­é›†æ¨¡å¼æ—¶æˆ‘ä»¬å¿…é¡»åšå‡ºçš„ä¸€ä¸ªæƒè¡¡æ˜¯æˆ‘ä»¬å¿…é¡»ç®¡ç†å­é›†ï¼Œè€Œä¸”å¦‚æœæˆ‘ä»¬éœ€è¦æå–è¾ƒæ—§çš„è¯„è®ºæˆ–æ‰€æœ‰ä¿¡æ¯ï¼Œåˆ™éœ€è¦é¢å¤–è®¿é—®æ•°æ®åº“æ‰èƒ½è¿™æ ·åšã€‚</p>
<h3 id="æ ‘æ¨¡å¼-tree">æ ‘æ¨¡å¼ Tree<a hidden class="anchor" aria-hidden="true" href="#æ ‘æ¨¡å¼-tree">#</a></h3>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä»‹ç»çš„è®¸å¤šæ¨¡å¼è®¾è®¡æ¨¡å¼éƒ½å¼ºè°ƒèŠ‚çœ JOIN æ“ä½œçš„æ—¶é—´æ˜¯ä¸€ä¸ªå¥½å¤„ã€‚ä¸€èµ·è®¿é—®çš„æ•°æ®åº”è¯¥å­˜å‚¨åœ¨ä¸€èµ·ï¼Œå¹¶ä¸”ä¸€äº›æ•°æ®é‡å¤æ˜¯å¯ä»¥çš„ã€‚<a href="https://www.mongodb.com/blog/post/building-with-patterns-the-extended-reference-pattern">åƒæ‰©å±•å‚è€ƒ</a>è¿™æ ·çš„æ¨¡å¼è®¾è®¡æ¨¡å¼å°±æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¦è¿æ¥çš„æ•°æ®æ˜¯åˆ†å±‚çš„æ€ä¹ˆåŠï¼Ÿä¾‹å¦‚ï¼Œæ‚¨æƒ³ç¡®å®šä»å‘˜å·¥åˆ° CEO çš„æŠ¥å‘Šé“¾ï¼ŸMongoDB æä¾›äº†<a href="https://docs.mongodb.com/manual/reference/operator/aggregation/graphLookup/">$graphLookup</a>æ“ä½œç¬¦æ¥ä»¥å›¾è¡¨çš„å½¢å¼å¯¼èˆªæ•°æ®ï¼Œè¿™å¯èƒ½æ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨éœ€è¦å¯¹è¿™ç§åˆ†å±‚æ•°æ®ç»“æ„è¿›è¡Œå¤§é‡æŸ¥è¯¢ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åº”ç”¨ç›¸åŒçš„è§„åˆ™å°†ä¸€èµ·è®¿é—®çš„æ•°æ®å­˜å‚¨åœ¨ä¸€èµ·ã€‚è¿™æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ ‘æ¨¡å¼çš„åœ°æ–¹ã€‚</p>
<h3 id="æ ‘æ¨¡å¼">æ ‘æ¨¡å¼<a hidden class="anchor" aria-hidden="true" href="#æ ‘æ¨¡å¼">#</a></h3>
<p>æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥è¡¨ç¤ºæ—§è¡¨æ ¼æ•°æ®åº“ä¸­çš„æ ‘ã€‚æœ€å¸¸è§çš„æ˜¯å›¾ä¸­çš„èŠ‚ç‚¹åˆ—å‡ºå…¶çˆ¶èŠ‚ç‚¹å’ŒèŠ‚ç‚¹åˆ—å‡ºå…¶å­èŠ‚ç‚¹ã€‚è¿™ä¸¤ç§è¡¨ç¤ºéƒ½å¯èƒ½éœ€è¦å¤šæ¬¡è®¿é—®æ¥æ„å»ºèŠ‚ç‚¹é“¾ã€‚</p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/treeparentnodes-s72igr8b20.png" alt="å…·æœ‰çˆ¶èŠ‚ç‚¹çš„å…¬å¸ç»“æ„"  />
</p>
<p><em>å…·æœ‰çˆ¶èŠ‚ç‚¹çš„å…¬å¸ç»“æ„</em></p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/treechildnodes2-wsdhl1w7vz.png" alt="å…·æœ‰å­èŠ‚ç‚¹çš„å…¬å¸ç»“æ„"  />
</p>
<p><em>å…·æœ‰å­èŠ‚ç‚¹çš„å…¬å¸ç»“æ„</em></p>
<p>æˆ–è€…ï¼Œæˆ‘ä»¬å¯ä»¥å­˜å‚¨ä»èŠ‚ç‚¹åˆ°å±‚æ¬¡ç»“æ„é¡¶éƒ¨çš„å®Œæ•´è·¯å¾„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šä¼šä¸ºæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨â€œçˆ¶æ¯â€ã€‚åœ¨è¡¨æ ¼æ•°æ®åº“ä¸­ï¼Œå®ƒå¯èƒ½é€šè¿‡å¯¹çˆ¶æ¯åˆ—è¡¨è¿›è¡Œç¼–ç æ¥å®Œæˆã€‚MongoDB ä¸­çš„æ–¹æ³•æ˜¯å°†å…¶ç®€å•åœ°è¡¨ç¤ºä¸ºä¸€ä¸ªæ•°ç»„ã€‚</p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/documenttreeparents-5ujytbwk4c.png" alt="å¸¦æœ‰çˆ¶èŠ‚ç‚¹çš„æ–‡æ¡£å›¾åƒ"  />
</p>
<p>ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œåœ¨è¿™ä¸ªè¡¨ç¤ºä¸­æœ‰ä¸€äº›æ•°æ®é‡å¤ã€‚å¦‚æœä¿¡æ¯æ˜¯ç›¸å¯¹é™æ€çš„ï¼Œæ¯”å¦‚å®¶è°±ï¼Œä½ çš„çˆ¶æ¯å’Œç¥–å…ˆä¸ä¼šæ”¹å˜ï¼Œä½¿è¿™ä¸ªæ•°ç»„æ˜“äºç®¡ç†ã€‚ä½†æ˜¯ï¼Œåœ¨æˆ‘ä»¬çš„å…¬å¸ç»“æ„ç¤ºä¾‹ä¸­ï¼Œå½“äº‹æƒ…å‘ç”Ÿå˜åŒ–å¹¶è¿›è¡Œé‡ç»„æ—¶ï¼Œæ‚¨å°†éœ€è¦æ ¹æ®éœ€è¦æ›´æ–°å±‚æ¬¡ç»“æ„ã€‚ä¸ä¸ä¸€ç›´è®¡ç®—æ ‘æ‰€è·å¾—çš„å¥½å¤„ç›¸æ¯”ï¼Œè¿™ä»ç„¶æ˜¯ä¸€ä¸ªå¾ˆå°çš„æˆæœ¬ã€‚</p>
<h3 id="ç¤ºä¾‹ç”¨ä¾‹-11">ç¤ºä¾‹ç”¨ä¾‹<a hidden class="anchor" aria-hidden="true" href="#ç¤ºä¾‹ç”¨ä¾‹-11">#</a></h3>
<p>äº§å“ç›®å½•æ˜¯ä½¿ç”¨æ ‘æ¨¡å¼çš„å¦ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚äº§å“é€šå¸¸å±äºç±»åˆ«ï¼Œè€Œç±»åˆ«åˆæ˜¯å…¶ä»–ç±»åˆ«çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå›ºæ€é©±åŠ¨å™¨å¯èƒ½åœ¨<em>Hard Drives</em>ä¸‹ï¼Œåœ¨<em>Storage</em>ä¸‹ï¼Œåœ¨<em>Computer Parts</em>ä¸‹ã€‚æœ‰æ—¶ï¼Œç±»åˆ«çš„ç»„ç»‡å¯èƒ½ä¼šå‘ç”Ÿå˜åŒ–ï¼Œä½†ä¸ä¼šå¤ªé¢‘ç¹ã€‚</p>
<p><img loading="lazy" src="https://webassets.mongodb.com/_com_assets/cms/documenttreeancestors-4fgwdlhd1z.png" alt="å…·æœ‰çˆ¶èŠ‚ç‚¹å’Œç¥–å…ˆèŠ‚ç‚¹çš„æ–‡æ¡£çš„ IImage"  />
</p>
<p>è¯·æ³¨æ„æ–‡æ¡£ä¸Šæ–¹<code>ancestor_categories</code>è·Ÿè¸ªæ•´ä¸ªå±‚æ¬¡ç»“æ„çš„å­—æ®µã€‚æˆ‘ä»¬ä¹Ÿæœ‰é¢†åŸŸ<code>parent_category</code>ã€‚åœ¨è¿™ä¸¤ä¸ªå­—æ®µä¸­å¤åˆ¶ç›´æ¥çˆ¶çº§æ˜¯æˆ‘ä»¬åœ¨ä¸è®¸å¤šä½¿ç”¨æ ‘æ¨¡å¼çš„å®¢æˆ·åˆä½œåå¼€å‘çš„æœ€ä½³å®è·µã€‚åŒ…å«â€œçˆ¶â€å­—æ®µé€šå¸¸å¾ˆæ–¹ä¾¿ï¼Œç‰¹åˆ«æ˜¯å¦‚æœæ‚¨éœ€è¦ä¿æŒåœ¨æ–‡æ¡£ä¸Šä½¿ç”¨ $graphLookup çš„èƒ½åŠ›ã€‚</p>
<p>å°†ç¥–å…ˆä¿ç•™åœ¨æ•°ç»„ä¸­æä¾›äº†åœ¨è¿™äº›å€¼ä¸Šåˆ›å»ºå¤šé”®ç´¢å¼•çš„èƒ½åŠ›ã€‚å®ƒå…è®¸è½»æ¾æ‰¾åˆ°ç»™å®šç±»åˆ«çš„æ‰€æœ‰åä»£ã€‚è‡³äºç›´ç³»å­å¥³ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹å°†æˆ‘ä»¬ç»™å®šç±»åˆ«ä½œä¸ºå…¶ç›´ç³»â€œçˆ¶æ¯â€çš„æ–‡æ¡£æ¥è®¿é—®å®ƒä»¬ã€‚æˆ‘ä»¬åˆšåˆšå‘Šè¯‰è¿‡ä½ ï¼Œè¿™ä¸ªå­—æ®µä¼šå¾ˆæ–¹ä¾¿ã€‚</p>
<h3 id="ç»“è®º-11">ç»“è®º<a hidden class="anchor" aria-hidden="true" href="#ç»“è®º-11">#</a></h3>
<p>å¯¹äºè®¸å¤šæ¨¡å¼ï¼Œåœ¨ä½¿ç”¨å®ƒä»¬æ—¶é€šå¸¸éœ€è¦åœ¨ç®€å•æ€§å’Œæ€§èƒ½ä¹‹é—´è¿›è¡Œæƒè¡¡ã€‚åœ¨æ ‘æ¨¡å¼çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡é¿å…å¤šä¸ªè¿æ¥æ¥è·å¾—æ›´å¥½çš„æ€§èƒ½ï¼Œä½†æ˜¯ï¼Œæ‚¨éœ€è¦ç®¡ç†å¯¹å›¾å½¢çš„æ›´æ–°ã€‚</p>
<h2 id="å‚è€ƒ">å‚è€ƒ<a hidden class="anchor" aria-hidden="true" href="#å‚è€ƒ">#</a></h2>
<ul>
<li><a href="https://www.mongodb.com/blog/post/building-with-patterns-a-summary">Building with Patterns: A Summary</a></li>
<li><a href="https://www.mongodb.com/docs/drivers/go/current/usage-examples/">mogodb go driver usage excample</a></li>
<li><a href="https://mongoing.com/mongodb-advanced-pattern-design">MongoDB è¿›é˜¶æ¨¡å¼è®¾è®¡</a></li>
<li><a href="https://www.cnblogs.com/zimug/p/13175156.html">MongoDBè®¾è®¡æ–¹æ³•åŠæŠ€å·§</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://czyt.tech/tags/golang/">golang</a></li>
      <li><a href="https://czyt.tech/tags/mongodb/">mongoDB</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://czyt.tech/post/maven-setting-for-flutter-dev/">
    <span class="title">Â« Prev Page</span>
    <br>
    <span>Flutterå¼€å‘Mavené…ç½®</span>
  </a>
  <a class="next" href="https://czyt.tech/post/block-windows10-update-via-registry/">
    <span class="title">Next Page Â»</span>
    <br>
    <span>é€šè¿‡æ³¨å†Œè¡¨ç¦ç”¨windows10è‡ªåŠ¨æ›´æ–°</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share MongoDBæ“ä½œæŒ‡åŒ— on twitter"
        href="https://twitter.com/intent/tweet/?text=MongoDB%e6%93%8d%e4%bd%9c%e6%8c%87%e5%8c%97&amp;url=https%3a%2f%2fczyt.tech%2fpost%2foperate-mongodb-tutorial%2f&amp;hashtags=golang%2cmongoDB">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share MongoDBæ“ä½œæŒ‡åŒ— on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fczyt.tech%2fpost%2foperate-mongodb-tutorial%2f&amp;title=MongoDB%e6%93%8d%e4%bd%9c%e6%8c%87%e5%8c%97&amp;summary=MongoDB%e6%93%8d%e4%bd%9c%e6%8c%87%e5%8c%97&amp;source=https%3a%2f%2fczyt.tech%2fpost%2foperate-mongodb-tutorial%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share MongoDBæ“ä½œæŒ‡åŒ— on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2fczyt.tech%2fpost%2foperate-mongodb-tutorial%2f&title=MongoDB%e6%93%8d%e4%bd%9c%e6%8c%87%e5%8c%97">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share MongoDBæ“ä½œæŒ‡åŒ— on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fczyt.tech%2fpost%2foperate-mongodb-tutorial%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share MongoDBæ“ä½œæŒ‡åŒ— on whatsapp"
        href="https://api.whatsapp.com/send?text=MongoDB%e6%93%8d%e4%bd%9c%e6%8c%87%e5%8c%97%20-%20https%3a%2f%2fczyt.tech%2fpost%2foperate-mongodb-tutorial%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share MongoDBæ“ä½œæŒ‡åŒ— on telegram"
        href="https://telegram.me/share/url?text=MongoDB%e6%93%8d%e4%bd%9c%e6%8c%87%e5%8c%97&amp;url=https%3a%2f%2fczyt.tech%2fpost%2foperate-mongodb-tutorial%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

  </footer>
<script src="https://utteranc.es/client.js"
repo="czyt/comments"
issue-term="pathname"
theme="github-light"
crossorigin="anonymous"
async>
</script>

</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://czyt.tech/">è™«å­æ¨±æ¡ƒ</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
        <span id="busuanzi_container_site_pv">Total visited<span id="busuanzi_value_site_pv"></span>times</span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }
const loadScript = (url, onloadFunction) => {
    var newScript = document.createElement("script");
    newScript.onerror =  (oError) => {
      throw new URIError("The script " + oError.target.src + " didn't load correctly.");
    };
    if (onloadFunction) { newScript.onload = onloadFunction; }
    document.head.insertAdjacentElement('beforeend', newScript);
    newScript.src = url;
  }
  
if (document.querySelectorAll('.mermaid').length > 0) {
      loadScript('https://cdnjs.cloudflare.com/ajax/libs/mermaid/9.1.1/mermaid.min.js', () => {
        document.head.insertAdjacentHTML("beforeend", `<style>.mermaid svg { background-color: #dadcd8 !important; }</style>`);
        // default, dark, neutral, forest
        mermaid.initialize({ startOnLoad: false, securityLevel: "strict", logLevel: 1, theme: "neutral" });
        
        
        mermaid.init();
        console.log("mermaid init done");
      })
    }
    
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>


<script>
  if (window.scrollListeners) {
    
    for (const listener of scrollListeners) {
      window.removeEventListener('scroll', listener)
    }
  }
  window.scrollListeners = []
</script>



<script src="/js/medium-zoom.min.js" data-no-instant
></script>
<script>
  document.querySelectorAll('pre > code').forEach((codeblock) => {
    const container = codeblock.parentNode.parentNode;

    const copybutton = document.createElement('button');
    copybutton.classList.add('copy-code');
    copybutton.innerText = 'copy';

    function copyingDone() {
      copybutton.innerText = 'copied!';
      setTimeout(() => {
        copybutton.innerText = 'copy';
      }, 2000);
    }

    copybutton.addEventListener('click', (cb) => {
      if ('clipboard' in navigator) {
        navigator.clipboard.writeText(codeblock.textContent);
        copyingDone();
        return;
      }

      const range = document.createRange();
      range.selectNodeContents(codeblock);
      const selection = window.getSelection();
      selection.removeAllRanges();
      selection.addRange(range);
      try {
        document.execCommand('copy');
        copyingDone();
      } catch (e) { };
      selection.removeRange(range);
    });

    if (container.classList.contains("highlight")) {
      container.appendChild(copybutton);
    } else if (container.parentNode.firstChild == container) {
      
    } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
      
      codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
    } else {
      
      codeblock.parentNode.appendChild(copybutton);
    }
  });
</script>




<script>
  
  
  (function() {
    const enableTocScroll = '1' == '1'
    if (!enableTocScroll) {
      return
    }
    if (!document.querySelector('.toc')) {
      console.log('no toc found, ignore toc scroll')
      return
    }
    

    
    const scrollListeners = window.scrollListeners
    const headings = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id]');
    const activeClass = 'active';

    
    let activeHeading = headings[0];
    getLinkByHeading(activeHeading).classList.add(activeClass);

    const onScroll = () => {
      const passedHeadings = [];
      for (const h of headings) {
        
        if (getOffsetTop(h) < 5) {
          passedHeadings.push(h)
        } else {
          break;
        }
      }
      if (passedHeadings.length > 0) {
        newActiveHeading = passedHeadings[passedHeadings.length - 1];
      } else {
        newActiveHeading = headings[0];
      }
      if (activeHeading != newActiveHeading) {
        getLinkByHeading(activeHeading).classList.remove(activeClass);
        activeHeading = newActiveHeading;
        getLinkByHeading(activeHeading).classList.add(activeClass);
      }
    }

    let timer = null;
    const scrollListener = () => {
      if (timer !== null) {
        clearTimeout(timer)
      }
      timer = setTimeout(onScroll, 50)
    }
    window.addEventListener('scroll', scrollListener, false);
    scrollListeners.push(scrollListener)

    function getLinkByHeading(heading) {
      const id = encodeURI(heading.getAttribute('id')).toLowerCase();
      return document.querySelector(`.toc ul li a[href="#${id}"]`);
    }

    function getOffsetTop(heading) {
      if (!heading.getClientRects().length) {
        return 0;
      }
      let rect = heading.getBoundingClientRect();
      return rect.top
    }
  })();
  </script>
<script>
  mediumZoom('.entry-cover img');
  mediumZoom('.post-content img:not([no-zoom])');
</script>


<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
	
</script>
</body>

</html>
